<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø¬ØªÙ…Ø§Ø¹ Ø®Ø¯Ø§Ù… Ù…Ù„Ø§ÙŠÙƒØ© - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #fceabb, #f8b500);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            padding: 20px;
            overflow: hidden;
        }
        
        header {
            background: #3498db;
            color: white;
            padding: 15px;
            text-align: center;
            border-radius: 10px;
            position: relative;
            margin-bottom: 20px;
        }
        
        header::before {
            content: "ğŸ§šâ€â™‚ï¸";
            position: absolute;
            left: 10px;
            top: 10px;
            font-size: 1.5rem;
        }
        
        header::after {
            content: "âœ¨";
            position: absolute;
            right: 10px;
            top: 10px;
            font-size: 1.5rem;
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 5px;
        }
        
        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .tab-content {
            display: none;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            margin-top: 10px;
            background: #fff;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: #fff;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        th, td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background: #3498db;
            color: white;
        }
        
        tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        tr:hover {
            background: #f1f1f1;
        }
        
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn i {
            margin-left: 5px;
        }
        
        .btn-primary {
            background: #2ecc71;
            color: white;
        }
        
        .btn-primary:hover {
            background: #27ae60;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #3498db;
            color: white;
        }
        
        .btn-success:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        
        .btn-warning {
            background: #f39c12;
            color: white;
        }
        
        .btn-warning:hover {
            background: #e67e22;
            transform: translateY(-2px);
        }
        
        .btn-info {
            background: #9b59b6;
            color: white;
        }
        
        .btn-info:hover {
            background: #8e44ad;
            transform: translateY(-2px);
        }
        
        .controls {
            margin: 15px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        select, input {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
            min-width: 150px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 400px;
            max-width: 90%;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .tabs .tab {
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 5px;
            background: #f0f0f0;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .tabs .tab.active {
            background: #3498db;
            color: white;
        }
        
        .tabs .tab:hover {
            background: #ddd;
        }
        
        .summary-card {
            background: #fff;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin: 10px;
            flex: 1;
            min-width: 200px;
            transition: transform 0.3s;
        }
        
        .summary-card:hover {
            transform: translateY(-5px);
        }
        
        .summary-card h3 {
            color: #3498db;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        
        .summary-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #2ecc71;
            margin: 10px 0;
        }
        
        .summary-subtitle {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .card-container {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .medal {
            font-size: 1.5rem;
            margin-left: 5px;
        }
        
        .medal-gold {
            color: gold;
        }
        
        .medal-silver {
            color: silver;
        }
        
        .medal-bronze {
            color: #cd7f32;
        }
        
        .top-members-list {
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .top-members-list h3 {
            color: #3498db;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .top-member-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #eee;
            align-items: center;
        }
        
        .top-member-item:last-child {
            border-bottom: none;
        }
        
        .top-member-name {
            font-weight: bold;
        }
        
        .top-member-points {
            background: #3498db;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
        }
        
        .report-section {
            margin-bottom: 30px;
        }
        
        .report-section h3 {
            color: #3498db;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 2px solid #3498db;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2ecc71;
            color: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
            animation: slideIn 0.5s;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .member-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #3498db;
        }
        
        .reward-badge {
            background: gold;
            color: #333;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            margin-left: 5px;
            font-weight: bold;
        }
        
        .export-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .member-stats {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .member-stat-item {
            background: #fff;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            flex: 1;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .member-stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #3498db;
        }
        
        .member-stat-label {
            font-size: 0.8rem;
            color: #7f8c8d;
        }
        
        .mobile-menu {
            display: none;
            width: 100%;
            padding: 10px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            margin-bottom: 10px;
            text-align: center;
            font-weight: bold;
        }
        
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .mobile-menu {
                display: block;
            }
            
            .tabs .tab {
                width: 100%;
                text-align: center;
                display: none;
            }
            
            .tabs.show .tab {
                display: block;
            }
            
            .card-container {
                flex-direction: column;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .export-buttons {
                flex-direction: column;
            }
            
            .member-stats {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸŒŸ Ø§Ø¬ØªÙ…Ø§Ø¹ Ø®Ø¯Ø§Ù… Ù…Ù„Ø§ÙŠÙƒØ©</h1>
            <p class="subtitle">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ù†Ù‚Ø§Ø·</p>
        </header>

        <button class="mobile-menu" id="mobileMenu">
            <i class="fas fa-bars"></i> Ø¹Ø±Ø¶ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
        </button>

        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
        </div>

        <div class="notification" id="notification"></div>

        <div class="tabs" id="mainTabs">
            <div class="tab active" data-tab="userAttendance">Ø§Ù„Ø­Ø¶ÙˆØ±</div>
            <div class="tab" data-tab="members">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</div>
            <div class="tab" data-tab="weeks">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹</div>
            <div class="tab" data-tab="attendance">Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±</div>
            <div class="tab" data-tab="reports">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
            <div class="tab" data-tab="rewards">Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª</div>
        </div>

        <div class="tab-content active" id="userAttendance">
            <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±</h2>
            <div class="controls">
                <label>Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ: </label>
                <select id="selectMember"></select>
                <label>Ø§Ø®ØªØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹: </label>
                <select id="weekSelect"></select>
            </div>
            <div class="controls">
                <button class="btn btn-primary" id="markPresent">
                    <i class="fas fa-check-circle"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±
                </button>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Ø§Ù„ØµÙˆØ±Ø©</th>
                        <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ø¶Ùˆ</th>
                        <th>Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</th>
                        <th>Ø§Ù„Ø­Ø¶ÙˆØ±</th>
                        <th>Ø§Ù„Ù†Ù‚Ø§Ø·</th>
                    </tr>
                </thead>
                <tbody id="attendanceTableBody"></tbody>
            </table>
            <div class="controls">
                <span>Ø§Ù„Ø­Ø¶ÙˆØ± Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹: <span id="attendanceCount">0</span>/<span id="totalMembers">0</span></span>
                <span>Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="totalPoints">0</span></span>
            </div>
        </div>

        <div class="tab-content" id="members">
            <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</h2>
            <div class="controls">
                <input type="text" id="newMemberName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ø¶Ùˆ">
                <input type="text" id="newMemberImage" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                <button class="btn btn-primary" id="addMemberBtn">
                    <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ
                </button>
            </div>
            <table id="membersTable">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Ø§Ù„ØµÙˆØ±Ø©</th>
                        <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ø¶Ùˆ</th>
                        <th>Ø§Ù„Ù†Ù‚Ø§Ø·</th>
                        <th>Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª</th>
                        <th>ØªØ¹Ø¯ÙŠÙ„</th>
                        <th>Ø­Ø°Ù</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <div class="tab-content" id="weeks">
            <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹</h2>
            <div class="controls">
                <input type="text" id="newWeekName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹">
                <input type="date" id="newWeekStart">
                <input type="date" id="newWeekEnd">
                <button class="btn btn-primary" id="addWeekBtn">
                    <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ø¨ÙˆØ¹
                </button>
            </div>
            <table id="weeksTable">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Ø§Ø³Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</th>
                        <th>Ù…Ù†</th>
                        <th>Ø¥Ù„Ù‰</th>
                        <th>ØªØ¹Ø¯ÙŠÙ„</th>
                        <th>Ø­Ø°Ù</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <div class="tab-content" id="attendance">
            <h2>Ø¥Ø¯Ø§Ø±Ø© ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±</h2>
            <div class="controls">
                <label>Ø§Ø®ØªØ± Ø£Ø³Ø¨ÙˆØ¹: </label>
                <select id="deleteWeekSelect"></select>
                <button class="btn btn-danger" id="deleteAttendanceBtn">
                    <i class="fas fa-trash"></i> Ø­Ø°Ù ÙƒÙ„ Ø­Ø¶ÙˆØ± Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
                </button>
            </div>
            <table id="attendanceTable">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Ø§Ù„Ø¹Ø¶Ùˆ</th>
                        <th>Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</th>
                        <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>
                        <th>Ø­Ø°Ù</th>
                    </tr>
                </thead>
                <tbody id="attendanceRecordsBody"></tbody>
            </table>
        </div>

        <div class="tab-content" id="reports">
            <h2>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h2>
            
            <div class="export-buttons">
                <button class="btn btn-info" id="printReportBtn">
                    <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                </button>
                <button class="btn btn-success" id="exportExcelBtn">
                    <i class="fas fa-file-excel"></i> ØªØµØ¯ÙŠØ± Ù„Ø¥ÙƒØ³Ù„
                </button>
                <button class="btn btn-primary" id="exportPDFBtn">
                    <i class="fas fa-file-pdf"></i> ØªØµØ¯ÙŠØ± Ù„PDF
                </button>
            </div>
            
            <div class="report-section">
                <h3>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ø§Ù…Ø©</h3>
                <div class="card-container">
                    <div class="summary-card">
                        <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
                        <div class="summary-value" id="reportAttendance">0</div>
                        <div class="summary-subtitle">Ø­Ø¶ÙˆØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹</div>
                    </div>
                    <div class="summary-card">
                        <h3>Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ù…Ù†ÙˆØ­Ø©</h3>
                        <div class="summary-value" id="reportPoints">0</div>
                        <div class="summary-subtitle">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·</div>
                    </div>
                    <div class="summary-card">
                        <h3>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</h3>
                        <div class="summary-value" id="reportMembers">0</div>
                        <div class="summary-subtitle">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</div>
                    </div>
                    <div class="summary-card">
                        <h3>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹</h3>
                        <div class="summary-value" id="reportWeeks">0</div>
                        <div class="summary-subtitle">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹</div>
                    </div>
                </div>
            </div>

            <div class="report-section">
                <h3>ğŸ† Ø§Ù„Ù€ 10 Ø§Ù„Ø£ÙˆØ§Ø¦Ù„ ÙÙŠ Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
                <div class="top-members-list" id="topMembersList">
                    <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
                </div>
            </div>

            <div class="report-section">
                <h3>ğŸ“ˆ Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ± Ù„Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ</h3>
                <canvas id="attendanceChart" style="margin-top:20px;max-height:300px;"></canvas>
            </div>

            <div class="report-section">
                <h3>ğŸ‘¥ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</h3>
                <div id="membersStatsContainer"></div>
            </div>
        </div>

        <div class="tab-content" id="rewards">
            <h2>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª</h2>
            <div class="controls">
                <label>Ø§Ø®ØªØ± Ø§Ù„Ø¹Ø¶Ùˆ: </label>
                <select id="rewardMemberSelect"></select>
                <input type="text" id="rewardTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©">
                <input type="number" id="rewardPoints" placeholder="Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ù…Ù†ÙˆØ­Ø©">
                <button class="btn btn-primary" id="addRewardBtn">
                    <i class="fas fa-gift"></i> Ù…Ù†Ø­ Ù…ÙƒØ§ÙØ£Ø©
                </button>
            </div>
            
            <div class="report-section">
                <h3>ğŸ Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª Ø§Ù„Ù…Ù…Ù†ÙˆØ­Ø©</h3>
                <table id="rewardsTable">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Ø§Ù„Ø¹Ø¶Ùˆ</th>
                            <th>Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©</th>
                            <th>Ø§Ù„Ù†Ù‚Ø§Ø·</th>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th>Ø­Ø°Ù</th>
                        </tr>
                    </thead>
                    <tbody id="rewardsTableBody"></tbody>
                </table>
            </div>
        </div>

        <div class="controls" style="margin-top:20px;">
            <button class="btn btn-success" id="adminLoginBtn">
                <i class="fas fa-lock"></i> ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†
            </button>
            <button class="btn btn-warning" id="resetDataBtn" style="display:none;">
                <i class="fas fa-trash"></i> Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            </button>
        </div>

        <div class="modal" id="adminLoginModal">
            <div class="modal-content">
                <h2>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†</h2>
                <input type="password" id="adminPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
                <div class="controls">
                    <button class="btn btn-danger" id="cancelAdminLogin">Ø¥Ù„ØºØ§Ø¡</button>
                    <button class="btn btn-success" id="confirmAdminLogin">Ø¯Ø®ÙˆÙ„</button>
                </div>
            </div>
        </div>
    </div>

    <script>
    // ====== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase - ÙŠØ¬Ø¨ Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ø¨Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙƒ ======
    const firebaseConfig = {
        apiKey: "AIzaSyBCQIqdCsxSvhfYOs00AetoVWpFhj4XNAQ",
        authDomain: "angels-attendance.firebaseapp.com",
        databaseURL: "https://angels-attendance-default-rtdb.firebaseio.com",
        projectId: "angels-attendance",
        storageBucket: "angels-attendance.firebasestorage.app",
        messagingSenderId: "157249026489",
        appId: "1:157249026489:web:db2b420203bd81d9a19e68"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    let members = [];
    let weeks = [];
    let attendanceRecords = [];
    let rewards = [];
    let isAdmin = false;
    
    // ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù„Ù„Ø£Ø¯Ù…Ù†
    const adminPass = 'admin123';
    
    // Ø¹Ù†Ø§ØµØ± DOM
    const mainTabs = document.getElementById('mainTabs');
    const tabContents = document.querySelectorAll('.tab-content');
    const mobileMenu = document.getElementById('mobileMenu');
    
    // ÙˆØ¸Ø§Ø¦Ù Firebase
    function showLoading() {
        document.getElementById('loading').style.display = 'block';
    }

    function hideLoading() {
        document.getElementById('loading').style.display = 'none';
    }

    function showNotification(message, isSuccess = true) {
        const notification = document.getElementById('notification');
        notification.textContent = message;
        notification.style.background = isSuccess ? '#2ecc71' : '#e74c3c';
        notification.style.display = 'block';
        
        setTimeout(() => {
            notification.style.display = 'none';
        }, 3000);
    }

    function loadData() {
        showLoading();
        const dataRef = database.ref('angelsAttendance');
        
        dataRef.on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                members = data.members || [];
                weeks = data.weeks || [];
                attendanceRecords = data.attendanceRecords || [];
                rewards = data.rewards || [];
            } else {
                // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª
                members = [
                    {id: 1, name: 'ğŸ§’ Mary Karam', image: 'https://ui-avatars.com/api/?name=Mary+Karam&background=3498db&color=fff'},
                    {id: 2, name: 'ğŸ‘¦ Eman Makin', image: 'https://ui-avatars.com/api/?name=Eman+Makin&background=2ecc71&color=fff'},
                    {id: 3, name: 'ğŸ‘§ Rizk Gerges', image: 'https://ui-avatars.com/api/?name=Rizk+Gerges&background=e74c3c&color=fff'}
                ];
                weeks = [
                    {id: 1, name: 'Ø§Ù„Ø§Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø§ÙˆÙ„', from: '2023-08-01', to: '2023-08-07'}
                ];
                attendanceRecords = [];
                rewards = [];
                saveData();
            }
            populateData();
            updateReports();
            hideLoading();
        }, (error) => {
            console.error('Error loading data:', error);
            hideLoading();
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.');
        });
    }

    function saveData() {
        showLoading();
        const dataRef = database.ref('angelsAttendance');
        dataRef.set({
            members: members,
            weeks: weeks,
            attendanceRecords: attendanceRecords,
            rewards: rewards
        }).then(() => {
            hideLoading();
        }).catch((error) => {
            console.error('Error saving data:', error);
            hideLoading();
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.');
        });
    }
    
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    function initApp() {
        setupEventListeners();
        loadData();
    }
    
    // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    function setupEventListeners() {
        // Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        mainTabs.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.dataset.tab;
                activateTab(tabId);
            });
        });
        
        // Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªÙ†Ù‚Ù„Ø©
        mobileMenu.addEventListener('click', () => {
            mainTabs.classList.toggle('show');
        });
        
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±
        document.getElementById('markPresent').addEventListener('click', markAttendance);
        
        // Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ
        document.getElementById('addMemberBtn').addEventListener('click', addNewMember);
        
        // Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ø¨ÙˆØ¹
        document.getElementById('addWeekBtn').addEventListener('click', addNewWeek);
        
        // Ø­Ø°Ù Ø§Ù„Ø­Ø¶ÙˆØ±
        document.getElementById('deleteAttendanceBtn').addEventListener('click', deleteAllWeekAttendance);
        
        // ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†
        document.getElementById('adminLoginBtn').addEventListener('click', showAdminLogin);
        document.getElementById('cancelAdminLogin').addEventListener('click', hideAdminLogin);
        document.getElementById('confirmAdminLogin').addEventListener('click', confirmAdminLogin);
        
        // Ø§Ù„ØªØµØ¯ÙŠØ± ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø©
        document.getElementById('printReportBtn').addEventListener('click', printReport);
        document.getElementById('exportExcelBtn').addEventListener('click', exportToExcel);
        
        // Ø¥Ø¶Ø§ÙØ© Ù…ÙƒØ§ÙØ£Ø©
        document.getElementById('addRewardBtn').addEventListener('click', addNewReward);
        
        // Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        document.getElementById('resetDataBtn').addEventListener('click', resetAllData);
        
        // ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
        document.getElementById('weekSelect').addEventListener('change', populateData);
    }
    
    // ØªÙØ¹ÙŠÙ„ ØªØ¨ÙˆÙŠØ¨
    function activateTab(tabId) {
        // Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª
        tabContents.forEach(content => {
            content.classList.remove('active');
        });
        
        // Ø¥Ù„ØºØ§Ø¡ ØªÙØ¹ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ø£Ù„Ø³Ù†Ø©
        mainTabs.querySelectorAll('.tab').forEach(tab => {
            tab.classList.remove('active');
        });
        
        // ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø­Ø¯Ø¯
        document.getElementById(tabId).classList.add('active');
        mainTabs.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
        
        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªÙ†Ù‚Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ØµØºÙŠØ±Ø©
        if (window.innerWidth <= 768) {
            mainTabs.classList.remove('show');
        }
        
        // Ø¥Ø°Ø§ ÙƒØ§Ù† ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±ØŒ Ù‚Ù… Ø¨ØªØ­Ø¯ÙŠØ«Ù‡Ø§
        if (tabId === 'reports') {
            updateReports();
        }
    }
    
    // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
    function populateData() {
        const selectMember = document.getElementById('selectMember');
        selectMember.innerHTML = '';
        members.forEach(m => {
            let option = document.createElement('option');
            option.value = m.id;
            option.textContent = m.name;
            selectMember.appendChild(option);
        });

        const weekSelect = document.getElementById('weekSelect');
        weekSelect.innerHTML = '';
        weeks.forEach(w => {
            let option = document.createElement('option');
            option.value = w.id;
            option.textContent = w.name;
            weekSelect.appendChild(option);
        });

        // ØªØ¹Ø¨Ø¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹ ÙÙŠ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¶ÙˆØ±
        const deleteWeekSelect = document.getElementById('deleteWeekSelect');
        deleteWeekSelect.innerHTML = '';
        weeks.forEach(w => {
            let option = document.createElement('option');
            option.value = w.id;
            option.textContent = w.name;
            deleteWeekSelect.appendChild(option);
        });

        // ØªØ¹Ø¨Ø¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ ÙÙŠ Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª
        const rewardMemberSelect = document.getElementById('rewardMemberSelect');
        rewardMemberSelect.innerHTML = '';
        members.forEach(m => {
            let option = document.createElement('option');
            option.value = m.id;
            option.textContent = m.name;
            rewardMemberSelect.appendChild(option);
        });

        const tbody = document.getElementById('attendanceTableBody');
        tbody.innerHTML = '';
        
        const selectedWeekId = document.getElementById('weekSelect').value;
        const selectedWeek = weeks.find(w => w.id == selectedWeekId);
        
        members.forEach((m, i) => {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø³Ø¬Ù„ Ø­Ø¶ÙˆØ± Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶Ùˆ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
            const attendanceRecord = attendanceRecords.find(ar => 
                ar.memberId === m.id && ar.weekId == selectedWeekId
            );
            
            const isPresent = attendanceRecord ? attendanceRecord.present : false;
            
            let tr = document.createElement('tr');
            tr.dataset.member = m.id;
            tr.innerHTML = `
                <td>${i+1}</td>
                <td><img src="${m.image || 'https://ui-avatars.com/api/?name=Member&background=ccc&color=fff'}" class="member-img" alt="${m.name}"></td>
                <td>${m.name}</td>
                <td>${selectedWeek ? selectedWeek.name : ''}</td>
                <td class="attendance-value">${isPresent ? '1' : '0'}</td>
                <td class="points">${isPresent ? '1' : '0'}</td>
            `;
            tbody.appendChild(tr);
        });
        
        document.getElementById('totalMembers').textContent = members.length;
        updateAttendanceStats();
        populateAdminTables();
        populateAttendanceRecords();
        populateRewardsTable();
    }
    
    // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©
    function populateAdminTables() {
        const membersTbody = document.querySelector('#membersTable tbody');
        membersTbody.innerHTML = '';
        members.forEach((m, i) => {
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© Ù„ÙƒÙ„ Ø¹Ø¶Ùˆ
            const totalPoints = attendanceRecords.filter(ar => 
                ar.memberId === m.id && ar.present
            ).length;
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙƒØ§ÙØ¢Øª Ø§Ù„Ø¹Ø¶Ùˆ
            const memberRewards = rewards.filter(r => r.memberId === m.id);
            const rewardsText = memberRewards.map(r => r.title).join(', ') || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯';
            
            let tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${i+1}</td>
                <td><img src="${m.image || 'https://ui-avatars.com/api/?name=Member&background=ccc&color=fff'}" class="member-img" alt="${m.name}"></td>
                <td>${m.name}</td>
                <td>${totalPoints}</td>
                <td>${rewardsText}</td>
                <td><button class='btn btn-primary editMember'>ØªØ¹Ø¯ÙŠÙ„</button></td>
                <td><button class='btn btn-danger deleteMember'>Ø­Ø°Ù</button></td>
            `;
            membersTbody.appendChild(tr);
        });
        
        const weeksTbody = document.querySelector('#weeksTable tbody');
        weeksTbody.innerHTML = '';
        weeks.forEach((w, i) => {
            let tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${i+1}</td>
                <td>${w.name}</td>
                <td>${w.from}</td>
                <td>${w.to}</td>
                <td><button class='btn btn-primary editWeek'>ØªØ¹Ø¯ÙŠÙ„</button></td>
                <td><button class='btn btn-danger deleteWeek'>Ø­Ø°Ù</button></td>
            `;
            weeksTbody.appendChild(tr);
        });
        
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        attachEditDeleteListeners();
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù
    function attachEditDeleteListeners() {
        // ØªØ¹Ø¯ÙŠÙ„ ÙˆØ­Ø°Ù Ø£Ø¹Ø¶Ø§Ø¡
        document.querySelectorAll('.editMember').forEach((btn, index) => {
            btn.addEventListener('click', () => {
                const newName = prompt('Ø¹Ø¯Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ø¶Ùˆ:', members[index].name);
                const newImage = prompt('Ø¹Ø¯Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ø¥Ø°Ø§ Ù„Ø§ ØªØ±ÙŠØ¯ ØªØºÙŠÙŠØ±Ù‡):', members[index].image);
                if (newName) {
                    members[index].name = newName;
                    if (newImage) members[index].image = newImage;
                    saveData();
                    showNotification('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø¶Ùˆ Ø¨Ù†Ø¬Ø§Ø­');
                }
            });
        });
        
        document.querySelectorAll('.deleteMember').forEach((btn, index) => {
            btn.addEventListener('click', () => {
                if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø¹Ø¶ÙˆØŸ')) {
                    // Ø­Ø°Ù Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶Ùˆ Ø£ÙˆÙ„Ø§Ù‹
                    attendanceRecords = attendanceRecords.filter(ar => ar.memberId !== members[index].id);
                    
                    // Ø­Ø°Ù Ù…ÙƒØ§ÙØ¢Øª Ø§Ù„Ø¹Ø¶Ùˆ
                    rewards = rewards.filter(r => r.memberId !== members[index].id);
                    
                    members.splice(index, 1);
                    saveData();
                    showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ø¶Ùˆ Ø¨Ù†Ø¬Ø§Ø­');
                }
            });
        });
        
        // ØªØ¹Ø¯ÙŠÙ„ ÙˆØ­Ø°Ù Ø£Ø³Ø§Ø¨ÙŠØ¹
        document.querySelectorAll('.editWeek').forEach((btn, index) => {
            btn.addEventListener('click', () => {
                const newName = prompt('Ø¹Ø¯Ù„ Ø§Ø³Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹:', weeks[index].name);
                const newFrom = prompt('Ø¹Ø¯Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©:', weeks[index].from);
                const newTo = prompt('Ø¹Ø¯Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©:', weeks[index].to);
                if (newName && newFrom && newTo) {
                    weeks[index] = {...weeks[index], name: newName, from: newFrom, to: newTo};
                    saveData();
                    showNotification('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø¨Ù†Ø¬Ø§Ø­');
                }
            });
        });
        
        document.querySelectorAll('.deleteWeek').forEach((btn, index) => {
            btn.addEventListener('click', () => {
                if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ØŸ')) {
                    // Ø­Ø°Ù Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø£ÙˆÙ„Ø§Ù‹
                    attendanceRecords = attendanceRecords.filter(ar => ar.weekId != weeks[index].id);
                    
                    weeks.splice(index, 1);
                    saveData();
                    showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø¨Ù†Ø¬Ø§Ø­');
                }
            });
        });
    }
    
    // Ø¹Ø±Ø¶ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±
    function populateAttendanceRecords() {
        const tbody = document.querySelector('#attendanceRecordsBody');
        tbody.innerHTML = '';
        
        attendanceRecords.forEach((record, index) => {
            const member = members.find(m => m.id === record.memberId);
            const week = weeks.find(w => w.id == record.weekId);
            
            if (member && week) {
                let tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${member.name}</td>
                    <td>${week.name}</td>
                    <td>${new Date(record.date).toLocaleString('ar-EG')}</td>
                    <td><button class='btn btn-danger deleteAttendance' data-index='${index}'>Ø­Ø°Ù</button></td>
                `;
                tbody.appendChild(tr);
            }
        });
        
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ø£Ø²Ø±Ø§Ø± Ø­Ø°Ù Ø§Ù„Ø­Ø¶ÙˆØ±
        document.querySelectorAll('.deleteAttendance').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const index = parseInt(e.target.dataset.index);
                deleteAttendanceRecord(index);
            });
        });
    }
    
    // Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª
    function populateRewardsTable() {
        const tbody = document.getElementById('rewardsTableBody');
        tbody.innerHTML = '';
        
        rewards.forEach((reward, index) => {
            const member = members.find(m => m.id === reward.memberId);
            
            if (member) {
                let tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${member.name}</td>
                    <td>${reward.title}</td>
                    <td>${reward.points}</td>
                    <td>${new Date(reward.date).toLocaleDateString('ar-EG')}</td>
                    <td><button class='btn btn-danger deleteReward' data-index='${index}'>Ø­Ø°Ù</button></td>
                `;
                tbody.appendChild(tr);
            }
        });
        
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ø£Ø²Ø±Ø§Ø± Ø­Ø°Ù Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª
        document.querySelectorAll('.deleteReward').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const index = parseInt(e.target.dataset.index);
                deleteRewardRecord(index);
            });
        });
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø­Ø¶ÙˆØ±
    function updateAttendanceStats() {
        const selectedWeekId = document.getElementById('weekSelect').value;
        let count = 0;
        let totalPoints = 0;
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø­Ø¶ÙˆØ± Ù„Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ÙÙ‚Ø·
        const weekAttendance = attendanceRecords.filter(ar => 
            ar.weekId == selectedWeekId && ar.present
        );
        
        count = weekAttendance.length;
        totalPoints = count;
        
        document.getElementById('attendanceCount').textContent = count;
        document.getElementById('totalPoints').textContent = totalPoints;
        updateChart();
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
    function updateReports() {
        // Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
        const totalAttendance = attendanceRecords.filter(ar => ar.present).length;
        const totalPoints = totalAttendance;
        
        document.getElementById('reportAttendance').textContent = totalAttendance;
        document.getElementById('reportPoints').textContent = totalPoints;
        document.getElementById('reportMembers').textContent = members.length;
        document.getElementById('reportWeeks').textContent = weeks.length;
        
        // Ø§Ù„Ù€ 10 Ø§Ù„Ø£ÙˆØ§Ø¦Ù„
        updateTopMembers();
        
        // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
        updateMembersStats();
    }
    
    // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù€ 10 Ø§Ù„Ø£ÙˆØ§Ø¦Ù„
    function updateTopMembers() {
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ù„ÙƒÙ„ Ø¹Ø¶Ùˆ
        const memberPoints = members.map(member => {
            const points = attendanceRecords.filter(ar => 
                ar.memberId === member.id && ar.present
            ).length;
            return { name: member.name, points: points, image: member.image };
        });
        
        // ØªØ±ØªÙŠØ¨ ØªÙ†Ø§Ø²Ù„ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·
        memberPoints.sort((a, b) => b.points - a.points);
        
        // Ø£Ø®Ø° Ø£ÙˆÙ„ 10 ÙÙ‚Ø·
        const top10 = memberPoints.slice(0, 10);
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        const topMembersList = document.getElementById('topMembersList');
        topMembersList.innerHTML = '';
        
        if (top10.length === 0) {
            topMembersList.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>';
            return;
        }
        
        top10.forEach((member, index) => {
            const item = document.createElement('div');
            item.className = 'top-member-item';
            
            let medal = '';
            if (index === 0) medal = '<span class="medal medal-gold">ğŸ¥‡</span>';
            else if (index === 1) medal = '<span class="medal medal-silver">ğŸ¥ˆ</span>';
            else if (index === 2) medal = '<span class="medal medal-bronze">ğŸ¥‰</span>';
            
            item.innerHTML = `
                <div style="display:flex;align-items:center;gap:10px;">
                    <img src="${member.image || 'https://ui-avatars.com/api/?name=Member&background=ccc&color=fff'}" class="member-img" alt="${member.name}">
                    <div class="top-member-name">${medal} ${member.name}</div>
                </div>
                <div class="top-member-points">${member.points} Ù†Ù‚Ø·Ø©</div>
            `;
            topMembersList.appendChild(item);
        });
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
    function updateMembersStats() {
        const container = document.getElementById('membersStatsContainer');
        container.innerHTML = '';
        
        // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹
        const totalWeeks = weeks.length;
        
        members.forEach(member => {
            // Ø­Ø³Ø§Ø¨ Ø­Ø¶ÙˆØ± Ø§Ù„Ø¹Ø¶Ùˆ
            const memberAttendance = attendanceRecords.filter(ar => 
                ar.memberId === member.id && ar.present
            ).length;
            
            // Ø­Ø³Ø§Ø¨ Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±
            const attendancePercentage = totalWeeks > 0 ? Math.round((memberAttendance / totalWeeks) * 100) : 0;
            
            const statsDiv = document.createElement('div');
            statsDiv.className = 'member-stats';
            statsDiv.innerHTML = `
                <img src="${member.image || 'https://ui-avatars.com/api/?name=Member&background=ccc&color=fff'}" class="member-img" alt="${member.name}">
                <div style="flex:1">
                    <h4>${member.name}</h4>
                    <div style="display:flex;gap:10px;margin-top:5px;">
                        <div class="member-stat-item">
                            <div class="member-stat-value">${memberAttendance}</div>
                            <div class="member-stat-label">Ø­Ø¶ÙˆØ±</div>
                        </div>
                        <div class="member-stat-item">
                            <div class="member-stat-value">${attendancePercentage}%</div>
                            <div class="member-stat-label">Ù†Ø³Ø¨Ø©</div>
                        </div>
                        <div class="member-stat-item">
                            <div class="member-stat-value">${memberAttendance}</div>
                            <div class="member-stat-label">Ù†Ù‚Ø§Ø·</div>
                        </div>
                    </div>
                </div>
            `;
            container.appendChild(statsDiv);
        });
    }
    
    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ù„Ù„Ø¹Ø¶Ùˆ Ø§Ù„Ù…Ø­Ø¯Ø¯
    function markAttendance() {
        const memberId = parseInt(document.getElementById('selectMember').value);
        const weekId = parseInt(document.getElementById('weekSelect').value);
        
        if (!memberId || !weekId) {
            alert('ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ø¶Ùˆ ÙˆØ§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø£ÙˆÙ„Ø§Ù‹');
            return;
        }
        
        const index = attendanceRecords.findIndex(ar => 
            ar.memberId === memberId && ar.weekId == weekId
        );
        
        if (index !== -1) {
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ Ø¨Ø§Ù„ÙØ¹Ù„ØŒ Ù„Ø§ Ù†ÙØ¹Ù„ Ø´ÙŠØ¦Ø§Ù‹ (Ù„Ø§ Ù†Ø³Ù…Ø­ Ø¨Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ØªÙƒØ±Ø±)
            showNotification('Ù„Ù‚Ø¯ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶Ùˆ already ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹', false);
        } else {
            // Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ø¬Ø¯ÙŠØ¯
            attendanceRecords.push({
                memberId: memberId,
                weekId: weekId,
                present: true,
                date: new Date().toISOString()
            });
            
            saveData();
            showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­!', true);
        }
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ Ø¬Ø¯ÙŠØ¯
    function addNewMember() {
        const name = document.getElementById('newMemberName').value;
        const image = document.getElementById('newMemberImage').value;
        
        if (!name) {
            alert('Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ø¶Ùˆ');
            return;
        }
        
        const id = members.length ? Math.max(...members.map(m => m.id)) + 1 : 1;
        members.push({
            id,
            name,
            image: image || `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=3498db&color=fff`
        });
        
        saveData();
        showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø¶Ùˆ Ø¨Ù†Ø¬Ø§Ø­');
        
        // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
        document.getElementById('newMemberName').value = '';
        document.getElementById('newMemberImage').value = '';
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ø¨ÙˆØ¹ Ø¬Ø¯ÙŠØ¯
    function addNewWeek() {
        const name = document.getElementById('newWeekName').value;
        const from = document.getElementById('newWeekStart').value;
        const to = document.getElementById('newWeekEnd').value;
        
        if (!name || !from || !to) {
            alert('Ø§Ù…Ù„Ø£ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„');
            return;
        }
        
        const id = weeks.length ? Math.max(...weeks.map(w => w.id)) + 1 : 1;
        weeks.push({ id, name, from, to });
        
        saveData();
        showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø¨Ù†Ø¬Ø§Ø­');
        
        // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
        document.getElementById('newWeekName').value = '';
        document.getElementById('newWeekStart').value = '';
        document.getElementById('newWeekEnd').value = '';
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ù…ÙƒØ§ÙØ£Ø© Ø¬Ø¯ÙŠØ¯Ø©
    function addNewReward() {
        const memberId = parseInt(document.getElementById('rewardMemberSelect').value);
        const title = document.getElementById('rewardTitle').value;
        const points = parseInt(document.getElementById('rewardPoints').value);
        
        if (!memberId || !title || !points) {
            alert('Ø§Ù…Ù„Ø£ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„');
            return;
        }
        
        rewards.push({
            memberId,
            title,
            points,
            date: new Date().toISOString()
        });
        
        saveData();
        showNotification('ØªÙ… Ù…Ù†Ø­ Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ø¨Ù†Ø¬Ø§Ø­');
        
        // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
        document.getElementById('rewardTitle').value = '';
        document.getElementById('rewardPoints').value = '';
    }
    
    // Ø­Ø°Ù ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± Ù…Ø­Ø¯Ø¯
    function deleteAttendanceRecord(index) {
        if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ù‡Ø°Ø§ØŸ')) {
            attendanceRecords.splice(index, 1);
            saveData();
            showNotification('ØªÙ… Ø­Ø°Ù ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±');
        }
    }
    
    // Ø­Ø°Ù Ù…ÙƒØ§ÙØ£Ø© Ù…Ø­Ø¯Ø¯Ø©
    function deleteRewardRecord(index) {
        if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©ØŸ')) {
            rewards.splice(index, 1);
            saveData();
            showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©');
        }
    }
    
    // Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ù„Ø£Ø³Ø¨ÙˆØ¹ Ù…Ø­Ø¯Ø¯
    function deleteAllWeekAttendance() {
        const weekId = parseInt(document.getElementById('deleteWeekSelect').value);
        
        if (!weekId) {
            alert('ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ø£Ø³Ø¨ÙˆØ¹ Ø£ÙˆÙ„Ø§Ù‹');
            return;
        }
        
        if (confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù ÙƒÙ„ ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ± Ù„Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ù…Ø­Ø¯Ø¯ØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!`)) {
            attendanceRecords = attendanceRecords.filter(ar => ar.weekId != weekId);
            saveData();
            showNotification('ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ± Ù„Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹');
        }
    }
    
    // Ø¹Ø±Ø¶ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†
    function showAdminLogin() {
        document.getElementById('adminLoginModal').style.display = 'flex';
    }
    
    // Ø¥Ø®ÙØ§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†
    function hideAdminLogin() {
        document.getElementById('adminLoginModal').style.display = 'none';
    }
    
    // ØªØ£ÙƒÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†
    function confirmAdminLogin() {
        const pwd = document.getElementById('adminPassword').value;
        if (pwd === adminPass) {
            isAdmin = true;
            document.getElementById('adminLoginModal').style.display = 'none';
            document.getElementById('resetDataBtn').style.display = 'inline-block';
            showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø³Ø¤ÙˆÙ„');
        } else {
            alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø®Ø·Ø£!');
        }
    }
    
    // Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    function resetAllData() {
        if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!')) {
            // Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase
            const dataRef = database.ref('angelsAttendance');
            dataRef.remove()
                .then(() => {
                    showNotification('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©');
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
                    setTimeout(() => {
                        location.reload();
                    }, 2000);
                })
                .catch((error) => {
                    console.error('Error removing data:', error);
                    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                });
        }
    }
    
    // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
    function printReport() {
        window.print();
    }
    
    // ØªØµØ¯ÙŠØ± Ù„Ø¥ÙƒØ³Ù„
    function exportToExcel() {
        // ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const data = [];
        
        // Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
        data.push(['Ø§Ù„Ø§Ø³Ù…', 'Ø§Ù„Ù†Ù‚Ø§Ø·', 'Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±', 'Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª']);
        
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
        const totalWeeks = weeks.length;
        
        members.forEach(member => {
            const points = attendanceRecords.filter(ar => 
                ar.memberId === member.id && ar.present
            ).length;
            
            const attendancePercentage = totalWeeks > 0 ? Math.round((points / totalWeeks) * 100) : 0;
            
            const memberRewards = rewards.filter(r => r.memberId === member.id);
            const rewardsText = memberRewards.map(r => r.title).join(', ') || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯';
            
            data.push([member.name, points, `${attendancePercentage}%`, rewardsText]);
        });
        
        // Ø¥Ù†Ø´Ø§Ø¡ workbook
        const ws = XLSX.utils.aoa_to_sheet(data);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ±');
        
        // Ø§Ù„ØªØ­Ù…ÙŠÙ„
        XLSX.writeFile(wb, 'ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ø­Ø¶ÙˆØ±.xlsx');
        showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Excel');
    }
    
    // Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
    const ctx = document.getElementById('attendanceChart').getContext('2d');
    let chart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: members.map(m => m.name),
            datasets: [{
                label: 'Ø§Ù„Ø­Ø¶ÙˆØ±',
                data: Array(members.length).fill(0),
                backgroundColor: ['#3498db', '#2ecc71', '#f39c12', '#9b59b6', '#e74c3c', '#1abc9c', '#34495e', '#f1c40f', '#d35400', '#7f8c8d']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });
    
    function updateChart() {
        const selectedWeekId = document.getElementById('weekSelect').value;
        
        const data = members.map(member => {
            const record = attendanceRecords.find(ar => 
                ar.memberId === member.id && ar.weekId == selectedWeekId
            );
            return record && record.present ? 1 : 0;
        });
        
        chart.data.labels = members.map(m => m.name);
        chart.data.datasets[0].data = data;
        chart.update();
    }
    
    // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    window.addEventListener('load', initApp);
    </script>
</body>
</html>
