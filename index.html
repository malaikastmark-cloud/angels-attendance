let attendanceRecords = [];
        let rewards = [];
        let extraPoints = [];
        let events = [];
        let tasks = [];
        
        // ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±
        const adminPass = 'admin123';
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        function initializeApp() {
            populateData();
            setupEventListeners();
        }
        
        // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        function populateData() {
            populateMembers();
            populateWeeks();
            populateAttendanceTable();
            updateAttendanceStats();
        }
        
        // ØªØ¹Ø¨Ø¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
        function populateMembers() {
            const selectMember = document.getElementById('selectMember');
            const extraPointMember = document.getElementById('extraPointMember');
            const newTaskAssignee = document.getElementById('newTaskAssignee');
            
            // Ù…Ø³Ø­ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ
            selectMember.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ --</option>';
            extraPointMember.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¹Ø¶Ùˆ --</option>';
            newTaskAssignee.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ --</option>';
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
            members.forEach(member => {
                // Ù‚Ø§Ø¦Ù…Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±
                const option = document.createElement('option');
                option.value = member.id;
                option.textContent = member.name;
                selectMember.appendChild(option);
                
                // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
                const extraOption = document.createElement('option');
                extraOption.value = member.id;
                extraOption.textContent = member.name;
                extraPointMember.appendChild(extraOption);
                
                // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† Ø¹Ù† Ø§Ù„Ù…Ù‡Ù…Ø§Øª
                const taskOption = document.createElement('option');
                taskOption.value = member.id;
                taskOption.textContent = member.name;
                newTaskAssignee.appendChild(taskOption);
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            const membersTbody = document.querySelector('#membersTable tbody');
            membersTbody.innerHTML = '';
            
            members.forEach((member, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${index + 1}</td>
                    <td><img src="${member.image}" class="member-img" alt="${member.name}"></td>
                    <td>${member.name}</td>
                    <td>${member.points}</td>
                    <td>${rewards.filter(r => r.memberId === member.id).map(r => r.title).join(', ') || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</td>
                    <td><button class='btn btn-primary editMember' data-id='${member.id}'>ØªØ¹Ø¯ÙŠÙ„</button></td>
                    <td><button class='btn btn-danger deleteMember' data-id='${member.id}'>Ø­Ø°Ù</button></td>
                `;
                membersTbody.appendChild(tr);
            });
            
            document.getElementById('totalMembers').textContent = members.length;
            document.getElementById('reportMembers').textContent = members.length;
        }
        
        // ØªØ¹Ø¨Ø¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹
        function populateWeeks() {
            const weekSelect = document.getElementById('weekSelect');
            const deleteWeekSelect = document.getElementById('deleteWeekSelect');
            
            // Ù…Ø³Ø­ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ
            weekSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ --</option>';
            deleteWeekSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ --</option>';
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹
            weeks.forEach(week => {
                // Ù‚Ø§Ø¦Ù…Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±
                const option = document.createElement('option');
                option.value = week.id;
                option.textContent = week.name;
                weekSelect.appendChild(option);
                
                // Ù‚Ø§Ø¦Ù…Ø© Ø­Ø°Ù Ø§Ù„Ø­Ø¶ÙˆØ±
                const deleteOption = document.createElement('option');
                deleteOption.value = week.id;
                deleteOption.textContent = week.name;
                deleteWeekSelect.appendChild(deleteOption);
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            const weeksTbody = document.querySelector('#weeksTable tbody');
            weeksTbody.innerHTML = '';
            
            weeks.forEach((week, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${week.name}</td>
                    <td>${week.from}</td>
                    <td>${week.to}</td>
                    <td><button class='btn btn-primary editWeek' data-id='${week.id}'>ØªØ¹Ø¯ÙŠÙ„</button></td>
                    <td><button class='btn btn-danger deleteWeek' data-id='${week.id}'>Ø­Ø°Ù</button></td>
                `;
                weeksTbody.appendChild(tr);
            });
            
            document.getElementById('reportWeeks').textContent = weeks.length;
        }
        
        // ØªØ¹Ø¨Ø¦Ø© Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±
        function populateAttendanceTable() {
            const tbody = document.getElementById('attendanceTableBody');
            tbody.innerHTML = '';
            
            const selectedWeekId = document.getElementById('weekSelect').value;
            
            if (!selectedWeekId) {
                tbody.innerHTML = '<tr><td colspan="6">Ø§Ø®ØªØ± Ø£Ø³Ø¨ÙˆØ¹Ø§Ù‹ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>';
                return;
            }
            
            members.forEach((member, index) => {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø³Ø¬Ù„ Ø­Ø¶ÙˆØ± Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶Ùˆ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
                const attendanceRecord = attendanceRecords.find(ar => 
                    ar.memberId === member.id && ar.weekId == selectedWeekId
                );
                
                const isPresent = attendanceRecord ? true : false;
                
                const tr = document.createElement('tr');
                tr.dataset.member = member.id;
                tr.innerHTML = `
                    <td>${index + 1}</td>
                    <td><img src="${member.image}" class="member-img" alt="${member.name}"></td>
                    <td>${member.name}</td>
                    <td>${weeks.find(w => w.id == selectedWeekId)?.name || ''}</td>
                    <td class="attendance-value">${isPresent ? '1' : '0'}</td>
                    <td class="points">${member.points}</td>
                `;
                tbody.appendChild(tr);
            });
            
            populateAttendanceRecords();
        }
        
        // ØªØ¹Ø¨Ø¦Ø© Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±
        function populateAttendanceRecords() {
            const tbody = document.querySelector('#attendanceRecordsBody');
            tbody.innerHTML = '';
            
            if (attendanceRecords.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø­Ø¶ÙˆØ±</td></tr>';
                return;
            }
            
            attendanceRecords.forEach((record, index) => {
                const member = members.find(m => m.id === record.memberId);
                const week = weeks.find(w => w.id == record.weekId);
                
                if (member && week) {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${member.name}</td>
                        <td>${week.name}</td>
                        <td>${new Date(record.date).toLocaleString('ar-EG')}</td>
                        <td><button class='btn btn-danger deleteAttendance' data-id='${record.id}'>Ø­Ø°Ù</button></td>
                    `;
                    tbody.appendChild(tr);
                }
            });
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø­Ø¶ÙˆØ±
        function updateAttendanceStats() {
            const selectedWeekId = document.getElementById('weekSelect').value;
            let count = 0;
            let totalPoints = 0;
            
            if (!selectedWeekId) {
                document.getElementById('attendanceCount').textContent = count;
                document.getElementById('totalPoints').textContent = totalPoints;
                return;
            }
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø­Ø¶ÙˆØ± Ù„Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ÙÙ‚Ø·
            const weekAttendance = attendanceRecords.filter(ar => ar.weekId == selectedWeekId);
            count = weekAttendance.length;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©
            totalPoints = members.reduce((sum, member) => sum + member.points, 0);
            
            document.getElementById('attendanceCount').textContent = count;
            document.getElementById('totalPoints').textContent = totalPoints;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
            document.getElementById('reportAttendance').textContent = attendanceRecords.length;
            document.getElementById('reportPoints').textContent = totalPoints;
            
            updateChart();
            updateTopMembers();
            updateMembersStats();
        }
        
        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù€ 10 Ø§Ù„Ø£ÙˆØ§Ø¦Ù„
        function updateTopMembers() {
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ù„ÙƒÙ„ Ø¹Ø¶Ùˆ
            const memberPoints = members.map(member => {
                return { name: member.name, points: member.points, image: member.image };
            });
            
            // ØªØ±ØªÙŠØ¨ ØªÙ†Ø§Ø²Ù„ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·
            memberPoints.sort((a, b) => b.points - a.points);
            
            // Ø£Ø®Ø° Ø£ÙˆÙ„ 10 ÙÙ‚Ø·
            const top10 = memberPoints.slice(0, 10);
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            const topMembersList = document.getElementById('topMembersList');
            topMembersList.innerHTML = '';
            
            if (top10.length === 0) {
                topMembersList.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>';
                return;
            }
            
            top10.forEach((member, index) => {
                const item = document.createElement('div');
                item.className = 'top-member-item';
                
                let medal = '';
                if (index === 0) medal = '<span class="medal medal-gold">ğŸ¥‡</span>';
                else if (index === 1) medal = '<span class="medal medal-silver">ğŸ¥ˆ</span>';
                else if (index === 2) medal = '<span class="medal medal-bronze">ğŸ¥‰</span>';
                
                item.innerHTML = `
                    <div style="display:flex;align-items:center;gap:10px;">
                        <img src="${member.image}" class="member-img" alt="${member.name}">
                        <div class="top-member-name">${medal} ${member.name}</div>
                    </div>
                    <div class="top-member-points">${member.points} Ù†Ù‚Ø·Ø©</div>
                `;
                topMembersList.appendChild(item);
            });
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
        function updateMembersStats() {
            const container = document.getElementById('membersStatsContainer');
            container.innerHTML = '';
            
            members.forEach(member => {
                const statsDiv = document.createElement('div');
                statsDiv.className = 'member-stats';
                statsDiv.innerHTML = `
                    <img src="${member.image}" class="member-img" alt="${member.name}">
                    <div style="flex:1">
                        <h4>${member.name}</h4>
                        <div style="display:flex;gap:10px;margin-top:5px;">
                            <div class="member-stat-item">
                                <div class="member-stat-value">${member.points}</div>
                                <div class="member-stat-label">Ù†Ù‚Ø§Ø·</div>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(statsDiv);
            });
        }
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        function setupEventListeners() {
            // ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†
            document.getElementById('adminLoginBtn').addEventListener('click', showAdminLogin);
            document.getElementById('cancelAdminLogin').addEventListener('click', hideAdminLogin);
            document.getElementById('confirmAdminLogin').addEventListener('click', confirmAdminLogin);
            
            // Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            document.getElementById('backToUserView').addEventListener('click', backToUserView);
            
            // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
            document.getElementById('addMemberBtn').addEventListener('click', addMember);
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('editMember')) {
                    const id = parseInt(e.target.dataset.id);
                    editMember(id);
                }
                if (e.target.classList.contains('deleteMember')) {
                    const id = parseInt(e.target.dataset.id);
                    deleteMember(id);
                }
            });
            
            // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹
            document.getElementById('addWeekBtn').addEventListener('click', addWeek);
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('editWeek')) {
                    const id = parseInt(e.target.dataset.id);
                    editWeek(id);
                }
                if (e.target.classList.contains('deleteWeek')) {
                    const id = parseInt(e.target.dataset.id);
                    deleteWeek(id);
                }
            });
            
            // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¶ÙˆØ±
            document.getElementById('markPresent').addEventListener('click', markAttendance);
            document.getElementById('deleteAttendanceBtn').addEventListener('click', deleteAllWeekAttendance);
            document.getElementById('addExtraPointsBtn').addEventListener('click', addExtraPoints);
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('deleteAttendance')) {
                    const id = parseInt(e.target.dataset.id);
                    deleteAttendanceRecord(id);
                }
            });
            
            // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª
            document.getElementById('addEventBtn').addEventListener('click', addEvent);
            
            // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ù…Ø§Øª
            document.getElementById('addTaskBtn').addEventListener('click', addTask);
            
            // Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
            document.getElementById('printReportBtn').addEventListener('click', printReport);
            document.getElementById('exportExcelBtn').addEventListener('click', exportToExcel);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
            document.getElementById('weekSelect').addEventListener('change', populateAttendanceTable);
        }
        
        // ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†
        function showAdminLogin() {
            document.getElementById('adminLoginModal').style.display = 'flex';
            document.getElementById('adminPassword').value = '';
            document.getElementById('adminPassword').classList.remove('login-failed');
        }
        
        function hideAdminLogin() {
            document.getElementById('adminLoginModal').style.display = 'none';
        }
        
        function confirmAdminLogin() {
            const pwd = document.getElementById('adminPassword').value;
            if (pwd === adminPass) {
                document.getElementById('adminLoginModal').style.display = 'none';
                document.getElementById('adminTabs').style.display = 'block';
                document.getElementById('userAttendance').style.display = 'none';
                document.getElementById('adminLoginBtn').style.display = 'none';
                showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù† Ø¨Ù†Ø¬Ø§Ø­');
            } else {
                // ØªØ£Ø«ÙŠØ± Ø§Ù‡ØªØ²Ø§Ø² Ø¹Ù†Ø¯ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø³Ø± Ø®Ø§Ø·Ø¦Ø©
                const passwordInput = document.getElementById('adminPassword');
                passwordInput.classList.add('login-failed');
                setTimeout(() => {
                    passwordInput.classList.remove('login-failed');
                }, 500);
                
                showNotification('ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø®Ø§Ø·Ø¦Ø©!', false);
            }
        }
        
        // Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function backToUserView() {
            document.getElementById('adminTabs').style.display = 'none';
            document.getElementById('userAttendance').style.display = 'block';
            document.getElementById('adminLoginBtn').style.display = 'block';
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ Ø¬Ø¯ÙŠØ¯
        function addMember() {
            const name = document.getElementById('newMemberName').value;
            const emoji = document.getElementById('newMemberEmoji').value;
            const image = document.getElementById('newMemberImage').value;
            
            if (!name) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ø¶Ùˆ', false);
                return;
            }
            
            const newMember = {
                id: members.length > 0 ? Math.max(...members.map(m => m.id)) + 1 : 1,
                name: `${emoji} ${name}`,
                image: image || `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=3498db&color=fff`,
                points: 0
            };
            
            members.push(newMember);
            showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø¶Ùˆ Ø¨Ù†Ø¬Ø§Ø­');
            
            // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('newMemberName').value = '';
            document.getElementById('newMemberImage').value = '';
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            populateData();
        }
        
        // ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø¶Ùˆ
        function editMember(id) {
            const member = members.find(m => m.id === id);
            if (!member) return;
            
            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ ÙˆØ§Ù„Ø§Ø³Ù…
            const emoji = member.name.charAt(0);
            const currentName = member.name.substring(2);
            
            const newName = prompt('Ø¹Ø¯Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ø¶Ùˆ:', currentName);
            const newImage = prompt('Ø¹Ø¯Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ø¥Ø°Ø§ Ù„Ø§ ØªØ±ÙŠØ¯ ØªØºÙŠÙŠØ±Ù‡):', member.image);
            
            if (newName) {
                member.name = `${emoji} ${newName}`;
                if (newImage) member.image = newImage;
                showNotification('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø¶Ùˆ');
                populateData();
            }
        }
        
        // Ø­Ø°Ù Ø¹Ø¶Ùˆ
        function deleteMember(id) {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø¹Ø¶ÙˆØŸ')) {
                members = members.filter(m => m.id !== id);
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ø¶Ùˆ');
                populateData();
            }
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ø¨ÙˆØ¹ Ø¬Ø¯ÙŠØ¯
        function addWeek() {
            const name = document.getElementById('newWeekName').value;
            const from = document.getElementById('newWeekStart').value;
            const to = document.getElementById('newWeekEnd').value;
            
            if (!name || !from || !to) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', false);
                return;
            }
            
            const newWeek = {
                id: weeks.length > 0 ? Math.max(...weeks.map(w => w.id)) + 1 : 1,
                name: name,
                from: from,
                to: to
            };
            
            weeks.push(newWeek);
            showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø¨Ù†Ø¬Ø§Ø­');
            
            // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('newWeekName').value = '';
            document.getElementById('newWeekStart').value = '';
            document.getElementById('newWeekEnd').value = '';
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            populateData();
        }
        
        // ØªØ¹Ø¯ÙŠÙ„ Ø£Ø³Ø¨ÙˆØ¹
        function editWeek(id) {
            const week = weeks.find(w => w.id === id);
            if (!week) return;
            
            const newName = prompt('Ø¹Ø¯Ù„ Ø§Ø³Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹:', week.name);
            const newFrom = prompt('Ø¹Ø¯Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©:', week.from);
            const newTo = prompt('Ø¹Ø¯Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©:', week.to);
            
            if (newName && newFrom && newTo) {
                week.name = newName;
                week.from = newFrom;
                week.to = newTo;
                showNotification('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹');
                populateData();
            }
        }
        
        // Ø­Ø°Ù Ø£Ø³Ø¨ÙˆØ¹
        function deleteWeek(id) {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ØŸ')) {
                weeks = weeks.filter(w => w.id !== id);
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹');
                populateData();
            }
        }
        
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±
        function markAttendance() {
            const memberId = parseInt(document.getElementById('selectMember').value);
            const weekId = parseInt(document.getElementById('weekSelect').value);
            
            if (!memberId || !weekId) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ø¶Ùˆ ÙˆØ§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø£ÙˆÙ„Ø§Ù‹', false);
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ù…Ø³Ø¨Ù‚Ø§Ù‹
            const existingRecord = attendanceRecords.find(ar => 
                ar.memberId === memberId && ar.weekId == weekId
            );
            
            if (existingRecord) {
                showNotification('Ù„Ù‚Ø¯ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶Ùˆ already ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹', false);
                return;
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ø¬Ø¯ÙŠØ¯
            const newAttendance = {
                id: attendanceRecords.length > 0 ? Math.max(...attendanceRecords.map(ar => ar.id)) + 1 : 1,
                memberId: memberId,
                weekId: weekId,
                date: new Date().toISOString()
            };
            
            attendanceRecords.push(newAttendance);
            
            // Ø²ÙŠØ§Ø¯Ø© Ù†Ù‚Ø§Ø· Ø§Ù„Ø¹Ø¶Ùˆ
            const member = members.find(m => m.id === memberId);
            if (member) {
                member.points += 1;
            }
            
            showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­!');
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            populateData();
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø§Ø· Ø¥Ø¶Ø§ÙÙŠØ©
        function addExtraPoints() {
            const memberId = parseInt(document.getElementById('extraPointMember').value);
            const points = parseInt(document.getElementById('extraPointsValue').value);
            const reason = document.getElementById('extraPointsReason').value;
            
            if (!memberId || !points || !reason) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', false);
                return;
            }
            
            // Ø²ÙŠØ§Ø¯Ø© Ù†Ù‚Ø§Ø· Ø§Ù„Ø¹Ø¶Ùˆ
            const member = members.find(m => m.id === memberId);
            if (member) {
                member.points += points;
                
                // Ø­ÙØ¸ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
                const newExtraPoints = {
                    id: extraPoints.length > 0 ? Math.max(...extraPoints.map(ep => ep.id)) + 1 : 1,
                    memberId: memberId,
                    points: points,
                    reason: reason,
                    date: new Date().toISOString()
                };
                
                extraPoints.push(newExtraPoints);
                
                showNotification(`ØªÙ… Ø¥Ø¶Ø§ÙØ© ${points} Ù†Ù‚Ø·Ø© Ø¥Ù„Ù‰ ${member.name} Ø¨Ø³Ø¨Ø¨: ${reason}`);
                
                // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
                document.getElementById('extraPointsValue').value = '1';
                document.getElementById('extraPointsReason').value = '';
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                populateData();
            }
        }
        
        // Ø­Ø°Ù ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±
        function deleteAttendanceRecord(id) {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ù‡Ø°Ø§ØŸ')) {
                const record = attendanceRecords.find(ar => ar.id === id);
                if (record) {
                    // Ø®ØµÙ… Ø§Ù„Ù†Ù‚Ø§Ø· Ù…Ù† Ø§Ù„Ø¹Ø¶Ùˆ
                    const member = members.find(m => m.id === record.memberId);
                    if (member) {
                        member.points = Math.max(0, member.points - 1);
                    }
                }
                
                attendanceRecords = attendanceRecords.filter(ar => ar.id !== id);
                showNotification('ØªÙ… Ø­Ø°Ù ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±');
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                populateData();
            }
        }
        
        // Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ù„Ø£Ø³Ø¨ÙˆØ¹ Ù…Ø­Ø¯Ø¯
        function deleteAllWeekAttendance() {
            const weekId = parseInt(document.getElementById('deleteWeekSelect').value);
            
            if (!weekId) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø£Ø³Ø¨ÙˆØ¹ Ø£ÙˆÙ„Ø§Ù‹', false);
                return;
            }
            
            if (confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù ÙƒÙ„ ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ± Ù„Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ù…Ø­Ø¯Ø¯ØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!`)) {
                // Ø®ØµÙ… Ø§Ù„Ù†Ù‚Ø§Ø· Ù…Ù† Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
                const weekRecords = attendanceRecords.filter(ar => ar.weekId == weekId);
                weekRecords.forEach(record => {
                    const member = members.find(m => m.id === record.memberId);
                    if (member) {
                        member.points = Math.max(0, member.points - 1);
                    }
                });
                
                attendanceRecords = attendanceRecords.filter(ar => ar.weekId != weekId);
                showNotification('ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ± Ù„Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹');
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                populateData();
            }
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø§Ø³Ø¨Ø©
        function addEvent() {
            const name = document.getElementById('newEventName').value;
            const date = document.getElementById('newEventDate').value;
            const description = document.getElementById('newEventDescription').value;
            
            if (!name || !date || !description) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', false);
                return;
            }
            
            const newEvent = {
                id: events.length > 0 ? Math.max(...events.map(e => e.id)) + 1 : 1,
                name: name,
                date: date,
                description: description
            };
            
            events.push(newEvent);
            showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ø¨Ù†Ø¬Ø§Ø­');
            
            // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('newEventName').value = '';
            document.getElementById('newEventDate').value = '';
            document.getElementById('newEventDescription').value = '';
            
            // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª
            const eventsTbody = document.querySelector('#eventsTable tbody');
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${events.length}</td>
                <td>${newEvent.name}</td>
                <td>${newEvent.date}</td>
                <td>${newEvent.description}</td>
                <td><button class='btn btn-primary editEvent'>ØªØ¹Ø¯ÙŠÙ„</button></td>
                <td><button class='btn btn-danger deleteEvent'>Ø­Ø°Ù</button></td>
            `;
            eventsTbody.appendChild(tr);
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©
        function addTask() {
            const name = document.getElementById('newTaskName').value;
            const assigneeId = parseInt(document.getElementById('newTaskAssignee').value);
            const deadline = document.getElementById('newTaskDeadline').value;
            
            if (!name || !assigneeId || !deadline) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', false);
                return;
            }
            
            const assignee = members.find(m => m.id === assigneeId);
            if (!assignee) {
                showNotification('Ø§Ù„Ø¹Ø¶Ùˆ Ø§Ù„Ù…Ø­Ø¯Ø¯ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', false);
                return;
            }
            
            const newTask = {
                id: tasks.length > 0 ? Math.max(...tasks.map(t => t.id)) + 1 : 1,
                name: name,
                assigneeId: assigneeId,
                assigneeName: assignee.name,
                deadline: deadline,
                status: 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°'
            };
            
            tasks.push(newTask);
            showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­');
            
            // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('newTaskName').value = '';
            document.getElementById('newTaskAssignee').value = '';
            document.getElementById('newTaskDeadline').value = '';
            
            // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù‡Ù…Ø§Øª
            const tasksTbody = document.querySelector('#tasksTable tbody');
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${tasks.length}</td>
                <td>${newTask.name}</td>
                <td>${newTask.assigneeName}</td>
                <td>${newTask.deadline}</td>
                <td><span class="badge btn-warning">${newTask.status}</span></td>
                <td><button class='btn btn-primary editTask'>ØªØ¹Ø¯ÙŠÙ„</button></td>
                <td><button class='btn btn-danger deleteTask'>Ø­Ø°Ù</button></td>
            `;
            tasksTbody.appendChild(tr);
        }
        
        // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
        function printReport() {
            window.print();
        }
        
        // ØªØµØ¯ÙŠØ± Ù„Ø¥ÙƒØ³Ù„
        function exportToExcel() {
            // ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const data = [];
            
            // Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
            data.push(['Ø§Ù„Ø§Ø³Ù…', 'Ø§Ù„Ù†Ù‚Ø§Ø·', 'Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª']);
            
            // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
            members.forEach(member => {
                const rewardsText = rewards.filter(r => r.memberId === member.id)
                    .map(r => r.title).join(', ') || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯';
                
                data.push([member.name, member.points, rewardsText]);
            });
            
            // Ø¥Ù†Ø´Ø§Ø¡ workbook
            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ±');
            
            // Ø§Ù„ØªØ­Ù…ÙŠÙ„
            XLSX.writeFile(wb, 'ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ø­Ø¶ÙˆØ±.xlsx');
        }
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        function showNotification(message, isSuccess = true) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.background = isSuccess ? '#2ecc71' : '#e74c3c';
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ
        const ctx = document.getElementById('attendanceChart').getContext('2d');
        let chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: [],
                datasets: [{
                    label: 'Ø§Ù„Ø­Ø¶ÙˆØ±',
                    data: [],
                    backgroundColor: ['#3498db','#2ecc71','#f39c12']
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
        
        function updateChart() {
            const selectedWeekId = document.getElementById('weekSelect').value;
            
            if (!selectedWeekId) {
                chart.data.labels = [];
                chart.data.datasets[0].data = [];
                chart.update();
                return;
            }
            
            const data = members.map(member => {
                const record = attendanceRecords.find(ar => 
                    ar.memberId === member.id && ar.weekId == selectedWeekId
                );
                return record ? 1 : 0;
            });
            
            chart.data.labels = members.map(m => m.name);
            chart.data.datasets[0].data = data;
            chart.update();
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
