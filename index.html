<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุธุงู ุญุถูุฑ ุฎุฏุงู ุงูููุงููุฉ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body data-theme="light">
    <div class="container">
        <div class="header">
            <div class="version">v32.0 Modular</div>
            <h1>๐ ูุธุงู ุญุถูุฑ ุฎุฏุงู ุงูููุงููุฉ</h1>
            <p>ูุธุงู Talanton Pro - ููุณู ุฅูู ูููุงุช ูููุตูุฉ</p>
        </div>

        <div id="firebaseStatus" class="firebase-status firebase-disconnected">
            ๐ก ุฌุงุฑู ุงูุงุชุตุงู ุจู Firebase...
        </div>

        <div class="controls">
            <button class="btn" onclick="toggleTheme()">
                <span id="themeIcon">๐</span> ุชุจุฏูู ุงููุถุน
            </button>
            <button class="btn" onclick="showAdminLogin()">๐ ุฏุฎูู ุงูุฃุฏูู</button>
            <button class="btn btn-info" onclick="generateQRCodes()">๐ฑ ุฅูุดุงุก QR ููุฏุงุช</button>
            <button class="btn btn-warning" onclick="showMemberLoginModal()">๐ค ุฏุฎูู ุนุถู</button>
        </div>

        <div id="mainContent">
            <div class="card">
                <h2>๐ ุฅุญุตุงุฆูุงุช ุณุฑูุนุฉ</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalMembers">0</div>
                        <div class="stat-label">ุฅุฌูุงูู ุงูุฃุนุถุงุก</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="presentToday">0</div>
                        <div class="stat-label">ุงูุญุงุถุฑูู ุงูููู</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalTalanton">0</div>
                        <div class="stat-label">ุฅุฌูุงูู Talanton</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="weeklyAttendance">0%</div>
                        <div class="stat-label">ูุณุจุฉ ุงูุญุถูุฑ ุงูุฃุณุจูุนู</div>
                    </div>
                </div>
            </div>

            <div id="birthdayAlerts"></div>

            <div class="card">
                <h2>โก ุงูุญุถูุฑ ุงูุณุฑูุน</h2>
                <div class="quick-attendance-input">
                    <p style="margin-bottom: 15px;">ุฃุฏุฎู ุงูุฑูู ุงูุชุณูุณูู ููุนุถู:</p>
                    <input type="number" id="quickAttendanceInput" class="quick-input" placeholder="ุฑูู ุงูุนุถู" min="1">
                    <button class="btn btn-success" onclick="quickAttendanceByNumber()" style="margin-left: 10px;">
                        โ ุญุถูุฑ ุณุฑูุน
                    </button>
                </div>
            </div>

            <div class="card">
                <h2>๐ฅ ุงุฎุชูุงุฑ ุงูุนุถู ููุญุถูุฑ</h2>
                <div class="member-selector">
                    <select class="member-dropdown" id="memberDropdown" onchange="selectMemberFromDropdown()">
                        <option value="">ุงุฎุชุฑ ุนุถู...</option>
                    </select>
                </div>
                <div id="memberInfoDisplay" class="member-info-display">
                    <div id="selectedMemberInfo"></div>
                    <div class="action-buttons">
                        <button class="btn btn-success" onclick="showAttendanceModal()">โ ุชุณุฌูู ุงูุญุถูุฑ</button>
                        <button class="btn btn-info" onclick="showMemberProfile()">๐ค ุนุฑุถ ุงูููู ุงูุดุฎุตู</button>
                        <button class="btn btn-warning" onclick="showMemberTasks()">๐ ุงูููุงู ุงููุทููุจุฉ</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>๐ ูุชุฌุฑ Talanton</h2>
                <div id="storeDisplay" class="store-grid"></div>
            </div>

            <div class="card">
                <h2>๐ ููุงุณุจุงุช ุงูููู</h2>
                <div id="todayEvents"></div>
            </div>

            <div class="card">
                <h2>๐ ุงูุฑุณูู ุงูุจูุงููุฉ</h2>
                <div class="chart-container">
                    <canvas id="attendanceChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h2>๐ ููุญุฉ ุงูุดุฑู</h2>
                <div id="leaderboard"></div>
            </div>
        </div>

        <!-- Member Panel -->
        <div id="memberPanel" class="member-panel">
            <div class="card">
                <h2>๐ค ููุญุฉ ุงูุนุถู</h2>
                <div id="memberDashboard"></div>
                <div class="action-buttons">
                    <button class="btn btn-danger" onclick="logoutMember()">๐ช ุชุณุฌูู ุฎุฑูุฌ</button>
                    <button class="btn btn-info" onclick="showMyProfile()">๐ค ูููู ุงูุดุฎุตู</button>
                    <button class="btn btn-success" onclick="showMyTasks()">๐ ููุงูู</button>
                    <button class="btn btn-warning" onclick="showMyHistory()">๐ ุชุงุฑูุฎ ุงูููุงุท</button>
                </div>
            </div>
        </div>

        <!-- Admin Panel -->
        <div id="adminPanel" class="admin-panel">
            <div class="card">
                <h2>๐ ููุญุฉ ุชุญูู ุงูุฃุฏูู</h2>
                <div class="action-buttons">
                    <button class="btn btn-danger" onclick="logoutAdmin()">๐ช ุชุณุฌูู ุฎุฑูุฌ</button>
                    <button class="btn btn-success" onclick="showAddMemberModal()">โ ุฅุถุงูุฉ ุนุถู</button>
                    <button class="btn btn-info" onclick="showMembersReport()">๐ ุชูุฑูุฑ ุงูุฃุนุถุงุก</button>
                    <button class="btn btn-warning" onclick="showAttendanceReport()">๐ ุชูุฑูุฑ ุงูุญุถูุฑ</button>
                    <button class="btn btn-success" onclick="exportData()">๐พ ุชุตุฏูุฑ ุงูุจูุงูุงุช</button>
                </div>
                
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="showTab('members')">๐ฅ ุฅุฏุงุฑุฉ ุงูุฃุนุถุงุก</button>
                    <button class="tab-btn" onclick="showTab('products')">๐ช ุฅุฏุงุฑุฉ ุงููุชุฌุฑ</button>
                    <button class="tab-btn" onclick="showTab('tasks')">๐ ุฅุฏุงุฑุฉ ุงูููุงู</button>
                    <button class="tab-btn" onclick="showTab('occasions')">๐ ุฅุฏุงุฑุฉ ุงูููุงุณุจุงุช</button>
                    <button class="tab-btn" onclick="showTab('attendance')">๐ ุฅุฏุงุฑุฉ ุงูุญุถูุฑ</button>
                    <button class="tab-btn" onclick="showTab('reports')">๐ ุงูุชูุงุฑูุฑ</button>
                </div>

                <div id="membersTab" class="tab-content active">
                    <div id="membersTable"></div>
                </div>

                <div id="productsTab" class="tab-content">
                    <button class="add-button" onclick="showAddProductModal()">โ ุฅุถุงูุฉ ููุชุฌ ุฌุฏูุฏ</button>
                    <div id="productsTable"></div>
                </div>

                <div id="tasksTab" class="tab-content">
                    <button class="add-button" onclick="showAddTaskModal()">โ ุฅุถุงูุฉ ูููุฉ ุฌุฏูุฏุฉ</button>
                    <div id="tasksTable"></div>
                </div>

                <div id="occasionsTab" class="tab-content">
                    <button class="add-button" onclick="showAddOccasionModal()">โ ุฅุถุงูุฉ ููุงุณุจุฉ ุฌุฏูุฏุฉ</button>
                    <div id="occasionsTable"></div>
                </div>

                <div id="attendanceTab" class="tab-content">
                    <div id="attendanceTable"></div>
                </div>

                <div id="reportsTab" class="tab-content">
                    <div id="reportContent"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- All Modals -->
    <div id="adminLoginModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('adminLoginModal')">&times;</span>
            <h2>๐ ุฏุฎูู ุงูุฃุฏูู</h2>
            <div class="form-group">
                <label>ูููุฉ ุงููุฑูุฑ:</label>
                <input type="password" id="adminPassword" placeholder="ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ">
            </div>
            <button class="btn" onclick="adminLogin()">ุฏุฎูู</button>
        </div>
    </div>

    <div id="memberLoginModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('memberLoginModal')">&times;</span>
            <h2>๐ค ุฏุฎูู ุงูุนุถู</h2>
            <div class="form-group">
                <label>ุงุฎุชุฑ ุงุณูู:</label>
                <select id="memberLoginDropdown">
                    <option value="">ุงุฎุชุฑ ุนุถู...</option>
                </select>
            </div>
            <div class="form-group">
                <label>ูููุฉ ุงููุฑูุฑ:</label>
                <input type="password" id="memberLoginPassword" placeholder="ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ">
            </div>
            <button class="btn" onclick="memberLogin()">ุฏุฎูู</button>
        </div>
    </div>

    <div id="attendanceModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('attendanceModal')">&times;</span>
            <h2 id="attendanceTitle">ุชุณุฌูู ุงูุญุถูุฑ</h2>
            
            <div class="fingerprint-scanner">
                <div class="fingerprint-icon" onclick="simulateFingerprint()">๐</div>
                <p>ุงุถุบุท ุนูู ุงูุจุตูุฉ ุฃู ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ</p>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>ูููุฉ ุงููุฑูุฑ ุงูุดุฎุตูุฉ:</label>
                    <input type="password" id="memberPassword" placeholder="ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ">
                </div>
                <div class="form-group">
                    <label>ููุน ุงูุญุถูุฑ:</label>
                    <select id="attendanceType">
                        <option value="regular">ุญุถูุฑ ุนุงุฏู</option>
                        <option value="late">ุญุถูุฑ ูุชุฃุฎุฑ</option>
                        <option value="early">ุญุถูุฑ ูุจูุฑ</option>
                        <option value="makeup">ุญุถูุฑ ุชุนููุถู</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label>ููุงุญุธุงุช (ุงุฎุชูุงุฑู):</label>
                <textarea id="attendanceNotes" rows="3" placeholder="ุฃุถู ููุงุญุธุงุช ุญูู ุงูุญุถูุฑ..."></textarea>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-success" onclick="markAttendance()">โ ุชุณุฌูู ุงูุญุถูุฑ</button>
            </div>
        </div>
    </div>

    <div id="addMemberModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addMemberModal')">&times;</span>
            <h2>โ ุฅุถุงูุฉ ุนุถู ุฌุฏูุฏ</h2>
            <form onsubmit="addMember(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>ุงุณู ุงูุนุถู:</label>
                        <input type="text" id="memberName" required>
                    </div>
                    <div class="form-group">
                        <label>ูููุฉ ุงููุฑูุฑ:</label>
                        <input type="password" id="memberPass" value="1234" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:</label>
                        <input type="email" id="memberEmail">
                    </div>
                    <div class="form-group">
                        <label>ุฑูู ุงููุงุชู:</label>
                        <input type="tel" id="memberPhone">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ุชุงุฑูุฎ ุงููููุงุฏ:</label>
                        <input type="date" id="memberBirthday">
                    </div>
                    <div class="form-group">
                        <label>ุฑุตูุฏ Talanton ุงูุฃููู:</label>
                        <input type="number" id="initialTalanton" value="100" min="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ุงูุฎุฏูุฉ:</label>
                        <select id="memberService">
                            <option value="altar">ุฎุฏูุฉ ุงููุฐุจุญ</option>
                            <option value="sunday_school">ูุฏุฑุณุฉ ุงูุฃุญุฏ</option>
                            <option value="youth">ุฎุฏูุฉ ุงูุดุจุงุจ</option>
                            <option value="music">ุงูุฃูุญุงู ูุงูููุณููู</option>
                            <option value="media">ุงูุฅุนูุงู</option>
                            <option value="social">ุงูุฎุฏูุฉ ุงูุงุฌุชูุงุนูุฉ</option>
                            <option value="other">ุฃุฎุฑู</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ุงูููุทูุฉ:</label>
                        <input type="text" id="memberArea" placeholder="ุงูููุทูุฉ ุงูุณูููุฉ">
                    </div>
                </div>
                <button type="submit" class="btn btn-success">ุฅุถุงูุฉ ุงูุนุถู</button>
            </form>
        </div>
    </div>

    <div id="addProductModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addProductModal')">&times;</span>
            <h2>โ ุฅุถุงูุฉ ููุชุฌ ุฌุฏูุฏ</h2>
            <form onsubmit="addProduct(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>ุงุณู ุงูููุชุฌ:</label>
                        <input type="text" id="productName" required>
                    </div>
                    <div class="form-group">
                        <label>ุงูุณุนุฑ (ููุงุท Talanton):</label>
                        <input type="number" id="productPrice" min="1" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ุงููุฎุฒูู:</label>
                        <input type="number" id="productStock" min="0" required>
                    </div>
                    <div class="form-group">
                        <label>ุงููุฆุฉ:</label>
                        <select id="productCategory">
                            <option value="books">ูุชุจ</option>
                            <option value="accessories">ุฅูุณุณูุงุฑุงุช</option>
                            <option value="certificates">ุดูุงุฏุงุช</option>
                            <option value="gifts">ูุฏุงูุง</option>
                            <option value="clothing">ููุงุจุณ</option>
                            <option value="other">ุฃุฎุฑู</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>ูุตู ุงูููุชุฌ:</label>
                    <textarea id="productDescription" rows="3" placeholder="ูุตู ุงูููุชุฌ..."></textarea>
                </div>
                <button type="submit" class="btn btn-success">ุฅุถุงูุฉ ุงูููุชุฌ</button>
            </form>
        </div>
    </div>

    <div id="purchaseModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('purchaseModal')">&times;</span>
            <h2 id="purchaseTitle">ุดุฑุงุก ููุชุฌ</h2>
            <div id="purchaseDetails"></div>
            <div class="action-buttons">
                <button class="btn btn-success" onclick="confirmPurchase()">ุชุฃููุฏ ุงูุดุฑุงุก</button>
                <button class="btn btn-secondary" onclick="closeModal('purchaseModal')">ุฅูุบุงุก</button>
            </div>
        </div>
    </div>

    <!-- Load JavaScript Files -->
    <script type="module" src="firebase-config.js"></script>
    <script src="app.js"></script>
    <script src="admin.js"></script>
    <script src="member.js"></script>
</body>
</html>
// Firebase Configuration and Initialization
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
import { getAnalytics } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-analytics.js';
import { 
    getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, 
    doc, query, orderBy, onSnapshot, setDoc, serverTimestamp, where, limit
} from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';

const firebaseConfig = {
    apiKey: "AIzaSyBHso7dhJC7P_akMQQ0oN_8ZMTQqsRoVbY",
    authDomain: "angel-meeting-attendance.firebaseapp.com",
    projectId: "angel-meeting-attendance",
    storageBucket: "angel-meeting-attendance.firebasestorage.app",
    messagingSenderId: "100624957418",
    appId: "1:100624957418:web:291d087797cec9ec79fc93",
    measurementId: "G-2TTXV6CD8F"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const db = getFirestore(app);

// Make Firebase available globally
window.firebaseApp = app;
window.firebaseDb = db;
window.firebaseAnalytics = analytics;
window.firebaseUtils = { 
    addDoc, getDocs, updateDoc, deleteDoc, doc, collection, query, 
    orderBy, onSnapshot, setDoc, serverTimestamp, where, limit 
};

console.log('๐ฅ Firebase initialized successfully');

// Test Firebase connection
window.testFirebaseConnection = async function() {
    try {
        const testDoc = await addDoc(collection(db, 'connection_test'), {
            message: 'Firebase connection successful',
            timestamp: serverTimestamp(),
            browser: navigator.userAgent,
            url: window.location.href
        });
        console.log('โ Firebase connection test successful:', testDoc.id);
        return true;
    } catch (error) {
        console.error('โ Firebase connection test failed:', error);
        return false;
    }
};

// Initialize Firebase listeners when DOM is ready
document.addEventListener('DOMContentLoaded', function() {
    const statusElement = document.getElementById('firebaseStatus');
    if (statusElement) {
        statusElement.className = 'firebase-status firebase-connected';
        statusElement.innerHTML = '๐ข ูุชุตู ุจู Firebase - ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ ููุนูุฉ';
    }
    
    // Test connection and initialize
    testFirebaseConnection().then(success => {
        if (success) {
            console.log('๐ Firebase ready - initializing system');
            if (window.initializeCompleteSystem) {
                window.initializeCompleteSystem();
            }
        } else {
            console.error('๐จ Firebase connection failed - check configuration');
        }
    });
});

export { app, db, analytics };
// Main Application Logic
let currentMember = null, currentProduct = null, isAdmin = false, isMemberLoggedIn = false;
let members = [], products = [], tasks = [], occasions = [], weeks = [], attendance = [], talantonHistory = [];
let settings = { dailyAttendancePoints: 10, taskCompletionPoints: 5, birthdayAlertDays: 7, maxAbsenceDays: 3 };
let firebaseListeners = [];

const memberLevels = [
    { id: 1, name: 'ูุจุชุฏุฆ', minPoints: 0, maxPoints: 100, color: 'level-beginner', icon: '๐ฑ' },
    { id: 2, name: 'ูุชูุณุท', minPoints: 101, maxPoints: 300, color: 'level-intermediate', icon: '๐ฟ' },
    { id: 3, name: 'ูุชูุฏู', minPoints: 301, maxPoints: 600, color: 'level-advanced', icon: '๐ณ' },
    { id: 4, name: 'ุฎุจูุฑ', minPoints: 601, maxPoints: 1000, color: 'level-expert', icon: 'โญ' },
    { id: 5, name: 'ุฃุณุทูุฑุฉ', minPoints: 1001, maxPoints: 999999, color: 'level-legend', icon: '๐' }
];

// Initialize Complete System
window.initializeCompleteSystem = function() {
    console.log('๐ ุชููุฆุฉ ุงููุธุงู ุงููุงูู...');
    
    setTimeout(() => {
        initializeFirebaseListeners();
        loadDataFromFirebase();
        initializeUI();
        showNotification('๐ฅ ุงููุธุงู ุงููุงูู ูุชุตู ุจู Firebase ูุน ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ!', 'success');
    }, 1000);
};

// Initialize UI
function initializeUI() {
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.body.setAttribute('data-theme', savedTheme);
    const themeIcon = document.getElementById('themeIcon');
    if (themeIcon) themeIcon.textContent = savedTheme === 'light' ? '๐' : 'โ๏ธ';
}

// Firebase Real-time Listeners
function initializeFirebaseListeners() {
    if (!window.firebaseDb || !window.firebaseUtils) {
        console.error('โ Firebase not ready');
        setTimeout(initializeFirebaseListeners, 2000);
        return;
    }

    try {
        console.log('๐ง ุชูุนูู Firebase Real-time Listeners...');

        // Members listener
        const membersQuery = window.firebaseUtils.query(
            window.firebaseUtils.collection(window.firebaseDb, 'members'),
            window.firebaseUtils.orderBy('name')
        );
        
        const unsubscribeMembers = window.firebaseUtils.onSnapshot(membersQuery, (snapshot) => {
            console.log('๐ฅ ุชุญุฏูุซ ุชููุงุฆู ููุฃุนุถุงุก ูู Firebase');
            
            const newMembers = [];
            snapshot.forEach((doc) => {
                newMembers.push({ id: doc.id, ...doc.data() });
            });
            
            const oldCount = members.length;
            members = newMembers;
            sortMembersAlphabetically();
            updateUIComplete();
            
            if (oldCount > 0) {
                showNotification(`ุชู ุชุญุฏูุซ ุจูุงูุงุช ุงูุฃุนุถุงุก ุชููุงุฆูุงู - ุงูุนุฏุฏ: ${newMembers.length}`, 'success');
            }
        });

        // Products listener
        const productsQuery = window.firebaseUtils.query(
            window.firebaseUtils.collection(window.firebaseDb, 'products')
        );
        
        const unsubscribeProducts = window.firebaseUtils.onSnapshot(productsQuery, (snapshot) => {
            console.log('๐ฅ ุชุญุฏูุซ ุชููุงุฆู ููููุชุฌุงุช ูู Firebase');
            const newProducts = [];
            snapshot.forEach((doc) => {
                newProducts.push({ id: doc.id, ...doc.data() });
            });
            
            products = newProducts;
            loadStoreDisplay();
            if (isAdmin && window.loadProductsTable) window.loadProductsTable();
        });

        // Attendance listener
        const attendanceQuery = window.firebaseUtils.query(
            window.firebaseUtils.collection(window.firebaseDb, 'attendance'),
            window.firebaseUtils.orderBy('timestamp', 'desc')
        );
        
        const unsubscribeAttendance = window.firebaseUtils.onSnapshot(attendanceQuery, (snapshot) => {
            console.log('๐ฅ ุชุญุฏูุซ ุชููุงุฆู ููุญุถูุฑ ูู Firebase');
            const newAttendance = [];
            snapshot.forEach((doc) => {
                newAttendance.push({ id: doc.id, ...doc.data() });
            });
            
            attendance = newAttendance;
            updateStats();
            updateCharts();
        });

        firebaseListeners = [unsubscribeMembers, unsubscribeProducts, unsubscribeAttendance];
        console.log('โ ุชู ุชูุนูู ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ ุจูุฌุงุญ');

    } catch (error) {
        console.error('โ ุฎุทุฃ ูู ุชูุนูู ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ:', error);
        showNotification('ุฎุทุฃ ูู ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ', 'error');
        setTimeout(initializeFirebaseListeners, 5000);
    }
}

// Load initial data from Firebase
async function loadDataFromFirebase() {
    try {
        showNotification('ุฌุงุฑู ุชุญููู ุงูุจูุงูุงุช ูู Firebase...', 'info');
        
        await Promise.all([
            loadMembersFromFirebase(),
            loadProductsFromFirebase(),
            loadTasksFromFirebase(),
            loadOccasionsFromFirebase(),
            loadAttendanceFromFirebase(),
            loadTalantonHistoryFromFirebase()
        ]);

        if (members.length === 0) {
            await initializeDemoDataInFirebase();
        }

        updateUIComplete();
        checkBirthdays();
        initializeCharts();
        loadTodayOccasions();

        console.log('โ ุชู ุชุญููู ุฌููุน ุงูุจูุงูุงุช ูู Firebase');
        showNotification('ุชู ุชุญููู ุงูุจูุงูุงุช ุจูุฌุงุญ!', 'success');

    } catch (error) {
        console.error('โ ุฎุทุฃ ูู ุชุญููู ุงูุจูุงูุงุช:', error);
        showNotification('ุฎุทุฃ ูู ุชุญููู ุงูุจูุงูุงุช', 'warning');
        await initializeDemoDataInFirebase();
    }
}

// Load specific collections
async function loadMembersFromFirebase() {
    const snapshot = await window.firebaseUtils.getDocs(
        window.firebaseUtils.collection(window.firebaseDb, 'members')
    );
    members = [];
    snapshot.forEach((doc) => {
        members.push({ id: doc.id, ...doc.data() });
    });
    sortMembersAlphabetically();
}

async function loadProductsFromFirebase() {
    const snapshot = await window.firebaseUtils.getDocs(
        window.firebaseUtils.collection(window.firebaseDb, 'products')
    );
    products = [];
    snapshot.forEach((doc) => {
        products.push({ id: doc.id, ...doc.data() });
    });
}

async function loadTasksFromFirebase() {
    const snapshot = await window.firebaseUtils.getDocs(
        window.firebaseUtils.collection(window.firebaseDb, 'tasks')
    );
    tasks = [];
    snapshot.forEach((doc) => {
        tasks.push({ id: doc.id, ...doc.data() });
    });
}

async function loadOccasionsFromFirebase() {
    const snapshot = await window.firebaseUtils.getDocs(
        window.firebaseUtils.collection(window.firebaseDb, 'occasions')
    );
    occasions = [];
    snapshot.forEach((doc) => {
        occasions.push({ id: doc.id, ...doc.data() });
    });
}

async function loadAttendanceFromFirebase() {
    const snapshot = await window.firebaseUtils.getDocs(
        window.firebaseUtils.collection(window.firebaseDb, 'attendance')
    );
    attendance = [];
    snapshot.forEach((doc) => {
        attendance.push({ id: doc.id, ...doc.data() });
    });
}

async function loadTalantonHistoryFromFirebase() {
    const snapshot = await window.firebaseUtils.getDocs(
        window.firebaseUtils.collection(window.firebaseDb, 'talantonHistory')
    );
    talantonHistory = [];
    snapshot.forEach((doc) => {
        talantonHistory.push({ id: doc.id, ...doc.data() });
    });
}

function sortMembersAlphabetically() {
    members.sort((a, b) => a.name.localeCompare(b.name, 'ar'));
    members.forEach((member, index) => {
        member.sequentialNumber = index + 1;
    });
}

// Initialize demo data
async function initializeDemoDataInFirebase() {
    try {
        showNotification('ุฌุงุฑู ุฅูุดุงุก ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ...', 'info');

        const demoMembers = [
            { name: 'ุฃุญูุฏ ูุญูุฏ ุงูุดูุงุณ', password: '1234', email: 'ahmed@church.com', phone: '01012345678',
              birthday: '1995-03-15', talanton: 450, joinDate: '2024-01-15', service: 'altar', area: 'ุงููุนุงุฏู', status: 'active' },
            { name: 'ุนูู ุญุณุงู ุงููุจุชุฏุฆ', password: '1234', email: 'ali@church.com', phone: '01890123456',
              birthday: '2000-06-14', talanton: 165, joinDate: '2024-02-12', service: 'altar', area: 'ุงููุทุฑูุฉ', status: 'active' },
            { name: 'ุนุจุฏุงููู ุณุงูู ุงููุตูุฑ', password: '1234', email: 'abdullah@church.com', phone: '01456789012',
              birthday: '1996-09-12', talanton: 395, joinDate: '2024-02-15', service: 'media', area: 'ุงููููุฏุณูู', status: 'active' },
            { name: 'ุนุงุฆุดุฉ ุฃุญูุฏ ุงููุฑููุฉ', password: '1234', email: 'aisha@church.com', phone: '01345678901',
              birthday: '1994-05-30', talanton: 575, joinDate: '2024-02-10', service: 'music', area: 'ุงูุฏูู', status: 'active' },
            { name: 'ูุงุทูุฉ ุนูู ุงููุนููุฉ', password: '1234', email: 'fatima@church.com', phone: '01123456789',
              birthday: '1992-07-22', talanton: 620, joinDate: '2024-01-20', service: 'sunday_school', area: 'ูุตุฑ ุงูุฌุฏูุฏุฉ', status: 'active' }
        ];

        for (const memberData of demoMembers) {
            await window.firebaseUtils.addDoc(
                window.firebaseUtils.collection(window.firebaseDb, 'members'),
                {
                    ...memberData,
                    createdAt: window.firebaseUtils.serverTimestamp(),
                    lastUpdated: window.firebaseUtils.serverTimestamp()
                }
            );
        }

        const demoProducts = [
            { name: 'ูุชุงุจ ุงูุฃุฌุจูุฉ ุงูููุฏุณุฉ', price: 80, description: 'ูุชุงุจ ุงูุฃุฌุจูุฉ ุงููุงูู', category: 'books', stock: 15 },
            { name: 'ูุณุจุญุฉ ุฎุดุจูุฉ', price: 45, description: 'ูุณุจุญุฉ ูู ุงูุฎุดุจ ุงูุทุจูุนู', category: 'accessories', stock: 25 },
            { name: 'ุตููุจ ุฐูุจู', price: 120, description: 'ุตููุจ ูุทูู ุจุงูุฐูุจ', category: 'accessories', stock: 8 },
            { name: 'ุดูุงุฏุฉ ุชูุฏูุฑ', price: 200, description: 'ุดูุงุฏุฉ ุชูุฏูุฑ ููุฎุฏูุฉ', category: 'certificates', stock: 50 },
            { name: 'ุชูุดูุฑุช ุงูุฎุฏูุฉ', price: 60, description: 'ุชูุดูุฑุช ุจุดุนุงุฑ ุงููููุณุฉ', category: 'clothing', stock: 30 }
        ];

        for (const productData of demoProducts) {
            await window.firebaseUtils.addDoc(
                window.firebaseUtils.collection(window.firebaseDb, 'products'),
                productData
            );
        }

        console.log('โ ุชู ุฅูุดุงุก ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ');
        showNotification('ุชู ุฅูุดุงุก ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ ุจูุฌุงุญ!', 'success');

    } catch (error) {
        console.error('โ ุฎุทุฃ ูู ุฅูุดุงุก ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ:', error);
        showNotification('ุฎุทุฃ ูู ุฅูุดุงุก ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ', 'error');
    }
}

// UI Update Functions
function updateUIComplete() {
    updateStats();
    checkBirthdays();
    loadTodayOccasions();
    loadMemberDropdown();
    loadMemberLoginDropdown();
    loadStoreDisplay();
    loadLeaderboard();
    
    if (currentMember) {
        const updatedMember = members.find(m => m.id === currentMember.id);
        if (updatedMember) {
            currentMember = updatedMember;
            displaySelectedMember();
        }
    }
    
    if (isAdmin && window.loadAdminData) {
        window.loadAdminData();
    }
    
    if (isMemberLoggedIn && currentMember && window.loadMemberDashboard) {
        window.loadMemberDashboard();
    }
}

function updateStats() {
    const totalMembersElement = document.getElementById('totalMembers');
    const presentTodayElement = document.getElementById('presentToday');
    const totalTalantonElement = document.getElementById('totalTalanton');
    const weeklyAttendanceElement = document.getElementById('weeklyAttendance');

    if (totalMembersElement) totalMembersElement.textContent = members.length;

    const today = new Date().toISOString().split('T')[0];
    const presentToday = attendance.filter(a => a.date === today).length;
    if (presentTodayElement) presentTodayElement.textContent = presentToday;

    const totalTalanton = members.reduce((sum, member) => sum + (member.talanton || 0), 0);
    if (totalTalantonElement) totalTalantonElement.textContent = totalTalanton;

    const weekStart = new Date();
    weekStart.setDate(weekStart.getDate() - 7);
    const weekAttendance = attendance.filter(a => new Date(a.date) >= weekStart);
    const weeklyRate = members.length > 0 ? Math.round((weekAttendance.length / (members.length * 7)) * 100) : 0;
    if (weeklyAttendanceElement) weeklyAttendanceElement.textContent = weeklyRate + '%';
}

function loadMemberDropdown() {
    const dropdown = document.getElementById('memberDropdown');
    if (!dropdown) return;
    
    dropdown.innerHTML = '<option value="">ุงุฎุชุฑ ุนุถู...</option>';
    members.forEach(member => {
        const level = calculateLevel(member.talanton || 0);
        dropdown.innerHTML += `
            <option value="${member.id}">
                ${member.sequentialNumber}. ${member.name} - ${level.icon} ${level.name} (${member.talanton || 0} ููุทุฉ)
            </option>
        `;
    });
}

function loadMemberLoginDropdown() {
    const dropdown = document.getElementById('memberLoginDropdown');
    if (!dropdown) return;
    
    dropdown.innerHTML = '<option value="">ุงุฎุชุฑ ุนุถู...</option>';
    members.forEach(member => {
        dropdown.innerHTML += `
            <option value="${member.id}">${member.name}</option>
        `;
    });
}

function loadStoreDisplay() {
    const storeDisplay = document.getElementById('storeDisplay');
    if (!storeDisplay) return;
    
    storeDisplay.innerHTML = products.map(product => `
        <div class="product-card">
            <h4 style="color: var(--primary-color); margin-bottom: 10px;">${product.name}</h4>
            <p style="margin-bottom: 15px; opacity: 0.8;">${product.description}</p>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <span class="product-price">๐ฐ ${product.price} ููุทุฉ</span>
                <span class="product-stock">๐ฆ ${product.stock} ูุชููุฑ</span>
            </div>
            <div style="text-align: center;">
                ${isMemberLoggedIn ? 
                    `<button class="btn btn-success" onclick="showPurchaseModal('${product.id}')" style="width: 100%;">๐ ุดุฑุงุก</button>` :
                    `<div style="padding: 10px; background: var(--surface-color); border-radius: 10px; font-size: 0.9rem; opacity: 0.7;">ููุดุฑุงุก: ูู ุจุชุณุฌูู ุงูุฏุฎูู ูุนุถู</div>`
                }
            </div>
        </div>
    `).join('');
}

function loadLeaderboard() {
    const leaderboard = document.getElementById('leaderboard');
    if (!leaderboard) return;
    
    const sortedMembers = [...members].sort((a, b) => (b.talanton || 0) - (a.talanton || 0)).slice(0, 10);
    
    leaderboard.innerHTML = `
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
            ${sortedMembers.map((member, index) => {
                const level = calculateLevel(member.talanton || 0);
                const medal = index === 0 ? '๐ฅ' : index === 1 ? '๐ฅ' : index === 2 ? '๐ฅ' : `#${index + 1}`;
                return `
                    <div style="background: var(--card-color); border: 2px solid var(--border-color); border-radius: 15px; padding: 20px; text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: 10px;">${medal}</div>
                        <h4 style="color: var(--primary-color); margin-bottom: 10px;">${member.name}</h4>
                        <div class="level-badge ${level.color}" style="margin-bottom: 10px;">
                            ${level.icon} ${level.name}
                        </div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: var(--warning-color);">
                            ๐ฐ ${member.talanton || 0} ููุทุฉ
                        </div>
                    </div>
                `;
            }).join('')}
        </div>
    `;
}

// Member Selection Functions
function quickAttendanceByNumber() {
    const sequentialNumber = parseInt(document.getElementById('quickAttendanceInput').value);
    
    if (!sequentialNumber || sequentialNumber < 1) {
        showNotification('ูุฑุฌู ุฅุฏุฎุงู ุฑูู ุตุญูุญ!', 'warning');
        return;
    }
    
    const member = members.find(m => m.sequentialNumber === sequentialNumber);
    if (member) {
        currentMember = member;
        document.getElementById('memberDropdown').value = member.id;
        displaySelectedMember();
        showAttendanceModal();
        document.getElementById('quickAttendanceInput').value = '';
    } else {
        showNotification(`ูุง ููุฌุฏ ุนุถู ุจุฑูู ${sequentialNumber}!`, 'error');
    }
}

function selectMemberFromDropdown() {
    const dropdown = document.getElementById('memberDropdown');
    const memberId = dropdown.value;
    
    if (memberId) {
        currentMember = members.find(m => m.id === memberId);
        if (currentMember) {
            displaySelectedMember();
        }
    } else {
        document.getElementById('memberInfoDisplay').classList.remove('active');
    }
}

function displaySelectedMember() {
    const infoDisplay = document.getElementById('memberInfoDisplay');
    const selectedMemberInfo = document.getElementById('selectedMemberInfo');
    
    if (!currentMember) return;
    
    const level = calculateLevel(currentMember.talanton || 0);
    const today = new Date().toISOString().split('T')[0];
    const todayAttendance = attendance.find(a => 
        a.memberId === currentMember.id && a.date === today
    );
    
    let statusClass = 'status-absent';
    let statusText = 'ุบุงุฆุจ ุงูููู';
    
    if (todayAttendance) {
        statusClass = todayAttendance.type === 'late' ? 'status-late' : 'status-present';
        statusText = todayAttendance.type === 'late' ? 'ุญุงุถุฑ ูุชุฃุฎุฑ' : 'ุญุงุถุฑ ุงูููู';
    }

    selectedMemberInfo.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div>
                <h3 style="color: var(--primary-color); margin-bottom: 10px;">
                    ${currentMember.sequentialNumber}. ${currentMember.name}
                </h3>
                <div class="level-badge ${level.color}">
                    ${level.icon} ${level.name}
                </div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 2rem; color: var(--warning-color); font-weight: bold;">๐ฐ ${currentMember.talanton || 0}</div>
                <div style="font-size: 0.9rem; opacity: 0.8;">ููุงุท Talanton</div>
            </div>
        </div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
            <div><strong>๐ฑ ุงููุงุชู:</strong> ${currentMember.phone || 'ุบูุฑ ูุญุฏุฏ'}</div>
            <div><strong>๐ ุงูููุทูุฉ:</strong> ${currentMember.area || 'ุบูุฑ ูุญุฏุฏ'}</div>
            <div><strong>โช ุงูุฎุฏูุฉ:</strong> ${getServiceName(currentMember.service)}</div>
            <div><strong>๐ ุญุงูุฉ ุงูููู:</strong> <span class="${statusClass}">${statusText}</span></div>
        </div>
    `;
    
    infoDisplay.classList.add('active');
}

// Attendance Functions
function showAttendanceModal() {
    if (!currentMember) {
        showNotification('ูุฑุฌู ุงุฎุชูุงุฑ ุนุถู ุฃููุงู', 'warning');
        return;
    }
    
    const attendanceTitle = document.getElementById('attendanceTitle');
    if (attendanceTitle) {
        attendanceTitle.textContent = `ุชุณุฌูู ุญุถูุฑ: ${currentMember.name}`;
    }
    showModal('attendanceModal');
}

function simulateFingerprint() {
    const icon = document.querySelector('.fingerprint-icon');
    if (icon) {
        icon.style.color = 'var(--success-color)';
        
        setTimeout(() => {
            showNotification('ุชู ุงูุชุญูู ูู ุงูุจุตูุฉ ุจูุฌุงุญ!', 'success');
            markAttendance();
        }, 1000);
    }
}

async function markAttendance() {
    if (!currentMember) {
        showNotification('ุฎุทุฃ: ูู ูุชู ุงุฎุชูุงุฑ ุนุถู', 'error');
        return;
    }

    const password = document.getElementById('memberPassword').value;
    const attendanceType = document.getElementById('attendanceType').value;
    const notes = document.getElementById('attendanceNotes').value;
    
    if (password && password !== currentMember.password) {
        showNotification('ูููุฉ ุงููุฑูุฑ ุบูุฑ ุตุญูุญุฉ!', 'error');
        return;
    }

    const today = new Date().toISOString().split('T')[0];
    const existingAttendance = attendance.find(a => 
        a.memberId === currentMember.id && a.date === today
    );

    if (existingAttendance) {
        showNotification('ุชู ุชุณุฌูู ุญุถูุฑู ุงูููู ูุณุจูุงู!', 'warning');
        return;
    }

    try {
        let attendanceReward = settings.dailyAttendancePoints;
        if (attendanceType === 'early') attendanceReward += 5;
        else if (attendanceType === 'late') attendanceReward -= 3;
        else if (attendanceType === 'makeup') attendanceReward = Math.floor(attendanceReward * 0.7);

        const attendanceData = {
            memberId: currentMember.id,
            memberName: currentMember.name,
            date: today,
            type: attendanceType,
            notes: notes,
            timestamp: window.firebaseUtils.serverTimestamp()
        };

        await window.firebaseUtils.addDoc(
            window.firebaseUtils.collection(window.firebaseDb, 'attendance'),
            attendanceData
        );

        const newTalanton = (currentMember.talanton || 0) + attendanceReward;
        await window.firebaseUtils.updateDoc(
            window.firebaseUtils.doc(window.firebaseDb, 'members', currentMember.id),
            { 
                talanton: newTalanton,
                lastUpdated: window.firebaseUtils.serverTimestamp()
            }
        );

        const historyData = {
            memberId: currentMember.id,
            memberName: currentMember.name,
            amount: attendanceReward,
            type: 'add',
            reason: `ุญุถูุฑ ${attendanceType === 'regular' ? 'ุนุงุฏู' : 
                    attendanceType === 'early' ? 'ูุจูุฑ' :
                    attendanceType === 'late' ? 'ูุชุฃุฎุฑ' : 'ุชุนููุถู'}`,
            date: today,
            timestamp: window.firebaseUtils.serverTimestamp()
        };

        await window.firebaseUtils.addDoc(
            window.firebaseUtils.collection(window.firebaseDb, 'talantonHistory'),
            historyData
        );

        showNotification(`ุชู ุชุณุฌูู ุญุถูุฑู ุจูุฌุงุญ! ุญุตูุช ุนูู ${attendanceReward} ููุงุท Talanton`, 'success');
        closeModal('attendanceModal');
        resetAttendanceForm();

    } catch (error) {
        console.error('โ ุฎุทุฃ ูู ุชุณุฌูู ุงูุญุถูุฑ:', error);
        showNotification('ุฎุทุฃ ูู ุชุณุฌูู ุงูุญุถูุฑ', 'error');
    }
}

function resetAttendanceForm() {
    const memberPasswordInput = document.getElementById('memberPassword');
    const attendanceTypeSelect = document.getElementById('attendanceType');
    const attendanceNotesTextarea = document.getElementById('attendanceNotes');
    
    if (memberPasswordInput) memberPasswordInput.value = '';
    if (attendanceTypeSelect) attendanceTypeSelect.value = 'regular';
    if (attendanceNotesTextarea) attendanceNotesTextarea.value = '';
    
    const fingerprintIcon = document.querySelector('.fingerprint-icon');
    if (fingerprintIcon) {
        fingerprintIcon.style.color = 'var(--primary-color)';
    }
}

// Purchase Functions
function showPurchaseModal(productId) {
    if (!isMemberLoggedIn || !currentMember) {
        showNotification('ูุฑุฌู ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู', 'warning');
        return;
    }
    
    currentProduct = products.find(p => p.id === productId);
    if (!currentProduct) return;
    
    if (currentProduct.stock <= 0) {
        showNotification('ุงูููุชุฌ ุบูุฑ ูุชููุฑ ุญุงููุงู', 'warning');
        return;
    }
    
    if (currentMember.talanton < currentProduct.price) {
        showNotification('ุฑุตูุฏู ูู ุงูููุงุท ุบูุฑ ูุงูู ูุดุฑุงุก ูุฐุง ุงูููุชุฌ', 'warning');
        return;
    }
    
    const purchaseTitle = document.getElementById('purchaseTitle');
    const purchaseDetails = document.getElementById('purchaseDetails');
    
    if (purchaseTitle) {
        purchaseTitle.textContent = `ุดุฑุงุก: ${currentProduct.name}`;
    }
    
    if (purchaseDetails) {
        purchaseDetails.innerHTML = `
            <div style="text-align: center; margin-bottom: 20px;">
                <h3 style="color: var(--primary-color);">${currentProduct.name}</h3>
                <p style="margin: 15px 0;">${currentProduct.description}</p>
                <div style="font-size: 1.5rem; font-weight: bold; color: var(--warning-color); margin: 15px 0;">
                    ๐ฐ ${currentProduct.price} ููุทุฉ
                </div>
                <div style="margin-bottom: 15px;">๐ฆ ูุชููุฑ: ${currentProduct.stock} ูุทุนุฉ</div>
                <div style="background: var(--card-color); padding: 15px; border-radius: 10px;">
                    <div>ุฑุตูุฏู ุงูุญุงูู: ${currentMember.talanton} ููุทุฉ</div>
                    <div>ุงูุฑุตูุฏ ุจุนุฏ ุงูุดุฑุงุก: ${currentMember.talanton - currentProduct.price} ููุทุฉ</div>
                </div>
            </div>
        `;
    }
    
    showModal('purchaseModal');
}

async function confirmPurchase() {
    if (!currentProduct || !currentMember) return;
    
    try {
        const newTalanton = currentMember.talanton - currentProduct.price;
        await window.firebaseUtils.updateDoc(
            window.firebaseUtils.doc(window.firebaseDb, 'members', currentMember.id),
            { 
                talanton: newTalanton,
                lastUpdated: window.firebaseUtils.serverTimestamp()
            }
        );
        
        const newStock = currentProduct.stock - 1;
        await window.firebaseUtils.updateDoc(
            window.firebaseUtils.doc(window.firebaseDb, 'products', currentProduct.id),
            { stock: newStock }
        );
        
        const historyData = {
            memberId: currentMember.id,
            memberName: currentMember.name,
            amount: currentProduct.price,
            type: 'subtract',
            reason: `ุดุฑุงุก: ${currentProduct.name}`,
            date: new Date().toISOString().split('T')[0],
            timestamp: window.firebaseUtils.serverTimestamp()
        };
        
        await window.firebaseUtils.addDoc(
            window.firebaseUtils.collection(window.firebaseDb, 'talantonHistory'),
            historyData
        );
        
        showNotification(`ุชู ุดุฑุงุก ${currentProduct.name} ุจูุฌุงุญ!`, 'success');
        closeModal('purchaseModal');
        
    } catch (error) {
        console.error('โ ุฎุทุฃ ูู ุงูุดุฑุงุก:', error);
        showNotification('ุฎุทุฃ ูู ุนูููุฉ ุงูุดุฑุงุก', 'error');
    }
}

// Utility Functions
function calculateLevel(points) {
    return memberLevels.find(level => points >= level.minPoints && points <= level.maxPoints) || memberLevels[0];
}

function getServiceName(service) {
    const services = {
        altar: 'ุฎุฏูุฉ ุงููุฐุจุญ', sunday_school: 'ูุฏุฑุณุฉ ุงูุฃุญุฏ', youth: 'ุฎุฏูุฉ ุงูุดุจุงุจ',
        music: 'ุงูุฃูุญุงู ูุงูููุณููู', media: 'ุงูุฅุนูุงู', social: 'ุงูุฎุฏูุฉ ุงูุงุฌุชูุงุนูุฉ', other: 'ุฃุฎุฑู'
    };
    return services[service] || 'ุบูุฑ ูุญุฏุฏ';
}

function checkBirthdays() {
    const today = new Date();
    const alertContainer = document.getElementById('birthdayAlerts');
    if (!alertContainer) return;

    const upcomingBirthdays = members.filter(member => {
        if (!member.birthday) return false;
        
        const birthday = new Date(member.birthday);
        const thisYearBirthday = new Date(today.getFullYear(), birthday.getMonth(), birthday.getDate());
        
        const daysDiff = Math.ceil((thisYearBirthday - today) / (1000 * 60 * 60 * 24));
        return daysDiff >= 0 && daysDiff <= settings.birthdayAlertDays;
    });

    if (upcomingBirthdays.length > 0) {
        alertContainer.innerHTML = upcomingBirthdays.map(member => {
            const birthday = new Date(member.birthday);
            const thisYearBirthday = new Date(today.getFullYear(), birthday.getMonth(), birthday.getDate());
            const daysDiff = Math.ceil((thisYearBirthday - today) / (1000 * 60 * 60 * 24));
            
            return `
                <div class="birthday-alert">
                    ๐ ${daysDiff === 0 ? 'ุงูููู ุนูุฏ ูููุงุฏ' : `ุฎูุงู ${daysDiff} ุฃูุงู ุนูุฏ ูููุงุฏ`} 
                    <strong>${member.name}</strong>
                    ${daysDiff === 0 ? '๐' : ''}
                </div>
            `;
        }).join('');
    } else {
        alertContainer.innerHTML = '';
    }
}

function loadTodayOccasions() {
    const today = new Date().toISOString().split('T')[0];
    const todayOccasionsContainer = document.getElementById('todayEvents');
    if (!todayOccasionsContainer) return;

    const todayOccasions = occasions.filter(occasion => occasion.date === today);
    
    if (todayOccasions.length > 0) {
        todayOccasionsContainer.innerHTML = todayOccasions.map(occasion => `
            <div style="background: var(--card-color); border: 1px solid var(--border-color); border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                <div style="color: var(--primary-color); font-weight: bold;">${occasion.time || 'ุทูุงู ุงูููู'}</div>
                <h4>${occasion.title}</h4>
                <p>${occasion.description}</p>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                    <span>๐ ${occasion.location || 'ุบูุฑ ูุญุฏุฏ'}</span>
                    <span style="color: var(--success-color); font-weight: bold;">๐ฐ ${occasion.points} ููุทุฉ</span>
                </div>
            </div>
        `).join('');
    } else {
        todayOccasionsContainer.innerHTML = '<p>ูุง ุชูุฌุฏ ููุงุณุจุงุช ูุฌุฏููุฉ ููุฐุง ุงูููู</p>';
    }
}

function initializeCharts() {
    const ctx = document.getElementById('attendanceChart');
    if (!ctx) return;
    updateCharts();
}

function updateCharts() {
    const ctx = document.getElementById('attendanceChart');
    if (!ctx) return;

    const existingChart = Chart.getChart(ctx);
    if (existingChart) {
        existingChart.destroy();
    }

    const last7Days = [];
    const attendanceCounts = [];
    
    for (let i = 6; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        const dateStr = date.toISOString().split('T')[0];
        const dayName = date.toLocaleDateString('ar', { weekday: 'short' });
        
        last7Days.push(dayName);
        attendanceCounts.push(attendance.filter(a => a.date === dateStr).length);
    }

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: last7Days,
            datasets: [{
                label: 'ุนุฏุฏ ุงูุญุงุถุฑูู',
                data: attendanceCounts,
                borderColor: 'rgb(99, 102, 241)',
                backgroundColor: 'rgba(99, 102, 241, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'ุฅุญุตุงุฆูุงุช ุงูุญุถูุฑ - ุขุฎุฑ 7 ุฃูุงู'
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

// Theme Management
function toggleTheme() {
    const body = document.body;
    const currentTheme = body.getAttribute('data-theme');
    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
    const themeIcon = document.getElementById('themeIcon');
    
    body.setAttribute('data-theme', newTheme);
    if (themeIcon) themeIcon.textContent = newTheme === 'light' ? '๐' : 'โ๏ธ';
    localStorage.setItem('theme', newTheme);
    
    showNotification(`ุชู ุชูุนูู ุงููุถุน ${newTheme === 'light' ? 'ุงูููุงุฑู' : 'ุงููููู'}`, 'success');
}

// Other Functions
function generateQRCodes() {
    showNotification('ุฌุงุฑู ุฅูุดุงุก QR ููุฏุงุช ููุฃุนุถุงุก...', 'info');
    
    let qrInfo = 'QR ููุฏุงุช ุงูุฃุนุถุงุก:\n\n';
    members.forEach(member => {
        qrInfo += `${member.sequentialNumber}. ${member.name}: QR-${member.sequentialNumber}\n`;
    });
    
    alert(qrInfo + '\nูููู ุงุณุชุฎุฏุงู ุงูุฑูู ุงูุชุณูุณูู ููุญุถูุฑ ุงูุณุฑูุน');
    showNotification('ุชู ุฅูุดุงุก QR ููุฏุงุช ุจูุฌุงุญ!', 'success');
}

function showMemberProfile() {
    if (!currentMember) return;

    const memberAttendance = attendance.filter(a => a.memberId === currentMember.id);
    const level = calculateLevel(currentMember.talanton || 0);

    const profileInfo = `
ููู ${currentMember.name} ุงูุดุฎุตู:

๐ ุงูุฅุญุตุงุฆูุงุช:
โข ุงูุฑูู ุงูุชุณูุณูู: ${currentMember.sequentialNumber}
โข ุฑุตูุฏ Talanton: ${currentMember.talanton || 0}
โข ุงููุณุชูู: ${level.name} ${level.icon}
โข ุฃูุงู ุงูุญุถูุฑ ุงูููู: ${memberAttendance.length}

๐ง ูุนูููุงุช ุงูุงุชุตุงู:
โข ุงูุจุฑูุฏ: ${currentMember.email || 'ุบูุฑ ูุญุฏุฏ'}
โข ุงููุงุชู: ${currentMember.phone || 'ุบูุฑ ูุญุฏุฏ'}
โข ุงูููุทูุฉ: ${currentMember.area || 'ุบูุฑ ูุญุฏุฏุฉ'}

โช ูุนูููุงุช ุงูุฎุฏูุฉ:
โข ุงูุฎุฏูุฉ: ${getServiceName(currentMember.service)}
โข ุชุงุฑูุฎ ุงูุงูุถูุงู: ${new Date(currentMember.joinDate).toLocaleDateString('ar')}
    `;

    alert(profileInfo);
}

function showMemberTasks() {
    if (!currentMember) return;

    const memberTasks = tasks.filter(task => 
        task.assignedService === 'all' || task.assignedService === currentMember.service
    );

    let tasksInfo = `ููุงู ${currentMember.name}:\n\n`;
    
    if (memberTasks.length > 0) {
        memberTasks.forEach((task, index) => {
            tasksInfo += `${index + 1}. ${task.title}\n`;
            tasksInfo += `   ุงูููุงุท: ${task.points} | ุงูููุน: ${task.type}\n`;
            tasksInfo += `   ุงููุตู: ${task.description}\n\n`;
        });
    } else {
        tasksInfo += 'ูุง ุชูุฌุฏ ููุงู ูุฎุตุตุฉ ููุฐุง ุงูุนุถู ุญุงููุงู.';
    }

    alert(tasksInfo);
}

// Modal Management
function showModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.style.display = 'block';
    }
}

function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.style.display = 'none';
    }
}

// Notification System
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = 'notification';
    notification.textContent = message;
    
    const colors = {
        success: 'var(--success-color)',
        error: 'var(--danger-color)',
        warning: 'var(--warning-color)',
        info: 'var(--info-color)'
    };
    
    notification.style.background = colors[type] || colors.info;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.remove();
    }, 5000);
}

// Close modals when clicking outside
window.onclick = function(event) {
    if (event.target.classList.contains('modal')) {
        event.target.style.display = 'none';
    }
}

// Cleanup on page unload
window.addEventListener('beforeunload', () => {
    firebaseListeners.forEach(unsubscribe => {
        if (typeof unsubscribe === 'function') {
            unsubscribe();
        }
    });
});
// Admin Panel Functions

function showAdminLogin() {
    showModal('adminLoginModal');
}

function adminLogin() {
    const password = document.getElementById('adminPassword').value;
    
    if (password === 'admin123' || password === 'admin' || password === 'superadmin2024') {
        isAdmin = true;
        const mainContent = document.getElementById('mainContent');
        const memberPanel = document.getElementById('memberPanel');
        const adminPanel = document.getElementById('adminPanel');
        
        if (mainContent) mainContent.style.display = 'none';
        if (memberPanel) memberPanel.style.display = 'none';
        if (adminPanel) adminPanel.style.display = 'block';
        
        closeModal('adminLoginModal');
        loadAdminData();
        showNotification('ูุฑุญุจุงู ุจู ูู ููุญุฉ ุชุญูู ุงูุฃุฏูู! ๐', 'success');
    } else {
        showNotification('ูููุฉ ูุฑูุฑ ุฎุงุทุฆุฉ!', 'error');
    }
    
    document.getElementById('adminPassword').value = '';
}

function logoutAdmin() {
    if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุชุณุฌูู ุงูุฎุฑูุฌุ')) {
        isAdmin = false;
        currentMember = null;
        const mainContent = document.getElementById('mainContent');
        const adminPanel = document.getElementById('adminPanel');
        
        if (mainContent) mainContent.style.display = 'block';
        if (adminPanel) adminPanel.style.display = 'none';
        
        showNotification('ุชู ุชุณุฌูู ุงูุฎุฑูุฌ ุจูุฌุงุญ', 'success');
        updateUIComplete();
    }
}

window.loadAdminData = function() {
    loadMembersTable();
    loadProductsTable();
    loadTasksTable();
    loadOccasionsTable();
    loadAttendanceTable();
    loadReportsData();
}

function loadMembersTable() {
    const table = document.getElementById('membersTable');
    if (!table) return;
    
    table.innerHTML = `
        <table class="table">
            <thead>
                <tr>
                    <th>ุงูุฑูู ุงูุชุณูุณูู</th>
                    <th>ุงูุงุณู</th>
                    <th>ุงูุจุฑูุฏ</th>
                    <th>ุงููุงุชู</th>
                    <th>Talanton</th>
                    <th>ุงููุณุชูู</th>
                    <th>ุงูุฎุฏูุฉ</th>
                    <th>ุงูุฅุฌุฑุงุกุงุช</th>
                </tr>
            </thead>
            <tbody>
                ${members.map(member => {
                    const level = calculateLevel(member.talanton || 0);
                    return `
                        <tr>
                            <td>${member.sequentialNumber}</td>
                            <td>${member.name}</td>
                            <td>${member.email || 'ุบูุฑ ูุญุฏุฏ'}</td>
                            <td>${member.phone || 'ุบูุฑ ูุญุฏุฏ'}</td>
                            <td>${member.talanton || 0}</td>
                            <td><span class="level-badge ${level.color}">${level.icon} ${level.name}</span></td>
                            <td>${getServiceName(member.service)}</td>
                            <td>
                                <button class="btn btn-warning" onclick="editMember('${member.id}')" style="margin: 2px; padding: 8px 12px; font-size: 12px;">โ๏ธ</button>
                                <button class="btn btn-info" onclick="addTalantonToMember('${member.id}')" style="margin: 2px; padding: 8px 12px; font-size: 12px;">๐ฐ</button>
                                <button class="btn btn-danger" onclick="deleteMember('${member.id}')" style="margin: 2px; padding: 8px 12px; font-size: 12px;">๐๏ธ</button>
                            </td>
                        </tr>
                    `;
                }).join('')}
            </tbody>
        </table>
    `;
}

window.loadProductsTable = function() {
    const table = document.getElementById('productsTable');
    if (!table) return;
    
    table.innerHTML = `
        <table class="table">
            <thead>
                <tr>
                    <th>ุงูุฑูู</th>
                    <th>ุงุณู ุงูููุชุฌ</th>
                    <th>ุงูุณุนุฑ</th>
                    <th>ุงููุฎุฒูู</th>
                    <th>ุงููุฆุฉ</th>
                    <th>ุงูุฅุฌุฑุงุกุงุช</th>
                </tr>
            </thead>
            <tbody>
                ${products.map((product, index) => `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${product.name}</td>
                        <td>${product.price} ููุทุฉ</td>
                        <td>${product.stock}</td>
                        <td>${product.category}</td>
                        <td>
                            <button class="btn btn-warning" onclick="editProduct('${product.id}')" style="margin: 2px; padding: 8px 12px; font-size: 12px;">โ๏ธ</button>
                            <button class="btn btn-danger" onclick="deleteProduct('${product.id}')" style="margin: 2px; padding: 8px 12px; font-size: 12px;">๐๏ธ</button>
                        </td>
                    </tr>
                `).join('')}
            </tbody>
        </table>
    `;
}

function loadTasksTable() {
    const table = document.getElementById('tasksTable');
    if (!table) return;
    
    table.innerHTML = `
        <table class="table">
            <thead>
                <tr>
                    <th>ุงูุฑูู</th>
                    <th>ุนููุงู ุงููููุฉ</th>
                    <th>ุงูููุงุท</th>
                    <th>ุงูููุน</th>
                    <th>ุงูุฃููููุฉ</th>
                    <th>ุงูุฎุฏูุฉ ุงููุฎุตุตุฉ</th>
                    <th>ุงูุฅุฌุฑุงุกุงุช</th>
                </tr>
            </thead>
            <tbody>
                ${tasks.map((task, index) => `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${task.title}</td>
                        <td>${task.points}</td>
                        <td>${task.type}</td>
                        <td>${task.priority}</td>
                        <td>${task.assignedService === 'all' ? 'ุฌููุน ุงูุฎุฏูุงุช' : getServiceName(task.assignedService)}</td>
                        <td>
                            <button class="btn btn-warning" onclick="editTask('${task.id}')" style="margin: 2px; padding: 8px 12px; font-size: 12px;">โ๏ธ</button>
                            <button class="btn btn-danger" onclick="deleteTask('${task.id}')" style="margin: 2px; padding: 8px 12px; font-size: 12px;">๐๏ธ</button>
                        </td>
                    </tr>
                `).join('')}
            </tbody>
        </table>
    `;
}

function loadOccasionsTable() {
    const table = document.getElementById('occasionsTable');
    if (!table) return;
    
    table.innerHTML = `
        <table class="table">
            <thead>
                <tr>
                    <th>ุงูุฑูู</th>
                    <th>ุนููุงู ุงูููุงุณุจุฉ</th>
                    <th>ุงูุชุงุฑูุฎ</th>
                    <th>ุงูููุงุท</th>
                    <th>ุงูููุน</th>
                    <th>ุงูุฅุฌุฑุงุกุงุช</th>
                </tr>
            </thead>
            <tbody>
                ${occasions.map((occasion, index) => `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${occasion.title}</td>
                        <td>${new Date(occasion.date).toLocaleDateString('ar')}</td>
                        <td>${occasion.points}</td>
                        <td>${occasion.type}</td>
                        <td>
                            <button class="btn btn-warning" onclick="editOccasion('${occasion.id}')" style="margin: 2px; padding: 8px 12px; font-size: 12px;">โ๏ธ</button>
                            <button class="btn btn-danger" onclick="deleteOccasion('${occasion.id}')" style="margin: 2px; padding: 8px 12px; font-size: 12px;">๐๏ธ</button>
                        </td>
                    </tr>
                `).join('')}
            </tbody>
        </table>
    `;
}

function loadAttendanceTable() {
    const table = document.getElementById('attendanceTable');
    if (!table) return;
    
    const recentAttendance = attendance.slice(0, 50);
    
    table.innerHTML = `
        <table class="table">
            <thead>
                <tr>
                    <th>ุงูุชุงุฑูุฎ</th>
                    <th>ุงุณู ุงูุนุถู</th>
                    <th>ููุน ุงูุญุถูุฑ</th>
                    <th>ุงูููุงุญุธุงุช</th>
                    <th>ุงูุฅุฌุฑุงุกุงุช</th>
                </tr>
            </thead>
            <tbody>
                ${recentAttendance.map(record => `
                    <tr>
                        <td>${new Date(record.date).toLocaleDateString('ar')}</td>
                        <td>${record.memberName}</td>
                        <td>${record.type}</td>
                        <td>${record.notes || 'ูุง ุชูุฌุฏ'}</td>
                        <td>
                            <button class="btn btn-danger" onclick="deleteAttendanceRecord('${record.id}')" style="margin: 2px; padding: 8px 12px; font-size: 12px;">๐๏ธ</button>
                        </td>
                    </tr>
                `).join('')}
            </tbody>
        </table>
    `;
}

function loadReportsData() {
    const reportContent = document.getElementById('reportContent');
    if (!reportContent) return;
    
    reportContent.innerHTML = `
        <div style="background: var(--card-color); padding: 25px; border-radius: 15px;">
            <h3>๐ ุชูุฑูุฑ ุดุงูู</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number">${members.length}</div>
                    <div class="stat-label">ุฅุฌูุงูู ุงูุฃุนุถุงุก</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${attendance.length}</div>
                    <div class="stat-label">ุณุฌูุงุช ุงูุญุถูุฑ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${products.length}</div>
                    <div class="stat-label">ููุชุฌุงุช ุงููุชุฌุฑ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${occasions.length}</div>
                    <div class="stat-label">ุงูููุงุณุจุงุช</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${tasks.length}</div>
                    <div class="stat-label">ุงูููุงู</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${members.reduce((sum, m) => sum + (m.talanton || 0), 0)}</div>
                    <div class="stat-label">ุฅุฌูุงูู ุงูููุงุท</div>
                </div>
            </div>
        </div>
    `;
}

// Tab Management
function showTab(tabName) {
    const tabContents = document.querySelectorAll('.tab-content');
    tabContents.forEach(content => {
        content.classList.remove('active');
    });
    
    const tabButtons = document.querySelectorAll('.tab-btn');
    tabButtons.forEach(btn => {
        btn.classList.remove('active');
    });
    
    const selectedTab = document.getElementById(tabName + 'Tab');
    if (selectedTab) {
        selectedTab.classList.add('active');
    }
    
    event.target.classList.add('active');
}

// Member Management Functions
function showAddMemberModal() {
    showModal('addMemberModal');
}

async function addMember(event) {
    event.preventDefault();
    
    try {
        const newMemberData = {
            name: document.getElementById('memberName').value,
            password: document.getElementById('memberPass').value,
            email: document.getElementById('memberEmail').value,
            phone: document.getElementById('memberPhone').value,
            birthday: document.getElementById('memberBirthday').value,
            talanton: parseInt(document.getElementById('initialTalanton').value) || 0,
            service: document.getElementById('memberService').value,
            area: document.getElementById('memberArea').value,
            joinDate: new Date().toISOString().split('T')[0],
            status: 'active'
        };

        await window.firebaseUtils.addDoc(
            window.firebaseUtils.collection(window.firebaseDb, 'members'),
            {
                ...newMemberData,
                createdAt: window.firebaseUtils.serverTimestamp(),
                lastUpdated: window.firebaseUtils.serverTimestamp()
            }
        );

        closeModal('addMemberModal');
        showNotification(`ุชู ุฅุถุงูุฉ ุงูุนุถู ${newMemberData.name} ุจูุฌุงุญ!`, 'success');
        event.target.reset();

    } catch (error) {
        console.error('ุฎุทุฃ ูู ุฅุถุงูุฉ ุงูุนุถู:', error);
        showNotification('ุฎุทุฃ ูู ุฅุถุงูุฉ ุงูุนุถู', 'error');
    }
}

async function editMember(memberId) {
    const member = members.find(m => m.id === memberId);
    if (!member) return;
    
    const newName = prompt('ุงุณู ุงูุนุถู:', member.name);
    if (newName && newName !== member.name) {
        try {
            await window.firebaseUtils.updateDoc(
                window.firebaseUtils.doc(window.firebaseDb, 'members', member.id),
                { 
                    name: newName,
                    lastUpdated: window.firebaseUtils.serverTimestamp()
                }
            );
            showNotification('ุชู ุชุญุฏูุซ ุจูุงูุงุช ุงูุนุถู ุจูุฌุงุญ!', 'success');
        } catch (error) {
            console.error('ุฎุทุฃ ูู ุชุญุฏูุซ ุงูุนุถู:', error);
            showNotification('ุฎุทุฃ ูู ุชุญุฏูุซ ุงูุนุถู', 'error');
        }
    }
}

async function addTalantonToMember(memberId) {
    const member = members.find(m => m.id === memberId);
    if (!member) return;
    
    const points = prompt(`ุฅุถุงูุฉ ููุงุท ูู ${member.name}:`, '10');
    const reason = prompt('ุงูุณุจุจ:', 'ุฅุถุงูุฉ ููุงุท ุฅุถุงููุฉ');
    
    if (points && !isNaN(points) && parseInt(points) > 0) {
        try {
            const newTalanton = (member.talanton || 0) + parseInt(points);
            
            await window.firebaseUtils.updateDoc(
                window.firebaseUtils.doc(window.firebaseDb, 'members', member.id),
                { 
                    talanton: newTalanton,
                    lastUpdated: window.firebaseUtils.serverTimestamp()
                }
            );

            const historyData = {
                memberId: member.id,
                memberName: member.name,
                amount: parseInt(points),
                type: 'add',
                reason: reason,
                date: new Date().toISOString().split('T')[0],
                timestamp: window.firebaseUtils.serverTimestamp()
            };

            await window.firebaseUtils.addDoc(
                window.firebaseUtils.collection(window.firebaseDb, 'talantonHistory'),
                historyData
            );

            showNotification(`ุชู ุฅุถุงูุฉ ${points} ููุทุฉ ูู ${member.name}`, 'success');
        } catch (error) {
            console.error('ุฎุทุฃ ูู ุฅุถุงูุฉ ุงูููุงุท:', error);
            showNotification('ุฎุทุฃ ูู ุฅุถุงูุฉ ุงูููุงุท', 'error');
        }
    }
}

async function deleteMember(memberId) {
    const member = members.find(m => m.id === memberId);
    if (!member) return;
    
    if (confirm(`ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุงูุนุถู ${member.name}ุ`)) {
        try {
            await window.firebaseUtils.deleteDoc(
                window.firebaseUtils.doc(window.firebaseDb, 'members', member.id)
            );
            showNotification(`ุชู ุญุฐู ุงูุนุถู ${member.name}`, 'success');
        } catch (error) {
            console.error('ุฎุทุฃ ูู ุญุฐู ุงูุนุถู:', error);
            showNotification('ุฎุทุฃ ูู ุญุฐู ุงูุนุถู', 'error');
        }
    }
}

// Product Management Functions
function showAddProductModal() {
    showModal('addProductModal');
}

async function addProduct(event) {
    event.preventDefault();
    
    try {
        const newProductData = {
            name: document.getElementById('productName').value,
            price: parseInt(document.getElementById('productPrice').value),
            stock: parseInt(document.getElementById('productStock').value),
            category: document.getElementById('productCategory').value,
            description: document.getElementById('productDescription').value
        };

        await window.firebaseUtils.addDoc(
            window.firebaseUtils.collection(window.firebaseDb, 'products'),
            {
                ...newProductData,
                createdAt: window.firebaseUtils.serverTimestamp()
            }
        );

        closeModal('addProductModal');
        showNotification(`ุชู ุฅุถุงูุฉ ุงูููุชุฌ ${newProductData.name} ุจูุฌุงุญ!`, 'success');
        event.target.reset();

    } catch (error) {
        console.error('ุฎุทุฃ ูู ุฅุถุงูุฉ ุงูููุชุฌ:', error);
        showNotification('ุฎุทุฃ ูู ุฅุถุงูุฉ ุงูููุชุฌ', 'error');
    }
}

async function editProduct(productId) {
    const product = products.find(p => p.id === productId);
    if (!product) return;
    
    const newName = prompt('ุงุณู ุงูููุชุฌ:', product.name);
    if (newName && newName !== product.name) {
        try {
            await window.firebaseUtils.updateDoc(
                window.firebaseUtils.doc(window.firebaseDb, 'products', product.id),
                { name: newName }
            );
            showNotification('ุชู ุชุญุฏูุซ ุจูุงูุงุช ุงูููุชุฌ ุจูุฌุงุญ!', 'success');
        } catch (error) {
            console.error('ุฎุทุฃ ูู ุชุญุฏูุซ ุงูููุชุฌ:', error);
            showNotification('ุฎุทุฃ ูู ุชุญุฏูุซ ุงูููุชุฌ', 'error');
        }
    }
}

async function deleteProduct(productId) {
    const product = products.find(p => p.id === productId);
    if (!product) return;
    
    if (confirm(`ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุงูููุชุฌ ${product.name}ุ`)) {
        try {
            await window.firebaseUtils.deleteDoc(
                window.firebaseUtils.doc(window.firebaseDb, 'products', product.id)
            );
            showNotification(`ุชู ุญุฐู ุงูููุชุฌ ${product.name}`, 'success');
        } catch (error) {
            console.error('ุฎุทุฃ ูู ุญุฐู ุงูููุชุฌ:', error);
            showNotification('ุฎุทุฃ ูู ุญุฐู ุงูููุชุฌ', 'error');
        }
    }
}

// Placeholder functions for other admin features
function showAddTaskModal() {
    alert('ููุฒุฉ ุฅุถุงูุฉ ุงูููุงู ููุฏ ุงูุชุทููุฑ');
}

function showAddOccasionModal() {
    alert('ููุฒุฉ ุฅุถุงูุฉ ุงูููุงุณุจุงุช ููุฏ ุงูุชุทููุฑ');
}

function editTask(taskId) {
    alert('ููุฒุฉ ุชุนุฏูู ุงูููุงู ููุฏ ุงูุชุทููุฑ');
}

function deleteTask(taskId) {
    alert('ููุฒุฉ ุญุฐู ุงูููุงู ููุฏ ุงูุชุทููุฑ');
}

function editOccasion(occasionId) {
    alert('ููุฒุฉ ุชุนุฏูู ุงูููุงุณุจุงุช ููุฏ ุงูุชุทููุฑ');
}

function deleteOccasion(occasionId) {
    alert('ููุฒุฉ ุญุฐู ุงูููุงุณุจุงุช ููุฏ ุงูุชุทููุฑ');
}

function deleteAttendanceRecord(recordId) {
    if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุณุฌู ุงูุญุถูุฑุ')) {
        alert('ููุฒุฉ ุญุฐู ุณุฌู ุงูุญุถูุฑ ููุฏ ุงูุชุทููุฑ');
    }
}

function showMembersReport() {
    alert('ุชูุฑูุฑ ุงูุฃุนุถุงุก:\n\nุฅุฌูุงูู ุงูุฃุนุถุงุก: ' + members.length + '\nุฅุฌูุงูู ุงูููุงุท: ' + members.reduce((sum, m) => sum + (m.talanton || 0), 0));
}

function showAttendanceReport() {
    alert('ุชูุฑูุฑ ุงูุญุถูุฑ:\n\nุฅุฌูุงูู ุณุฌูุงุช ุงูุญุถูุฑ: ' + attendance.length + '\nุงูุญุงุถุฑูู ุงูููู: ' + attendance.filter(a => a.date === new Date().toISOString().split('T')[0]).length);
}

function exportData() {
    const data = {
        members: members,
        products: products,
        tasks: tasks,
        occasions: occasions,
        attendance: attendance,
        talantonHistory: talantonHistory,
        settings: settings
    };
    
    const dataStr = JSON.stringify(data, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'church_system_backup.json';
    link.click();
    
    showNotification('ุชู ุชุตุฏูุฑ ุงูุจูุงูุงุช ุจูุฌุงุญ!', 'success');
}
// Member Panel Functions

function showMemberLoginModal() {
    showModal('memberLoginModal');
}

function memberLogin() {
    const memberId = document.getElementById('memberLoginDropdown').value;
    const password = document.getElementById('memberLoginPassword').value;
    
    if (!memberId) {
        showNotification('ูุฑุฌู ุงุฎุชูุงุฑ ุนุถู', 'warning');
        return;
    }
    
    const member = members.find(m => m.id === memberId);
    if (!member) {
        showNotification('ุงูุนุถู ุบูุฑ ููุฌูุฏ', 'error');
        return;
    }
    
    if (password !== member.password) {
        showNotification('ูููุฉ ุงููุฑูุฑ ุบูุฑ ุตุญูุญุฉ!', 'error');
        return;
    }
    
    isMemberLoggedIn = true;
    currentMember = member;
    
    const mainContent = document.getElementById('mainContent');
    const memberPanel = document.getElementById('memberPanel');
    
    if (mainContent) mainContent.style.display = 'none';
    if (memberPanel) memberPanel.style.display = 'block';
    
    closeModal('memberLoginModal');
    loadMemberDashboard();
    showNotification(`ูุฑุญุจุงู ${member.name}! ๐ค`, 'success');
    
    document.getElementById('memberLoginPassword').value = '';
}

function logoutMember() {
    if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุชุณุฌูู ุงูุฎุฑูุฌุ')) {
        isMemberLoggedIn = false;
        currentMember = null;
        
        const mainContent = document.getElementById('mainContent');
        const memberPanel = document.getElementById('memberPanel');
        
        if (mainContent) mainContent.style.display = 'block';
        if (memberPanel) memberPanel.style.display = 'none';
        
        updateUIComplete();
        showNotification('ุชู ุชุณุฌูู ุงูุฎุฑูุฌ ุจูุฌุงุญ', 'success');
    }
}

window.loadMemberDashboard = function() {
    if (!currentMember) return;
    
    const dashboard = document.getElementById('memberDashboard');
    if (!dashboard) return;
    
    const level = calculateLevel(currentMember.talanton || 0);
    const memberAttendance = attendance.filter(a => a.memberId === currentMember.id);
    const memberHistory = talantonHistory.filter(h => h.memberId === currentMember.id).slice(0, 5);
    const memberTasks = tasks.filter(task => 
        task.assignedService === 'all' || task.assignedService === currentMember.service
    );
    
    dashboard.innerHTML = `
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
            <div style="background: var(--card-color); border-radius: 15px; padding: 20px; text-align: center;">
                <h3 style="color: var(--primary-color); margin-bottom: 15px;">ูุนูููุงุชู</h3>
                <div class="level-badge ${level.color}" style="margin-bottom: 15px;">
                    ${level.icon} ${level.name}
                </div>
                <div style="font-size: 2rem; font-weight: bold; color: var(--warning-color); margin-bottom: 10px;">
                    ๐ฐ ${currentMember.talanton || 0}
                </div>
                <div>ููุงุท Talanton</div>
            </div>
            
            <div style="background: var(--card-color); border-radius: 15px; padding: 20px;">
                <h3 style="color: var(--primary-color); margin-bottom: 15px;">ุฅุญุตุงุฆูุงุชู</h3>
                <div style="margin-bottom: 10px;">๐ ุฃูุงู ุงูุญุถูุฑ: ${memberAttendance.length}</div>
                <div style="margin-bottom: 10px;">โช ุงูุฎุฏูุฉ: ${getServiceName(currentMember.service)}</div>
                <div style="margin-bottom: 10px;">๐ ุงูููุทูุฉ: ${currentMember.area || 'ุบูุฑ ูุญุฏุฏ'}</div>
                <div>๐ ุนุถู ููุฐ: ${new Date(currentMember.joinDate).toLocaleDateString('ar')}</div>
            </div>
            
            <div style="background: var(--card-color); border-radius: 15px; padding: 20px;">
                <h3 style="color: var(--primary-color); margin-bottom: 15px;">ููุงูู (${memberTasks.length})</h3>
                ${memberTasks.slice(0, 3).map(task => `
                    <div style="margin-bottom: 10px; padding: 10px; background: var(--surface-color); border-radius: 10px;">
                        <div style="font-weight: bold;">${task.title}</div>
                        <div style="font-size: 0.9rem; opacity: 0.8;">๐ฐ ${task.points} ููุทุฉ</div>
                    </div>
                `).join('')}
                ${memberTasks.length > 3 ? `<div style="text-align: center; margin-top: 10px; opacity: 0.7;">ูุฃูุซุฑ...</div>` : ''}
            </div>
        </div>
        
        <div style="margin-top: 20px; background: var(--card-color); border-radius: 15px; padding: 20px;">
            <h3 style="color: var(--primary-color); margin-bottom: 15px;">ุขุฎุฑ ุงููุนุงููุงุช</h3>
            ${memberHistory.length > 0 ? 
                memberHistory.map(h => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; margin-bottom: 10px; background: var(--surface-color); border-radius: 10px;">
                        <div>
                            <div style="font-weight: bold;">${h.reason}</div>
                            <div style="font-size: 0.9rem; opacity: 0.8;">${new Date(h.date).toLocaleDateString('ar')}</div>
                        </div>
                        <div style="font-weight: bold; color: ${h.type === 'add' ? 'var(--success-color)' : 'var(--danger-color)'};">
                            ${h.type === 'add' ? '+' : '-'}${h.amount} ููุทุฉ
                        </div>
                    </div>
                `).join('') :
                '<p style="text-align: center; opacity: 0.7;">ูุง ุชูุฌุฏ ูุนุงููุงุช</p>'
            }
        </div>
    `;
}

function showMyProfile() {
    if (currentMember) {
        showMemberProfile();
    }
}

function showMyTasks() {
    if (currentMember) {
        showMemberTasks();
    }
}

function showMyHistory() {
    if (!currentMember) return;
    
    const memberHistory = talantonHistory.filter(h => h.memberId === currentMember.id);
    let historyInfo = `ุชุงุฑูุฎ ููุงุท ${currentMember.name}:\n\n`;
    
    if (memberHistory.length > 0) {
        memberHistory.forEach((h, index) => {
            historyInfo += `${index + 1}. ${h.reason}\n`;
            historyInfo += `   ${h.type === 'add' ? '+' : '-'}${h.amount} ููุทุฉ\n`;
            historyInfo += `   ุงูุชุงุฑูุฎ: ${new Date(h.date).toLocaleDateString('ar')}\n\n`;
        });
    } else {
        historyInfo += 'ูุง ุชูุฌุฏ ูุนุงููุงุช ุณุงุจูุฉ.';
    }
    
    alert(historyInfo);
}
/* Complete CSS Styles for Church Attendance System */

* { margin: 0; padding: 0; box-sizing: border-box; }

:root {
    --primary-color: #6366f1; --secondary-color: #8b5cf6; --success-color: #10b981;
    --warning-color: #f59e0b; --danger-color: #ef4444; --info-color: #3b82f6;
    --dark-bg: #0f172a; --dark-surface: #1e293b; --dark-card: #334155;
    --light-bg: #f8fafc; --light-surface: #ffffff; --light-card: #f1f5f9;
    --text-light: #ffffff; --text-dark: #0f172a;
    --border-light: #e2e8f0; --border-dark: #475569;
    --shadow-light: rgba(0, 0, 0, 0.1); --shadow-dark: rgba(0, 0, 0, 0.3);
}

[data-theme="light"] {
    --bg-color: var(--light-bg); --surface-color: var(--light-surface);
    --card-color: var(--light-card); --text-color: var(--text-dark);
    --border-color: var(--border-light); --shadow-color: var(--shadow-light);
}

[data-theme="dark"] {
    --bg-color: var(--dark-bg); --surface-color: var(--dark-surface);
    --card-color: var(--dark-card); --text-color: var(--text-light);
    --border-color: var(--border-dark); --shadow-color: var(--shadow-dark);
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, var(--bg-color), var(--card-color));
    color: var(--text-color); transition: all 0.3s ease; min-height: 100vh;
}

.container { max-width: 1400px; margin: 0 auto; padding: 20px; }

.header {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white; padding: 40px; border-radius: 25px; margin-bottom: 30px;
    box-shadow: 0 25px 50px var(--shadow-color); text-align: center; position: relative;
    overflow: hidden;
}

.header::before {
    content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
    background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
    animation: shine 3s infinite;
}

@keyframes shine {
    0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
    100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
}

.header h1 { font-size: 3rem; margin-bottom: 15px; text-shadow: 0 4px 8px rgba(0,0,0,0.3); position: relative; z-index: 1; }
.header p { opacity: 0.9; font-size: 1.3rem; position: relative; z-index: 1; }

.version {
    position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.2);
    padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; z-index: 2;
}

.controls {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;
    margin-bottom: 30px; background: var(--surface-color); padding: 25px; border-radius: 20px;
    box-shadow: 0 15px 35px var(--shadow-color);
}

.btn {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white; border: none; padding: 15px 25px; border-radius: 15px; cursor: pointer;
    font-size: 16px; font-weight: bold; transition: all 0.3s ease;
    box-shadow: 0 8px 20px var(--shadow-color); display: flex; align-items: center;
    justify-content: center; gap: 10px; position: relative; overflow: hidden;
}

.btn::before {
    content: ''; position: absolute; top: 50%; left: 50%; width: 0; height: 0;
    background: rgba(255,255,255,0.2); border-radius: 50%; transition: all 0.3s ease;
    transform: translate(-50%, -50%);
}

.btn:hover::before { width: 300px; height: 300px; }
.btn:hover { transform: translateY(-3px); box-shadow: 0 15px 35px var(--shadow-color); }
.btn-success { background: linear-gradient(135deg, var(--success-color), #059669); }
.btn-warning { background: linear-gradient(135deg, var(--warning-color), #d97706); }
.btn-danger { background: linear-gradient(135deg, var(--danger-color), #dc2626); }
.btn-info { background: linear-gradient(135deg, var(--info-color), #1d4ed8); }
.btn-secondary { background: linear-gradient(135deg, #6b7280, #4b5563); }

.card {
    background: var(--surface-color); border-radius: 25px; padding: 35px; margin-bottom: 30px;
    box-shadow: 0 20px 40px var(--shadow-color); border: 1px solid var(--border-color);
    transition: all 0.3s ease; position: relative; overflow: hidden;
}

.card::before {
    content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
    transition: left 0.5s ease;
}

.card:hover::before { left: 100%; }
.card:hover { transform: translateY(-5px); box-shadow: 0 30px 60px var(--shadow-color); }

.card h2 {
    color: var(--primary-color); margin-bottom: 25px; font-size: 2rem; font-weight: bold;
    display: flex; align-items: center; gap: 15px; position: relative; z-index: 1;
}

.member-selector { margin-bottom: 25px; }

.member-dropdown {
    width: 100%; padding: 15px; border: 2px solid var(--border-color); border-radius: 15px;
    background: var(--card-color); color: var(--text-color); font-size: 16px; cursor: pointer;
    transition: all 0.3s ease;
}

.member-dropdown:focus {
    outline: none; border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
}

.member-info-display {
    margin-top: 20px; padding: 20px; background: var(--card-color); border-radius: 15px;
    border: 2px solid var(--border-color); display: none; animation: fadeIn 0.3s ease;
}

.member-info-display.active { display: block; }

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.stats-grid {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 25px; margin: 25px 0;
}

.stat-card {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white; padding: 30px; border-radius: 20px; text-align: center;
    box-shadow: 0 15px 35px var(--shadow-color); transition: all 0.3s ease;
    position: relative; overflow: hidden;
}

.stat-card::before {
    content: ''; position: absolute; top: -50%; right: -50%; width: 100%; height: 100%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
    animation: float 6s ease-in-out infinite;
}

@keyframes float {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(180deg); }
}

.stat-card:hover { transform: translateY(-8px) scale(1.02); box-shadow: 0 25px 50px var(--shadow-color); }
.stat-number { font-size: 3rem; font-weight: bold; margin-bottom: 10px; position: relative; z-index: 1; }
.stat-label { opacity: 0.9; font-size: 1.2rem; position: relative; z-index: 1; }

.modal {
    display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.8); z-index: 10000; backdrop-filter: blur(10px);
    animation: modalFadeIn 0.3s ease;
}

@keyframes modalFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.modal-content {
    background: var(--surface-color); margin: 5% auto; padding: 40px; border-radius: 25px;
    width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto;
    box-shadow: 0 30px 60px rgba(0,0,0,0.3); animation: modalSlideIn 0.3s ease;
    position: relative;
}

@keyframes modalSlideIn {
    from { transform: translateY(-50px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

.close {
    color: var(--text-color); float: left; font-size: 28px; font-weight: bold;
    cursor: pointer; transition: all 0.3s ease; position: absolute; top: 15px; left: 15px;
}

.close:hover { color: var(--danger-color); transform: scale(1.2) rotate(90deg); }

.form-group { margin-bottom: 25px; }

.form-group label {
    display: block; margin-bottom: 10px; font-weight: bold;
    color: var(--text-color); font-size: 1.1rem;
}

.form-group input, .form-group select, .form-group textarea {
    width: 100%; padding: 15px; border: 2px solid var(--border-color); border-radius: 10px;
    background: var(--card-color); color: var(--text-color); font-size: 16px; transition: all 0.3s ease;
}

.form-group input[type="password"] { font-family: 'Courier New', monospace; letter-spacing: 2px; }

.form-group input:focus, .form-group select:focus, .form-group textarea:focus {
    outline: none; border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); transform: scale(1.02);
}

.admin-panel, .member-panel { display: none; }

.tab-buttons { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 30px; }

.tab-btn {
    background: var(--card-color); border: 2px solid var(--border-color); color: var(--text-color);
    padding: 15px 25px; border-radius: 15px; cursor: pointer; transition: all 0.3s ease; font-weight: bold;
    position: relative; overflow: hidden;
}

.tab-btn::before {
    content: ''; position: absolute; bottom: 0; left: 0; width: 0; height: 3px;
    background: var(--primary-color); transition: width 0.3s ease;
}

.tab-btn:hover::before { width: 100%; }

.tab-btn.active {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white; border-color: var(--primary-color); box-shadow: 0 8px 20px var(--shadow-color);
}

.tab-btn.active::before { width: 100%; background: rgba(255,255,255,0.3); }

.tab-content { display: none; }
.tab-content.active { display: block; animation: fadeIn 0.3s ease; }

.table {
    width: 100%; border-collapse: collapse; margin-top: 25px; background: var(--surface-color);
    border-radius: 15px; overflow: hidden; box-shadow: 0 10px 25px var(--shadow-color);
}

.table th, .table td { padding: 15px; text-align: right; border-bottom: 1px solid var(--border-color); }

.table th {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white; font-weight: bold; position: relative;
}

.table tr { transition: all 0.3s ease; }
.table tr:hover { background: var(--card-color); transform: scale(1.01); }

.level-badge {
    padding: 8px 16px; border-radius: 25px; font-size: 0.9rem; font-weight: bold;
    color: white; display: inline-flex; align-items: center; gap: 5px;
    animation: pulse 2s infinite;
}

.level-beginner { background: linear-gradient(135deg, var(--success-color), #059669); }
.level-intermediate { background: linear-gradient(135deg, var(--info-color), #1d4ed8); }
.level-advanced { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); }
.level-expert { background: linear-gradient(135deg, var(--warning-color), #d97706); }
.level-legend { background: linear-gradient(135deg, var(--danger-color), #dc2626); }

.fingerprint-scanner {
    text-align: center; padding: 40px; background: var(--card-color);
    border-radius: 20px; margin: 20px 0; position: relative; overflow: hidden;
}

.fingerprint-scanner::before {
    content: ''; position: absolute; top: 50%; left: 50%; width: 100px; height: 100px;
    border: 2px solid var(--primary-color); border-radius: 50%; opacity: 0;
    transform: translate(-50%, -50%); animation: scanPulse 2s infinite;
}

@keyframes scanPulse {
    0% { width: 100px; height: 100px; opacity: 1; }
    100% { width: 200px; height: 200px; opacity: 0; }
}

.fingerprint-icon {
    font-size: 4rem; color: var(--primary-color); margin-bottom: 20px; cursor: pointer;
    transition: all 0.3s ease; display: inline-block; position: relative; z-index: 1;
}

.fingerprint-icon:hover { transform: scale(1.1); color: var(--success-color); }

.notification {
    position: fixed; top: 20px; right: 20px; padding: 20px; border-radius: 15px;
    color: white; font-weight: bold; z-index: 10001; min-width: 300px;
    box-shadow: 0 10px 25px var(--shadow-color); animation: notificationSlide 0.3s ease;
}

@keyframes notificationSlide {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

.firebase-status {
    padding: 15px; border-radius: 10px; margin: 15px 0;
    text-align: center; font-weight: bold; animation: statusPulse 2s infinite;
}

@keyframes statusPulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.8; }
}

.firebase-connected { background: linear-gradient(135deg, var(--success-color), #059669); color: white; }
.firebase-disconnected { background: linear-gradient(135deg, var(--warning-color), #d97706); color: white; }

.birthday-alert {
    background: linear-gradient(135deg, var(--warning-color), #d97706);
    color: white; padding: 15px; border-radius: 15px; margin: 15px 0; text-align: center;
    animation: birthdayBounce 1s ease infinite alternate;
}

@keyframes birthdayBounce {
    from { transform: translateY(0); }
    to { transform: translateY(-5px); }
}

.form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }

.action-buttons {
    display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; margin: 20px 0;
}

.store-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }

.product-card {
    background: var(--card-color); border: 2px solid var(--border-color);
    border-radius: 15px; padding: 20px; transition: all 0.3s ease; position: relative; overflow: hidden;
}

.product-card::before {
    content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
    background: linear-gradient(45deg, transparent, rgba(99, 102, 241, 0.1), transparent);
    transition: transform 0.5s ease; transform: rotate(45deg) translateX(-100%);
}

.product-card:hover::before { transform: rotate(45deg) translateX(100%); }
.product-card:hover { transform: translateY(-5px); box-shadow: 0 15px 35px var(--shadow-color); }
.product-price { color: var(--warning-color); font-weight: bold; font-size: 1.2rem; }
.product-stock { color: var(--success-color); font-size: 0.9rem; }

.quick-attendance-input {
    background: var(--card-color); border: 2px solid var(--border-color);
    border-radius: 15px; padding: 20px; margin: 20px 0; text-align: center;
}

.quick-input {
    padding: 15px; border: 2px solid var(--border-color); border-radius: 10px;
    background: var(--surface-color); color: var(--text-color); font-size: 18px;
    text-align: center; width: 150px; margin: 0 10px; transition: all 0.3s ease;
}

.quick-input:focus { transform: scale(1.05); box-shadow: 0 0 20px rgba(99, 102, 241, 0.3); }

.chart-container {
    position: relative; height: 400px; margin: 30px 0; background: var(--card-color);
    border-radius: 20px; padding: 20px; box-shadow: 0 10px 25px var(--shadow-color);
}

.add-button {
    background: linear-gradient(135deg, var(--success-color), #059669);
    color: white; border: none; padding: 12px 20px; border-radius: 10px; cursor: pointer;
    font-size: 14px; font-weight: bold; margin-bottom: 20px; transition: all 0.3s ease;
}

.add-button:hover { transform: translateY(-2px); box-shadow: 0 8px 20px var(--shadow-color); }

.status-present { color: var(--success-color); font-weight: bold; }
.status-late { color: var(--warning-color); font-weight: bold; }
.status-absent { color: var(--danger-color); font-weight: bold; }

@media (max-width: 768px) {
    .header h1 { font-size: 2rem; }
    .controls { grid-template-columns: 1fr; }
    .stats-grid { grid-template-columns: 1fr; }
    .form-row { grid-template-columns: 1fr; }
    .modal-content { width: 95%; margin: 5% auto; padding: 25px; }
    .tab-buttons { flex-direction: column; }
    .store-grid { grid-template-columns: 1fr; }
    .action-buttons { flex-direction: column; }
}
