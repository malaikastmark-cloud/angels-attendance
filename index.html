<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>نظام حضور الأعضاء</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
<style>
body { font-family: 'Arial', sans-serif; background: #f0f2f5; color: #333; }
header { background: #3498db; color: #fff; padding: 15px; text-align: center; border-radius:0 0 10px 10px; }
.container { padding: 20px; }
.card { border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 20px; }
.member-img { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
.top-member-item { display:flex; justify-content: space-between; align-items:center; margin-bottom:10px; padding:5px 10px; background:#e3f2fd; border-radius:5px; }
.medal { font-size: 1.2em; }
#notification { position:fixed; top:10px; right:10px; padding:10px 15px; border-radius:5px; color:#fff; display:none; z-index:9999; }
.login-failed { border:2px solid #e74c3c !important; }
</style>
</head>
<body>
<header>
  <h1>نظام حضور الأعضاء</h1>
</header>
<div class="container">
  <!-- واجهة المستخدم -->
  <div id="userAttendance" class="card p-3">
    <h3>تسجيل الحضور</h3>
    <div class="row mb-3">
      <div class="col-md-5">
        <label>اختر العضو:</label>
        <select id="selectMember" class="form-select"></select>
      </div>
      <div class="col-md-5">
        <label>اختر الأسبوع:</label>
        <select id="weekSelect" class="form-select"></select>
      </div>
      <div class="col-md-2 d-flex align-items-end">
        <button id="markPresent" class="btn btn-success w-100">تسجيل حضور</button>
      </div>
    </div>
    <div class="mb-3">
      <canvas id="attendanceChart"></canvas>
    </div>
    <div class="d-flex justify-content-between">
      <div>عدد الحضور: <span id="attendanceCount">0</span></div>
      <div>مجموع النقاط: <span id="totalPoints">0</span></div>
    </div>
    <hr>
    <button id="adminLoginBtn" class="btn btn-primary mt-3">تسجيل دخول كأدمن</button>
  </div>

  <!-- لوحة تحكم الأدمن -->
  <div id="adminTabs" style="display:none;">
    <h3>لوحة تحكم الأدمن</h3>
    <div class="card p-3">
      <h5>الأعضاء</h5>
      <div class="row mb-2">
        <div class="col-md-3"><input type="text" id="newMemberName" placeholder="اسم العضو" class="form-control"></div>
        <div class="col-md-3"><input type="text" id="newMemberEmoji" placeholder="إيموجي" class="form-control"></div>
        <div class="col-md-4"><input type="text" id="newMemberImage" placeholder="رابط الصورة" class="form-control"></div>
        <div class="col-md-2"><button id="addMemberBtn" class="btn btn-success w-100">إضافة عضو</button></div>
      </div>
      <table class="table table-bordered" id="membersTable">
        <thead>
          <tr><th>#</th><th>الصورة</th><th>الاسم</th><th>النقاط</th><th>المكافآت</th><th>تعديل</th><th>حذف</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="card p-3">
      <h5>الأسابيع</h5>
      <div class="row mb-2">
        <div class="col-md-3"><input type="text" id="newWeekName" placeholder="اسم الأسبوع" class="form-control"></div>
        <div class="col-md-3"><input type="date" id="newWeekStart" class="form-control"></div>
        <div class="col-md-3"><input type="date" id="newWeekEnd" class="form-control"></div>
        <div class="col-md-3"><button id="addWeekBtn" class="btn btn-success w-100">إضافة أسبوع</button></div>
      </div>
      <table class="table table-bordered" id="weeksTable">
        <thead>
          <tr><th>#</th><th>اسم الأسبوع</th><th>من</th><th>إلى</th><th>تعديل</th><th>حذف</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="card p-3">
      <h5>الحضور</h5>
      <div class="row mb-2">
        <div class="col-md-3">
          <select id="extraPointMember" class="form-select"></select>
        </div>
        <div class="col-md-2"><input type="number" id="extraPointsValue" value="1" class="form-control"></div>
        <div class="col-md-4"><input type="text" id="extraPointsReason" placeholder="السبب" class="form-control"></div>
        <div class="col-md-3"><button id="addExtraPointsBtn" class="btn btn-warning w-100">إضافة نقاط</button></div>
      </div>
      <div class="row mb-2">
        <div class="col-md-6">
          <select id="deleteWeekSelect" class="form-select"></select>
        </div>
        <div class="col-md-6">
          <button id="deleteAttendanceBtn" class="btn btn-danger w-100">حذف حضور أسبوع كامل</button>
        </div>
      </div>
      <table class="table table-bordered" id="attendanceRecordsBody">
        <thead>
          <tr><th>#</th><th>العضو</th><th>الأسبوع</th><th>التاريخ</th><th>حذف</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="card p-3">
      <h5>التقارير</h5>
      <div class="d-flex gap-2">
        <button id="printReportBtn" class="btn btn-info">طباعة التقرير</button>
        <button id="exportExcelBtn" class="btn btn-success">تصدير لإكسل</button>
      </div>
    </div>
    <div class="card p-3">
      <h5>أفضل 10 أعضاء</h5>
      <div id="topMembersList"></div>
    </div>
    <div class="card p-3">
      <h5>إحصائيات الأعضاء</h5>
      <div id="membersStatsContainer" class="d-flex flex-wrap gap-2"></div>
    </div>
    <button id="backToUserView" class="btn btn-secondary mt-3">العودة لواجهة المستخدم</button>
  </div>
</div>

<div id="notification"></div>

<!-- نافذة تسجيل دخول الأدمن -->
<div id="adminLoginModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center;">
  <div style="background:#fff; padding:20px; border-radius:10px; width:300px; text-align:center;">
    <h5>تسجيل دخول الأدمن</h5>
    <input type="password" id="adminPassword" placeholder="كلمة السر" class="form-control mb-3">
    <button id="confirmAdminLogin" class="btn btn-primary w-100 mb-2">تسجيل دخول</button>
    <button id="cancelAdminLogin" class="btn btn-secondary w-100">إلغاء</button>
  </div>
</div>

<script>
// الكود كامل إدارة الأعضاء، الحضور، الأسابيع، التقارير، الرسم البياني، إشعارات، لوحة الأدمن
// هنا ضع الكود الذي أرسلته مسبقًا، كل الوظائف موجودة كما هي في المثال السابق
// initializeApp() عند تحميل الصفحة
</script>
</body>
</html>
