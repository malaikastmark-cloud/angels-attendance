<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø§Ø¬ØªÙ…Ø§Ø¹ Ø®Ø¯Ø§Ù… Ù…Ù„Ø§ÙŠÙƒØ© â€” Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ù†Ù‚Ø§Ø·</title>
<style>
  :root{
    --c1:#0d6efd; --c2:#20c997; --c3:#6c757d; --danger:#dc3545; --warn:#ffc107; --ok:#198754; --bg:#f7f7fb;
    --card:#ffffff; --text:#1f2328; --muted:#747b83; --border:#e5e7eb;
  }
  body{font-family:system-ui,Segoe UI,Tahoma,Arial; background:var(--bg); color:var(--text); margin:0}
  header{background:linear-gradient(135deg,var(--c1),var(--c2)); color:#fff; padding:18px 16px}
  header h1{margin:0 0 4px;font-size:22px}
  header small{opacity:.9}
  main{padding:14px}
  .card{background:var(--card); border:1px solid var(--border); border-radius:14px; padding:14px; margin-bottom:14px; box-shadow:0 6px 16px rgba(0,0,0,.04)}
  .row{display:flex; gap:12px; flex-wrap:wrap}
  .col{flex:1 1 320px}
  label{display:block; font-size:14px; margin:.2rem 0 .1rem}
  select,input,button,textarea{
    font:inherit; padding:10px 12px; border-radius:10px; border:1px solid var(--border); background:#fff
  }
  button{cursor:pointer; border:none; background:var(--c1); color:#fff}
  button.ghost{background:#fff; color:var(--text); border:1px solid var(--border)}
  button.warn{background:var(--warn); color:#000}
  button.ok{background:var(--ok)}
  button.danger{background:var(--danger)}
  button:disabled{opacity:.6; cursor:not-allowed}
  table{width:100%; border-collapse:separate; border-spacing:0; overflow:auto}
  thead th{background:#f1f3f5; font-weight:600}
  th,td{border-bottom:1px solid var(--border); padding:10px; text-align:right}
  .toolbar{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
  .muted{color:var(--muted)}
  .badge{display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; background:#eef3ff; color:#224488; border:1px solid #dfe7ff}
  .hidden{display:none !important}
  .grid-2{display:grid; grid-template-columns:1fr 1fr; gap:10px}
  .grid-3{display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:10px}
  .hr{height:1px; background:var(--border); margin:10px 0}
  .toast{
    position:fixed; inset-inline: 12px 12px; bottom:12px; z-index:50;
    display:flex; gap:10px; align-items:center; background:#fff; border:1px solid var(--border);
    box-shadow:0 10px 18px rgba(0,0,0,.08); border-radius:12px; padding:10px 12px
  }
  .link{color:var(--c1); text-decoration:underline; cursor:pointer}
</style>
</head>
<body>
<header>
  <h1>Ø§Ø¬ØªÙ…Ø§Ø¹ Ø®Ø¯Ø§Ù… Ù…Ù„Ø§ÙŠÙƒØ©</h1>
  <small>Ø§Ù„Ø­Ø¶ÙˆØ± ÙŠØ³Ø§ÙˆÙŠ Ù†Ù‚Ø·Ø© â€” ÙˆØ§Ù„Ù…Ù‡Ø§Ù… ØªØ¶ÙŠÙ Ù†Ù‚Ø§Ø· â€” ÙˆÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù…ÙƒØ§ÙØ¢Øª ÙŠØ¯ÙˆÙŠÙ‹Ø§</small>
</header>

<main>

  <!-- ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© -->
  <div id="events-toast" class="toast hidden">
    <div>ğŸ”” <b>ØªØ°ÙƒÙŠØ±:</b> Ù„Ø¯ÙŠÙƒ Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ù‚Ø§Ø¯Ù…Ø© Ù‚Ø±ÙŠØ¨Ù‹Ø§.</div>
    <div class="toolbar">
      <button class="ghost" id="btnSeeEvents">Ø¹Ø±Ø¶</button>
      <button class="ghost" id="btnDismissEvents">Ø¥Ø®ÙØ§Ø¡</button>
    </div>
  </div>

  <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± (Ù„Ù„Ø¬Ù…ÙŠØ¹) -->
  <section class="card">
    <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
    <div class="row">
      <div class="col">
        <label>Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ:</label>
        <select id="selMember"><option value="">-- Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ --</option></select>
      </div>
      <div class="col">
        <label>Ø§Ø®ØªØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹:</label>
        <select id="selWeek"><option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ --</option></select>
      </div>
      <div class="col" style="align-self:end">
        <button id="btnCheckin">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±</button>
      </div>
    </div>
    <div class="muted" id="checkinInfo">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
  </section>

  <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…/Ø§Ù„Ø£Ø¯Ù…Ù† -->
  <section class="card">
    <h3>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†</h3>
    <div class="toolbar">
      <input id="adminPass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ø£Ø¯Ù…Ù† (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" />
      <button id="btnAdminLogin">Ø¯Ø®ÙˆÙ„</button>
      <button id="btnAdminLogout" class="ghost hidden">Ø¥Ù„ØºØ§Ø¡ Ø¯Ø®ÙˆÙ„</button>
    </div>
    <div class="muted">Ø¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ ØªØ¸Ù‡Ø± Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¨Ø§Ù„Ø£Ø³ÙÙ„.</div>
  </section>

  <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ -->
  <section class="card admin-only hidden" id="secMembers">
    <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</h3>
    <div class="toolbar">
      <input id="memName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ø¶Ùˆ" />
      <input id="memPhoto" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" />
      <button id="btnAddMember" class="ok">Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ</button>
    </div>

    <div class="hr"></div>
    <div class="muted">** Ø²Ø± <b>Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø§Ø·</b> ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù† ÙˆÙŠØ²ÙŠØ¯ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ÙŠØ¯ÙˆÙŠØ©ØŒ ÙˆØ§Ù„Ù…Ø¬Ù…ÙˆØ¹ ÙŠÙØ­Ø³Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ (Ø­Ø¶ÙˆØ± + Ù…Ù‡Ø§Ù… + ÙŠØ¯ÙˆÙŠ). </div>
    <div style="overflow:auto">
      <table id="tblMembers">
        <thead><tr>
          <th>#</th><th>Ø§Ù„ØµÙˆØ±Ø©</th><th>Ø§Ø³Ù… Ø§Ù„Ø¹Ø¶Ùˆ</th>
          <th>Ø§Ù„Ø­Ø¶ÙˆØ±</th><th>Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ù‡Ø§Ù…</th><th>Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ÙŠØ¯ÙˆÙŠØ©</th><th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø§Ø·</th>
          <th>Ù…ÙƒØ§ÙØ¢Øª</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
        </tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹ -->
  <section class="card admin-only hidden" id="secWeeks">
    <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹</h3>
    <div class="toolbar">
      <input id="weekName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹" />
      <input id="weekFrom" type="date" />
      <input id="weekTo" type="date" />
      <button id="btnAddWeek" class="ok">Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ø¨ÙˆØ¹</button>
    </div>
    <div class="hr"></div>
    <table id="tblWeeks">
      <thead><tr><th>#</th><th>Ø§Ø³Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</th><th>Ù…Ù†</th><th>Ø¥Ù„Ù‰</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Ø¥Ø¯Ø§Ø±Ø© ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±: ØªØ¹Ø¯ÙŠÙ„/Ø­Ø°Ù -->
  <section class="card admin-only hidden" id="secAttendance">
    <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
    <div class="toolbar">
      <label>Ø§Ø®ØªØ± Ø£Ø³Ø¨ÙˆØ¹:</label>
      <select id="selWeekAdmin"></select>
      <button id="btnDeleteWeekAttendance" class="danger">Ø­Ø°Ù ÙƒÙ„ Ø­Ø¶ÙˆØ± Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</button>
    </div>
    <div class="hr"></div>
    <table id="tblAttendance">
      <thead><tr><th>#</th><th>Ø§Ù„Ø¹Ø¶Ùˆ</th><th>Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù… (Ù„Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©) -->
  <section class="card admin-only hidden" id="secTasks">
    <h3>Ø§Ù„Ù…Ù‡Ø§Ù…</h3>
    <div class="toolbar">
      <select id="taskMember"></select>
      <input id="taskTitle" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø© / Ø§Ù„ÙˆØµÙ" />
      <input id="taskPoints" type="number" placeholder="Ø§Ù„Ù†Ù‚Ø§Ø·" />
      <button id="btnAddTask" class="ok">Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©</button>
    </div>
    <div class="hr"></div>
    <table id="tblTasks">
      <thead><tr><th>#</th><th>Ø§Ù„Ø¹Ø¶Ùˆ</th><th>Ø§Ù„Ù…Ù‡Ù…Ø©</th><th>Ø§Ù„Ù†Ù‚Ø§Ø·</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© + ØªÙ†Ø¨ÙŠÙ‡ -->
  <section class="card admin-only hidden" id="secEvents">
    <h3>Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h3>
    <div class="toolbar">
      <input id="eventTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© (Ù…Ø«Ø§Ù„: Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯ ÙÙ„Ø§Ù†)" />
      <input id="eventDate" type="date" />
      <select id="eventType">
        <option value="event">Ù…Ù†Ø§Ø³Ø¨Ø©</option>
        <option value="birthday">Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯</option>
      </select>
      <input id="eventNotifyDays" type="number" placeholder="Ø£ÙŠØ§Ù… Ù‚Ø¨Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ (Ù…Ø«Ù„Ø§Ù‹ 2)" />
      <button id="btnAddEvent" class="ok">Ø¥Ø¶Ø§ÙØ©</button>
    </div>
    <div class="hr"></div>
    <table id="tblEvents">
      <thead><tr><th>#</th><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ù‚Ø¨Ù„ (Ø£ÙŠØ§Ù…)</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¨Ø³ÙŠØ·Ø© -->
  <section class="card admin-only hidden" id="secReports">
    <h3>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h3>
    <div class="grid-3">
      <div class="card"><div class="muted">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¶ÙˆØ±</div><div id="statTotalAttendance" style="font-size:26px">0</div></div>
      <div class="card"><div class="muted">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·</div><div id="statTotalPoints" style="font-size:26px">0</div></div>
      <div class="card"><div class="muted">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</div><div id="statMembers" style="font-size:26px">0</div></div>
    </div>
  </section>

  <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… / Firebase -->
  <section class="card" id="secSettings">
    <h3>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
    <div class="grid-2">
      <div>
        <div class="muted">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase (ØªÙØ­ÙØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­):</div>
        <div class="grid-2" style="grid-template-columns:1fr 1fr">
          <input id="cfg_apiKey" placeholder="apiKey" />
          <input id="cfg_authDomain" placeholder="authDomain" />
          <input id="cfg_databaseURL" placeholder="databaseURL" />
          <input id="cfg_projectId" placeholder="projectId" />
          <input id="cfg_storageBucket" placeholder="storageBucket" />
          <input id="cfg_messagingSenderId" placeholder="messagingSenderId" />
          <input id="cfg_appId" placeholder="appId" />
        </div>
        <div class="toolbar" style="margin-top:8px">
          <button id="btnSaveFirebase" class="ok">Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase</button>
          <button id="btnSync" class="ghost">Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©</button>
          <button id="btnReset" class="warn">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† (Ù…Ø­Ù„ÙŠ)</button>
        </div>
      </div>
      <div>
        <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø· Ù„ÙƒÙ„ Ø­Ø¶ÙˆØ±:</label>
        <input id="pointsPerAttendance" type="number" placeholder="Ø§ÙØªØ±Ø§Ø¶ÙŠ 1" />
        <div class="muted">ØªÙØ³ØªØ®Ø¯Ù… Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ (Ø­Ø¶ÙˆØ± Ã— Ø§Ù„Ù‚ÙŠÙ…Ø© + Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ù‡Ø§Ù… + Ø§Ù„ÙŠØ¯ÙˆÙŠ).</div>
      </div>
    </div>
  </section>

</main>

<!-- Firebase (Modular) -->
<script type="module">
  // ========= Firebase bootstrap =========
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, child, push, key, get, set, update, remove, onValue, runTransaction, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  // ---- local config storage
  const cfgKey = "angels.firebase.config";
  const adminKey = "angels.admin";
  const toastKey = "angels.events.toast.dismissed";
  const defaultSettings = { pointsPerAttendance: 1 };

  let app, db;
  let settings = { ...defaultSettings };

  function loadCfg(){
    try{
      return JSON.parse(localStorage.getItem(cfgKey) || "{}");
    }catch{ return {}; }
  }
  function saveCfg(cfg){
    localStorage.setItem(cfgKey, JSON.stringify(cfg||{}));
  }

  function ui$q(id){ return document.getElementById(id); }
  const $ = ui$q;

  function isAdmin(){ return localStorage.getItem(adminKey) === "1"; }
  function setAdmin(on){ localStorage.setItem(adminKey, on ? "1":"0"); refreshAdminUI(); }

  function fillFirebaseForm(cfg){
    ["apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId"].forEach(k=>{
      const el = $(`cfg_${k}`); if(el) el.value = cfg[k] || "";
    });
  }
  function readFirebaseForm(){
    const cfg = {};
    ["apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId"].forEach(k=>{
      cfg[k] = $(`cfg_${k}`).value.trim();
    });
    return cfg;
  }

  async function boot(){
    const cfg = loadCfg(); fillFirebaseForm(cfg);
    try{
      if(!cfg.apiKey || !cfg.databaseURL) throw new Error("Firebase config Ù†Ø§Ù‚Øµ");
      app = initializeApp(cfg);
      db  = getDatabase(app);
      await ensureSettingsNode();
      attachLiveBindings();
      uiSetStatus("checkinInfo","âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.");
    }catch(err){
      console.warn(err);
      uiSetStatus("checkinInfo","âš ï¸ Ø£Ø¯Ø®Ù„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø«Ù… Ø§Ø¶ØºØ· Ø­ÙØ¸. Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯.");
    }
  }

  // ======== Settings node in DB ========
  const dbSettingsRef = () => ref(db,"settings");
  async function ensureSettingsNode(){
    const snap = await get(dbSettingsRef());
    if(!snap.exists()){
      await set(dbSettingsRef(), defaultSettings);
    }
    settings = { ...defaultSettings, ...(snap.val()||{}) };
    $("pointsPerAttendance").value = settings.pointsPerAttendance || 1;
    // watch settings
    onValue(dbSettingsRef(), s=>{
      settings = { ...defaultSettings, ...(s.val()||{}) };
      $("pointsPerAttendance").value = settings.pointsPerAttendance || 1;
      recalcAllMembersTotals(); // Ù„Ùˆ Ø¨ÙØ¯Ù‘ÙÙ„Øª Ø§Ù„Ù‚ÙŠÙ…Ø© Ù†Ø¹ÙŠØ¯ Ø§Ù„Ø­Ø³Ø§Ø¨
    });
  }

  // ======== Refs helpers ========
  const rMembers     = () => ref(db,"members");
  const rWeeks       = () => ref(db,"weeks");
  const rAttendance  = () => ref(db,"attendance");   // each: {memberId, weekId, ts}
  const rTasks       = () => ref(db,"tasks");        // each: {memberId, title, points, done}
  const rEvents      = () => ref(db,"events");       // each: {title, date, type, notifyDays}

  function newKey(r){ return push(r).key; }

  // ======== UI helpers ========
  function refreshAdminUI(){
    document.querySelectorAll(".admin-only").forEach(el=>{
      el.classList.toggle("hidden", !isAdmin());
    });
    $("btnAdminLogin").classList.toggle("hidden", isAdmin());
    $("btnAdminLogout").classList.toggle("hidden", !isAdmin());
  }
  function uiSetStatus(id, text){ const el=$(id); if(el) el.textContent = text; }
  function clear(el){ while(el.firstChild) el.removeChild(el.firstChild); }

  // ======== Members ========
  function renderMembers(list){
    // fill selects
    const selMember = $("selMember"); const taskMember = $("taskMember");
    const opts = ['<option value="">-- Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ --</option>'].concat(list.map(m=>`<option value="${m.id}">${m.name}</option>`));
    selMember.innerHTML = opts.join("");
    taskMember.innerHTML = ['<option value="">-- Ø§Ø®ØªØ± Ø¹Ø¶ÙˆÙ‹Ø§ --</option>'].concat(list.map(m=>`<option value="${m.id}">${m.name}</option>`)).join("");

    // table
    const tb = $("tblMembers").querySelector("tbody"); clear(tb);
    list.forEach((m, i)=>{
      const tr = document.createElement("tr");
      const ph = m.photoUrl ? `<img src="${m.photoUrl}" alt="${m.name}" style="width:38px;height:38px;border-radius:50%;object-fit:cover">` : "â€”";
      const att = m.stats?.attendance||0, tsk = m.stats?.tasks||0, man = m.stats?.manual||0, tot = m.stats?.total||0;
      tr.innerHTML = `
        <td>${i+1}</td>
        <td>${ph}</td>
        <td>${m.name}</td>
        <td><span class="badge">${att}</span></td>
        <td><span class="badge">${tsk}</span></td>
        <td>
          <div class="toolbar">
            <span class="badge">${man}</span>
            <input type="number" placeholder="+ Ù†Ù‚Ø§Ø·" style="width:90px" />
            <button class="ok">Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø§Ø·</button>
          </div>
        </td>
        <td><b>${tot}</b></td>
        <td>${man>0?`+${man}`:"Ù„Ø§ ÙŠÙˆØ¬Ø¯"}</td>
        <td class="toolbar">
          <button class="ghost" data-act="edit">ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="danger" data-act="remove">Ø­Ø°Ù</button>
        </td>
      `;
      tr.querySelector("button.ok").onclick = async ()=>{
        const val = Number(tr.querySelector("input[type=number]").value || "0");
        if(!val) return;
        await addManualPoints(m.id, val);
        tr.querySelector("input[type=number]").value = "";
      };
      tr.querySelector("[data-act=remove]").onclick = ()=> confirm("Ø­Ø°Ù Ø§Ù„Ø¹Ø¶Ùˆ ÙˆØ¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ØŸ") && deleteMember(m.id);
      tr.querySelector("[data-act=edit]").onclick = ()=>{
        const newName = prompt("ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…:", m.name)||"";
        if(newName && newName!==m.name) updateMember(m.id, {name:newName});
        const newPhoto = prompt("ØªØ¹Ø¯ÙŠÙ„ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):", m.photoUrl||"");
        if(newPhoto!==null) updateMember(m.id, {photoUrl:newPhoto});
      };
      tb.appendChild(tr);
    });
    $("statMembers").textContent = list.length;
  }

  async function addMember(name, photoUrl){
    const id = newKey(rMembers()); await set(child(rMembers(), id), { name, photoUrl:photoUrl||"", stats:{attendance:0, tasks:0, manual:0, total:0} });
  }
  async function deleteMember(id){
    // cascade delete: attendance, tasks
    const atSnap = await get(query(rAttendance(), orderByChild("memberId"), equalTo(id)));
    if(atSnap.exists()){
      const updates = {};
      atSnap.forEach(s=> updates[`attendance/${s.key}`] = null );
      await update(ref(db), updates);
    }
    const tkSnap = await get(query(rTasks(), orderByChild("memberId"), equalTo(id)));
    if(tkSnap.exists()){
      const updates = {};
      tkSnap.forEach(s=> updates[`tasks/${s.key}`] = null );
      await update(ref(db), updates);
    }
    await remove(child(rMembers(), id));
  }
  async function updateMember(id, data){ await update(child(rMembers(), id), data); }

  async function addManualPoints(memberId, delta){
    // increase manual and total via transaction + then recalc totals to be safe
    await runTransaction(child(rMembers(), `${memberId}/stats/manual`), cur => (Number(cur)||0) + Number(delta));
    await recalcMemberTotals(memberId);
  }

  // ======== Weeks ========
  function renderWeeks(list){
    const selWeek = $("selWeek");
    const selWeekAdmin = $("selWeekAdmin");
    const opts = ['<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ --</option>'].concat(list.map(w=>`<option value="${w.id}">${w.name}</option>`));
    selWeek.innerHTML = opts.join("");
    selWeekAdmin.innerHTML = ['<option value="">â€” Ø§Ø®ØªØ± â€”</option>'].concat(list.map(w=>`<option value="${w.id}">${w.name}</option>`)).join("");

    const tb = $("tblWeeks").querySelector("tbody"); clear(tb);
    list.forEach((w,i)=>{
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${i+1}</td><td>${w.name}</td><td>${w.from||"â€”"}</td><td>${w.to||"â€”"}</td>
        <td class="toolbar">
          <button class="ghost" data-act="edit">ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="danger" data-act="remove">Ø­Ø°Ù</button>
        </td>`;
      tr.querySelector("[data-act=remove]").onclick = ()=> confirm("Ø­Ø°Ù Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ØŸ") && remove(child(rWeeks(), w.id));
      tr.querySelector("[data-act=edit]").onclick = async ()=>{
        const name = prompt("Ø§Ø³Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹:", w.name)||w.name;
        const from = prompt("ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© (YYYY-MM-DD):", w.from||"")||w.from||"";
        const to   = prompt("ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ© (YYYY-MM-DD):", w.to||"")||w.to||"";
        await update(child(rWeeks(), w.id), {name, from, to});
      };
      tb.appendChild(tr);
    });
  }
  async function addWeek(name, from, to){ const id = newKey(rWeeks()); await set(child(rWeeks(), id), {name, from, to}); }

  // ======== Attendance ========
  async function checkin(memberId, weekId){
    if(!memberId || !weekId) return alert("Ø§Ø®ØªØ± Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø£Ø³Ø¨ÙˆØ¹");
    const id = newKey(rAttendance());
    await set(child(rAttendance(), id), { memberId, weekId, ts: Date.now() });
    await runTransaction(child(rMembers(), `${memberId}/stats/attendance`), cur => (Number(cur)||0) + 1);
    await recalcMemberTotals(memberId);
    alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± âœ…");
  }

  function renderAttendance(list, members, weeks){
    const tb = $("tblAttendance").querySelector("tbody"); clear(tb);
    const mapM = Object.fromEntries(members.map(m=>[m.id,m]));
    const mapW = Object.fromEntries(weeks.map(w=>[w.id,w]));
    list.forEach((a,i)=>{
      const tr = document.createElement("tr");
      const dt = new Date(a.ts||Date.now());
      tr.innerHTML = `
        <td>${i+1}</td>
        <td>${mapM[a.memberId]?.name || "?"}</td>
        <td>${mapW[a.weekId]?.name || "?"}</td>
        <td>${dt.toLocaleString()}</td>
        <td class="toolbar">
          <button class="ghost" data-act="edit">ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="danger" data-act="remove">Ø­Ø°Ù</button>
        </td>`;
      tr.querySelector("[data-act=remove]").onclick = async ()=>{
        if(!confirm("Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ØŸ")) return;
        await remove(child(rAttendance(), a.id));
        // Ø£Ù†Ù‚Øµ Ø§Ù„Ø¹Ø¯Ù‘Ø§Ø¯ Ø¨Ø£Ù…Ø§Ù†
        await runTransaction(child(rMembers(), `${a.memberId}/stats/attendance`), cur => Math.max(0,(Number(cur)||0) - 1));
        await recalcMemberTotals(a.memberId);
      };
      tr.querySelector("[data-act=edit]").onclick = async ()=>{
        const newMember = prompt("ØªØ¹Ø¯ÙŠÙ„ (ID Ø¹Ø¶Ùˆ) â€” Ø§ØªØ±ÙƒÙ‡ ÙƒÙ…Ø§ Ù‡Ùˆ Ù„ØªØ¨Ù‚Ù‰ Ø§Ù„Ù‚ÙŠÙ…Ø©:", a.memberId)||a.memberId;
        const newWeek   = prompt("ØªØ¹Ø¯ÙŠÙ„ (ID Ø£Ø³Ø¨ÙˆØ¹) â€” Ø§ØªØ±ÙƒÙ‡ ÙƒÙ…Ø§ Ù‡Ùˆ:", a.weekId)||a.weekId;
        const newTsStr  = prompt("ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® (YYYY-MM-DD HH:mm) â€” Ø§ØªØ±ÙƒÙ‡:", new Date(a.ts).toISOString().slice(0,16).replace("T"," "))||"";
        const newTs = newTsStr ? Date.parse(newTsStr.replace(" ","T")) : a.ts;
        const beforeMember = a.memberId;
        await update(child(rAttendance(), a.id), { memberId:newMember, weekId:newWeek, ts:newTs });
        if(newMember !== beforeMember){
          // Ø¹Ø¯Ù‘Ù„ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„Ùˆ ØªØ¨Ø¯Ù‘Ù„ Ø§Ù„Ø¹Ø¶Ùˆ
          await runTransaction(child(rMembers(), `${beforeMember}/stats/attendance`), cur => Math.max(0,(Number(cur)||0) - 1));
          await runTransaction(child(rMembers(), `${newMember}/stats/attendance`), cur => (Number(cur)||0) + 1);
          await Promise.all([recalcMemberTotals(beforeMember), recalcMemberTotals(newMember)]);
        }else{
          await recalcMemberTotals(newMember);
        }
      };
      tb.appendChild(tr);
    });
    $("statTotalAttendance").textContent = list.length;
  }

  // ======== Tasks ========
  function renderTasks(list, members){
    const tb = $("tblTasks").querySelector("tbody"); clear(tb);
    const mapM = Object.fromEntries(members.map(m=>[m.id,m]));
    list.forEach((t,i)=>{
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${i+1}</td>
        <td>${mapM[t.memberId]?.name || "?"}</td>
        <td>${t.title}</td>
        <td>${t.points||0}</td>
        <td>${t.done?'<span class="badge">Ù…Ù†Ø¬Ø²Ø©</span>':'<span class="badge" style="background:#fff0f0;border-color:#ffd6d6;color:#9c3b3b">ØºÙŠØ± Ù…Ù†Ø¬Ø²Ø©</span>'}</td>
        <td class="toolbar">
          <button class="ghost" data-act="toggle">${t.done?'ØªØ¹Ø·ÙŠÙ„':'Ø¥Ù†Ù‡Ø§Ø¡'}</button>
          <button class="danger" data-act="remove">Ø­Ø°Ù</button>
        </td>`;
      tr.querySelector("[data-act=toggle]").onclick = async ()=>{
        await update(child(rTasks(), t.id), { done: !t.done });
        await recalcMemberTotals(t.memberId);
      };
      tr.querySelector("[data-act=remove]").onclick = async ()=>{
        if(!confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©ØŸ")) return;
        await remove(child(rTasks(), t.id));
        await recalcMemberTotals(t.memberId);
      };
      tb.appendChild(tr);
    });
  }
  async function addTask(memberId, title, points){
    const id = newKey(rTasks());
    await set(child(rTasks(), id), { memberId, title, points:Number(points)||0, done:false });
    await recalcMemberTotals(memberId);
  }

  // ======== Events + toast ========
  function renderEvents(list){
    const tb = $("tblEvents").querySelector("tbody"); clear(tb);
    list.forEach((e,i)=>{
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${i+1}</td>
        <td>${e.title}</td>
        <td>${e.date}</td>
        <td>${e.type||'event'}</td>
        <td>${e.notifyDays ?? 2}</td>
        <td class="toolbar">
          <button class="ghost" data-act="edit">ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="danger" data-act="remove">Ø­Ø°Ù</button>
        </td>`;
      tr.querySelector("[data-act=remove]").onclick = ()=> confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©ØŸ") && remove(child(rEvents(), e.id));
      tr.querySelector("[data-act=edit]").onclick = async ()=>{
        const title = prompt("Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:", e.title)||e.title;
        const date  = prompt("Ø§Ù„ØªØ§Ø±ÙŠØ® (YYYY-MM-DD):", e.date)||e.date;
        const type  = prompt("Ø§Ù„Ù†ÙˆØ¹ (event/birthday):", e.type||"event") || e.type || "event";
        const nd    = Number(prompt("Ø£ÙŠØ§Ù… Ù‚Ø¨Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡:", e.notifyDays ?? 2) || (e.notifyDays ?? 2));
        await update(child(rEvents(), e.id), { title, date, type, notifyDays: nd });
      };
      tb.appendChild(tr);
    });

    // toast
    const today = new Date(); today.setHours(0,0,0,0);
    const near = list.filter(e=>{
      const d = new Date(e.date+"T00:00:00");
      const diffDays = Math.ceil((d - today)/(1000*60*60*24));
      const nd = e.notifyDays ?? 2;
      return diffDays >= 0 && diffDays <= nd;
    });
    const toast = $("events-toast");
    if(near.length && localStorage.getItem(toastKey)!==new Date().toISOString().slice(0,10)){
      toast.classList.remove("hidden");
      $("btnSeeEvents").onclick = ()=>{
        toast.classList.add("hidden");
        document.getElementById("secEvents").scrollIntoView({behavior:"smooth"});
      };
      $("btnDismissEvents").onclick = ()=>{
        localStorage.setItem(toastKey, new Date().toISOString().slice(0,10));
        toast.classList.add("hidden");
      };
    }else{
      toast.classList.add("hidden");
    }
  }
  async function addEvent(title, date, type, notifyDays){
    const id = newKey(rEvents());
    await set(child(rEvents(), id), { title, date, type, notifyDays:Number(notifyDays)||2 });
  }

  // ======== Totals (auto calc: attendance + tasks + manual) ========
  async function recalcMemberTotals(memberId){
    // attendance count already stored at members/<id>/stats/attendance
    const [mSnap, tSnap] = await Promise.all([
      get(child(rMembers(), memberId)),
      get(query(rTasks(), orderByChild("memberId"), equalTo(memberId)))
    ]);
    if(!mSnap.exists()) return;
    const m = mSnap.val();
    const att = Number(m.stats?.attendance || 0);
    let tPts = 0;
    if(tSnap.exists()){
      tSnap.forEach(s=>{ const v=s.val(); if(v.done) tPts += Number(v.points)||0; });
    }
    const manual = Number(m.stats?.manual || 0);
    const total = (att * (Number(settings.pointsPerAttendance)||1)) + tPts + manual;
    await update(child(rMembers(), memberId), { stats:{ attendance:att, tasks:tPts, manual, total } });
  }
  async function recalcAllMembersTotals(){
    const snap = await get(rMembers());
    if(!snap.exists()) return;
    const updates = {};
    const members = snap.val();
    for(const id in members){
      const m = members[id];
      const att = Number(m.stats?.attendance||0);
      const manual = Number(m.stats?.manual||0);
      updates[`members/${id}/stats/attendance`] = att;
      updates[`members/${id}/stats/manual`] = manual;
      // tasks will be recalculated one-by-one to include only 'done'
      // compute tPts:
      let tPts = 0;
      const tkSnap = await get(query(rTasks(), orderByChild("memberId"), equalTo(id)));
      if(tkSnap.exists()){ tkSnap.forEach(s=>{ const v=s.val(); if(v.done) tPts += Number(v.points)||0; }); }
      updates[`members/${id}/stats/tasks`] = tPts;
      updates[`members/${id}/stats/total`] = (att*(Number(settings.pointsPerAttendance)||1)) + tPts + manual;
    }
    await update(ref(db), updates);
    // update statTotalPoints
    const m2 = await get(rMembers());
    let sum=0; if(m2.exists()) Object.values(m2.val()).forEach(x=> sum += Number(x.stats?.total||0));
    $("statTotalPoints").textContent = sum;
  }

  // ======== Live bindings ========
  let cacheMembers=[], cacheWeeks=[], cacheAttendance=[], cacheTasks=[], cacheEvents=[];
  function attachLiveBindings(){
    onValue(rMembers(), s=>{
      const arr=[]; s.forEach(ch=> arr.push({id:ch.key, ...(ch.val()||{})})); cacheMembers = arr;
      renderMembers(arr);
      // update total points stat immediately
      let sum=0; arr.forEach(m=> sum += Number(m.stats?.total||0)); $("statTotalPoints").textContent = sum;
    });
    onValue(rWeeks(), s=>{
      const arr=[]; s.forEach(ch=> arr.push({id:ch.key, ...(ch.val()||{})})); cacheWeeks = arr;
      renderWeeks(arr);
    });
    onValue(rAttendance(), s=>{
      const arr=[]; s.forEach(ch=> arr.push({id:ch.key, ...(ch.val()||{})})); cacheAttendance = arr;
      // filter by selected week (admin)
      const wk = $("selWeekAdmin").value;
      const list = wk ? arr.filter(a=>a.weekId===wk) : arr;
      renderAttendance(list, cacheMembers, cacheWeeks);
    });
    onValue(rTasks(), s=>{
      const arr=[]; s.forEach(ch=> arr.push({id:ch.key, ...(ch.val()||{})})); cacheTasks = arr;
      renderTasks(arr, cacheMembers);
    });
    onValue(rEvents(), s=>{
      const arr=[]; s.forEach(ch=> arr.push({id:ch.key, ...(ch.val()||{})})); cacheEvents = arr;
      renderEvents(arr);
    });
  }

  // ======== Wire UI ========
  $("btnCheckin").onclick = ()=> checkin($("selMember").value, $("selWeek").value);

  $("btnAddMember").onclick = async ()=>{
    const n = $("memName").value.trim(); if(!n) return;
    await addMember(n, $("memPhoto").value.trim()); $("memName").value=""; $("memPhoto").value="";
  };

  $("btnAddWeek").onclick = async ()=>{
    const n=$("weekName").value.trim(); const f=$("weekFrom").value; const t=$("weekTo").value;
    if(!n) return; await addWeek(n,f,t); $("weekName").value=""; $("weekFrom").value=""; $("weekTo").value="";
  };

  $("selWeekAdmin").onchange = ()=>{
    const wk = $("selWeekAdmin").value;
    const list = wk ? cacheAttendance.filter(a=>a.weekId===wk) : cacheAttendance;
    renderAttendance(list, cacheMembers, cacheWeeks);
  };
  $("btnDeleteWeekAttendance").onclick = async ()=>{
    const wk = $("selWeekAdmin").value; if(!wk) return alert("Ø§Ø®ØªØ± Ø£Ø³Ø¨ÙˆØ¹Ù‹Ø§");
    if(!confirm("Ø­Ø°Ù ÙƒÙ„ Ø­Ø¶ÙˆØ± Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ØŸ")) return;
    const list = cacheAttendance.filter(a=>a.weekId===wk);
    const updates={};
    list.forEach(a=>{
      updates[`attendance/${a.id}`]=null;
    });
    await update(ref(db), updates);
    // Ø£Ø¹Ø¯ Ø­Ø³Ø§Ø¨ Ø­Ø¶ÙˆØ± ÙƒÙ„ Ø¹Ø¶Ùˆ ØªØ¶Ø±Ø±
    const affected = [...new Set(list.map(a=>a.memberId))];
    for(const m of affected){
      // Ø£Ø¹Ø¯ Ø¨Ù†Ø§Ø¡ Ø¹Ø¯Ù‘Ø§Ø¯ Ø§Ù„Ø­Ø¶ÙˆØ± Ù…Ù† Ø¬Ø¯ÙŠØ¯ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶Ùˆ
      const left = cacheAttendance.filter(a=> a.memberId===m && a.weekId!==wk).length;
      await update(child(rMembers(), m), { stats:{ ...(cacheMembers.find(x=>x.id===m)?.stats||{}), attendance: left }});
      await recalcMemberTotals(m);
    }
  };

  $("btnAddTask").onclick = ()=>{
    const mid=$("taskMember").value, title=$("taskTitle").value.trim(), pts=Number($("taskPoints").value||0);
    if(!mid || !title) return;
    addTask(mid,title,pts).then(()=>{
      $("taskTitle").value=""; $("taskPoints").value="";
    });
  };

  $("btnAddEvent").onclick = ()=>{
    const t=$("eventTitle").value.trim(), d=$("eventDate").value, ty=$("eventType").value, nd=Number($("eventNotifyDays").value||2);
    if(!t || !d) return;
    addEvent(t,d,ty,nd).then(()=>{
      $("eventTitle").value=""; $("eventDate").value=""; $("eventNotifyDays").value="";
    });
  };

  $("btnAdminLogin").onclick = ()=>{
    // ÙƒÙ„Ù…Ø© Ø³Ø± Ø¨Ø³ÙŠØ·Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©) â€” Ù„Ùˆ ØªØ±ÙƒØªÙ‡Ø§ ÙØ§Ø¶ÙŠØ© ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„
    const pass = $("adminPass").value;
    setAdmin(true);
  };
  $("btnAdminLogout").onclick = ()=> setAdmin(false);

  $("btnSaveFirebase").onclick = ()=>{
    const cfg = readFirebaseForm(); saveCfg(cfg); location.reload();
  };
  $("btnSync").onclick = ()=> recalcAllMembersTotals();
  $("btnReset").onclick = ()=>{
    if(confirm("Ø³ÙŠØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙÙ‚Ø· (Ù„Ù† ØªÙØ­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©).")){ localStorage.clear(); location.reload(); }
  };

  // Ø²Ø± Ø¥ØºÙ„Ø§Ù‚ ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª
  $("btnSeeEvents").onclick = ()=> document.getElementById("secEvents").scrollIntoView({behavior:"smooth"});
  $("btnDismissEvents").onclick = ()=> document.getElementById("events-toast").classList.add("hidden");

  // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
  refreshAdminUI();
  boot();

</script>
</body>
</html>
