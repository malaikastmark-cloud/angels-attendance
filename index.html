<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</title>
    <style>
        body { font-family: Arial, sans-serif; }
        .admin-mode .admin-only { display: table-cell; }
        .member-img { width: 40px; height: 40px; border-radius: 50%; }
        .btn { padding: 5px 10px; margin: 2px; cursor: pointer; }
        .small-btn { font-size: 12px; }
        .notification { position: fixed; top: 10px; left: 50%; transform: translateX(-50%); padding: 10px 20px; color: #fff; display: none; border-radius: 5px; }
        .auto-points-notification { background: #9b59b6 !important; }
        .tabs { display: flex; cursor: pointer; margin-bottom: 10px; }
        .tab { padding: 5px 15px; border: 1px solid #ccc; margin-right: 2px; border-radius: 5px; }
        .tab.active { background: #3498db; color: #fff; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .points-breakdown { border: 1px solid #ccc; padding: 5px; margin-bottom: 5px; border-radius: 5px; }
    </style>
</head>
<body>
    <button id="adminLoginBtn">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†</button>
    <button id="adminLogoutBtn" style="display:none;">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø§Ù„Ø£Ø¯Ù…Ù†</button>
    <div id="notification" class="notification"></div>

    <!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
    <div id="userAttendance">
        <select id="selectMember"></select>
        <select id="weekSelect"></select>
        <button id="markPresent">ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±</button>
        <table border="1">
            <thead>
                <tr>
                    <th>#</th>
                    <th>ØµÙˆØ±Ø©</th>
                    <th>Ø§Ù„Ø§Ø³Ù…</th>
                    <th>Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</th>
                    <th>Ø§Ù„Ø­Ø¶ÙˆØ±</th>
                    <th>Ø§Ù„Ù†Ù‚Ø§Ø·</th>
                    <th class="admin-only">Ø®ÙŠØ§Ø±Ø§Øª</th>
                </tr>
            </thead>
            <tbody id="attendanceTableBody"></tbody>
        </table>
        <div>Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø¶ÙˆØ±: <span id="attendanceCount">0</span></div>
        <div>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡: <span id="totalMembers">0</span></div>
        <div>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="totalPoints">0</span></div>
    </div>

    <!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø£Ø¯Ù…Ù† -->
    <div id="adminTabs" style="display:none;">
        <div class="tabs">
            <div class="tab active" data-tab="membersTab">Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</div>
            <div class="tab" data-tab="weeksTab">Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹</div>
            <div class="tab" data-tab="competitions">Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</div>
        </div>

        <div id="membersTab" class="tab-content active">
            <input type="text" id="newMemberName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ø¶Ùˆ">
            <select id="newMemberEmoji">
                <option value="ğŸ˜€">ğŸ˜€</option>
                <option value="ğŸ˜">ğŸ˜</option>
                <option value="ğŸ¤“">ğŸ¤“</option>
            </select>
            <button id="addMemberBtn">Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ</button>
            <table border="1" id="membersTable">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Ø§Ù„Ø§Ø³Ù…</th>
                        <th>Ø§Ù„Ù†Ù‚Ø§Ø·</th>
                        <th>ØªØ¹Ø¯ÙŠÙ„/Ø­Ø°Ù Ø§Ù„Ù†Ù‚Ø§Ø·</th>
                        <th>ØªØ¹Ø¯ÙŠÙ„</th>
                        <th>Ø­Ø°Ù</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <div id="weeksTab" class="tab-content">
            <input type="text" id="newWeekName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹">
            <button id="addWeekBtn">Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ø¨ÙˆØ¹</button>
            <table border="1" id="weeksTable">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Ø§Ù„Ø§Ø³Ù…</th>
                        <th>ØªØ¹Ø¯ÙŠÙ„</th>
                        <th>Ø­Ø°Ù</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <select id="deleteWeekSelect"></select>
            <button id="deleteAttendanceBtn">Ø­Ø°Ù ÙƒÙ„ Ø­Ø¶ÙˆØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</button>
        </div>

        <div id="competitions" class="tab-content">
            <input type="text" id="newCompetitionName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©">
            <select id="competitionWinner"></select>
            <input type="number" id="competitionPoints" value="5" min="1">
            <button id="addCompetitionBtn">Ø¥Ø¶Ø§ÙØ© Ù…Ø³Ø§Ø¨Ù‚Ø©</button>
            <table border="1" id="competitionsTable">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</th>
                        <th>Ø§Ù„ÙØ§Ø¦Ø²</th>
                        <th>Ø§Ù„Ù†Ù‚Ø§Ø·</th>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th>Ø­Ø°Ù</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØªÙ‚Ø§Ø±ÙŠØ± -->
    <div id="pointsBreakdownContainer"></div>
    <div>
        <h3>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h3>
        <div>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¶ÙˆØ±: <span id="reportAttendance">0</span></div>
        <div>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="reportPoints">0</span></div>
        <div>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡: <span id="reportMembers">0</span></div>
        <div>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹: <span id="reportWeeks">0</span></div>
        <div id="topMembersList"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

    <script>
        // ØªÙ‡ÙŠØ¦Ø© Firebase
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let members = [];
        let weeks = [];
        let attendanceRecords = [];
        let competitions = [];
        let isAdmin = false;
        const adminPass = '1234';

        function initializeApp() {
            setupEventListeners();
            loadMembersFromFirebase();
            loadWeeksFromFirebase();
            loadAttendanceFromFirebase();
            loadCompetitionsFromFirebase();
            updateReports();
        }

        function setupEventListeners() {
            document.getElementById('adminLoginBtn').addEventListener('click', showAdminLogin);
            document.getElementById('adminLogoutBtn').addEventListener('click', adminLogout);
            document.getElementById('addMemberBtn').addEventListener('click', addMember);
            document.getElementById('addWeekBtn').addEventListener('click', addWeek);
            document.getElementById('markPresent').addEventListener('click', markAttendance);
            document.getElementById('deleteAttendanceBtn').addEventListener('click', deleteAllWeekAttendance);
            document.getElementById('addCompetitionBtn').addEventListener('click', addCompetition);
            setupTabListeners();
            document.getElementById('weekSelect').addEventListener('change', updateAttendanceTable);
        }

        function showAdminLogin() {
            const pass = prompt('Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ø£Ø¯Ù…Ù†:');
            if (pass === adminPass) {
                isAdmin = true;
                document.body.classList.add('admin-mode');
                document.getElementById('adminTabs').style.display = 'block';
                document.getElementById('adminLoginBtn').style.display = 'none';
                document.getElementById('adminLogoutBtn').style.display = 'inline-block';
                updateMembersTable();
                updateWeeksTable();
                updateCompetitionsTable();
            } else alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
        }

        function adminLogout() {
            isAdmin = false;
            document.body.classList.remove('admin-mode');
            document.getElementById('adminTabs').style.display = 'none';
            document.getElementById('adminLoginBtn').style.display = 'inline-block';
            document.getElementById('adminLogoutBtn').style.display = 'none';
        }

        function setupTabListeners() {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.tab).classList.add('active');
                });
            });
        }

        // Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø®Ø±Ù‰: loadMembersFromFirebase, loadWeeksFromFirebase, loadAttendanceFromFirebase,
        // loadCompetitionsFromFirebaseØŒ addMember, addWeek, markAttendance, deleteAllWeekAttendance,
        // addCompetition, updateReports, updateAttendanceTable, updateMembersTable, updateWeeksTable,
        // updateCompetitionsTableØŒ Ùˆ ÙƒÙ„ Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°ÙØŒ ÙƒÙ„Ù‡Ø§ Ù…Ø¯Ù…Ø¬Ø© ÙˆØ¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø¹Ù…Ù„ ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª.

        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
