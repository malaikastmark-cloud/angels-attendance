<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>نظام حضور الأعضاء</title>
<!-- رابط مكتبات -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f4f6f8; }
    header { background:#3498db; color:white; padding:15px; text-align:center; font-size:24px; }
    section { padding:20px; }
    select, input { padding:5px; margin:5px 0; }
    button { padding:7px 15px; margin:5px 0; cursor:pointer; border:none; border-radius:5px; }
    button:hover { opacity:0.9; }
    .btn-primary { background:#3498db; color:white; }
    .btn-danger { background:#e74c3c; color:white; }
    .btn-success { background:#2ecc71; color:white; }
    .card { background:white; padding:15px; border-radius:10px; margin-bottom:15px; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
    table { width:100%; border-collapse:collapse; margin-top:10px; }
    th, td { padding:8px; border-bottom:1px solid #ddd; text-align:center; }
    .member-img { width:40px; height:40px; border-radius:50%; }
    #notification { position:fixed; top:20px; right:20px; padding:10px 20px; border-radius:5px; display:none; color:white; z-index:1000; }
    #adminTabs { display:none; }
    h3 { margin-top:0; }
    .top-member-item { display:flex; justify-content:space-between; align-items:center; padding:5px; border-bottom:1px solid #eee; }
    .badge { padding:3px 7px; border-radius:5px; color:white; font-size:12px; }
    .btn-warning { background:#f39c12; }
    .login-failed { animation: shake 0.3s; border:1px solid #e74c3c; }
    @keyframes shake { 0%{ transform:translateX(0) } 25%{ transform:translateX(-5px) } 50%{ transform:translateX(5px) } 75%{ transform:translateX(-5px) } 100%{ transform:translateX(0) } }
</style>
</head>
<body>
<header>نظام حضور الأعضاء</header>

<div id="notification"></div>

<section id="userAttendance" class="card">
<h3>تسجيل الحضور</h3>
<label>اختر اسمك:</label>
<select id="selectMember"></select><br>
<label>اختر الأسبوع:</label>
<select id="weekSelect"></select><br>
<button id="markPresent" class="btn btn-success">تسجيل حضور</button>
<button id="adminLoginBtn" class="btn btn-primary">تسجيل دخول كأدمن</button>
<canvas id="attendanceChart" style="margin-top:20px;"></canvas>
</section>

<section id="adminTabs" class="card">
<h3>لوحة تحكم الأدمن</h3>
<button id="backToUserView" class="btn btn-primary">العودة لواجهة المستخدم</button>

<!-- إدارة الأعضاء -->
<div class="card">
<h4>الأعضاء</h4>
<input id="newMemberName" placeholder="اسم العضو">
<input id="newMemberEmoji" placeholder="رمز تعبيري (اختياري)">
<input id="newMemberImage" placeholder="رابط صورة (اختياري)">
<button id="addMemberBtn" class="btn btn-success">إضافة عضو</button>
<p>إجمالي الأعضاء: <span id="totalMembers">0</span></p>
<table id="membersTable">
<thead><tr><th>#</th><th>صورة</th><th>الاسم</th><th>النقاط</th><th>المكافآت</th><th>تعديل</th><th>حذف</th></tr></thead>
<tbody></tbody>
</table>
</div>

<!-- إدارة الأسابيع -->
<div class="card">
<h4>الأسابيع</h4>
<input id="newWeekName" placeholder="اسم الأسبوع">
<input type="date" id="newWeekStart" placeholder="من">
<input type="date" id="newWeekEnd" placeholder="إلى">
<button id="addWeekBtn" class="btn btn-success">إضافة أسبوع</button>
<p>إجمالي الأسابيع: <span id="reportWeeks">0</span></p>
<table id="weeksTable">
<thead><tr><th>#</th><th>الاسم</th><th>من</th><th>إلى</th><th>تعديل</th><th>حذف</th></tr></thead>
<tbody></tbody>
</table>
</div>

<!-- الحضور -->
<div class="card">
<h4>الحضور</h4>
<label>اختر أسبوع لحذف الحضور:</label>
<select id="deleteWeekSelect"></select>
<button id="deleteAttendanceBtn" class="btn btn-danger">حذف كل حضور الأسبوع</button>
<p>عدد الحضور: <span id="attendanceCount">0</span></p>
<p>النقاط الإجمالية: <span id="totalPoints">0</span></p>
<table id="attendanceRecordsBody">
<thead><tr><th>#</th><th>العضو</th><th>الأسبوع</th><th>التاريخ</th><th>حذف</th></tr></thead>
<tbody></tbody>
</table>
</div>

<!-- المهام والمناسبات -->
<div class="card">
<h4>إدارة المناسبات</h4>
<input id="newEventName" placeholder="اسم المناسبة">
<input type="date" id="newEventDate">
<input id="newEventDescription" placeholder="الوصف">
<button id="addEventBtn" class="btn btn-success">إضافة مناسبة</button>
<table id="eventsTable"><thead><tr><th>#</th><th>الاسم</th><th>التاريخ</th><th>الوصف</th><th>تعديل</th><th>حذف</th></tr></thead><tbody></tbody></table>
</div>

<div class="card">
<h4>إدارة المهمات</h4>
<input id="newTaskName" placeholder="اسم المهمة">
<select id="newTaskAssignee"></select>
<input type="date" id="newTaskDeadline">
<button id="addTaskBtn" class="btn btn-success">إضافة مهمة</button>
<table id="tasksTable"><thead><tr><th>#</th><th>المهمة</th><th>المسؤول</th><th>الموعد النهائي</th><th>الحالة</th><th>تعديل</th><th>حذف</th></tr></thead><tbody></tbody></table>
</div>
</section>

<!-- نافذة تسجيل دخول الأدمن -->
<div id="adminLoginModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);justify-content:center;align-items:center;">
<div style="background:white;padding:20px;border-radius:10px;max-width:300px;width:100%;text-align:center;">
<h4>تسجيل دخول الأدمن</h4>
<input type="password" id="adminPassword" placeholder="كلمة السر"><br>
<button id="confirmAdminLogin" class="btn btn-success">تأكيد</button>
<button id="cancelAdminLogin" class="btn btn-danger">إلغاء</button>
</div>
</div>

<script>
// ===== البيانات الأساسية =====
let members = [];
let weeks = [];
let attendanceRecords = [];
let rewards = [];
let extraPoints = [];
let events = [];
let tasks = [];
const adminPass = 'admin123';

// ===== وظائف التطبيق =====
function initializeApp() {
    populateData();
    setupEventListeners();
}

function populateData() {
    populateMembers();
    populateWeeks();
    populateAttendanceTable();
    updateAttendanceStats();
}

// … (كل الدوال من الكود اللي بعتهلك سابقًا تظل هنا كما هي)
// تضمن إضافة/تعديل/حذف أعضاء، أسابيع، حضور، نقاط إضافية، مناسبات، مهام، لوحة أعلى 10 أعضاء، وإشعارات

// إضافة رسم بياني وتصدير إكسل
const ctx = document.getElementById('attendanceChart').getContext('2d');
let chart = new Chart(ctx, { type: 'bar', data: { labels: [], datasets: [{ label: 'الحضور', data: [], backgroundColor: ['#3498db','#2ecc71','#f39c12'] }] }, options: { responsive:true, plugins:{legend:{display:false}}} });

document.addEventListener('DOMContentLoaded', initializeApp);
</script>
</body>
</html>
