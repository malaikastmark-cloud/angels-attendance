let attendanceRecords = [];
        let rewards = [];
        let extraPoints = [];
        let events = [];
        let tasks = [];
        
        // كلمة السر
        const adminPass = 'admin123';
        
        // تهيئة التطبيق
        function initializeApp() {
            populateData();
            setupEventListeners();
        }
        
        // تعبئة البيانات في الواجهة
        function populateData() {
            populateMembers();
            populateWeeks();
            populateAttendanceTable();
            updateAttendanceStats();
        }
        
        // تعبئة قائمة الأعضاء
        function populateMembers() {
            const selectMember = document.getElementById('selectMember');
            const extraPointMember = document.getElementById('extraPointMember');
            const newTaskAssignee = document.getElementById('newTaskAssignee');
            
            // مسح المحتوى الحالي
            selectMember.innerHTML = '<option value="">-- اختر اسمك --</option>';
            extraPointMember.innerHTML = '<option value="">-- اختر العضو --</option>';
            newTaskAssignee.innerHTML = '<option value="">-- اختر المسؤول --</option>';
            
            // إضافة الأعضاء
            members.forEach(member => {
                // قائمة تسجيل الحضور
                const option = document.createElement('option');
                option.value = member.id;
                option.textContent = member.name;
                selectMember.appendChild(option);
                
                // قائمة النقاط الإضافية
                const extraOption = document.createElement('option');
                extraOption.value = member.id;
                extraOption.textContent = member.name;
                extraPointMember.appendChild(extraOption);
                
                // قائمة المسؤولين عن المهمات
                const taskOption = document.createElement('option');
                taskOption.value = member.id;
                taskOption.textContent = member.name;
                newTaskAssignee.appendChild(taskOption);
            });
            
            // تحديث جدول الأعضاء في لوحة التحكم
            const membersTbody = document.querySelector('#membersTable tbody');
            membersTbody.innerHTML = '';
            
            members.forEach((member, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${index + 1}</td>
                    <td><img src="${member.image}" class="member-img" alt="${member.name}"></td>
                    <td>${member.name}</td>
                    <td>${member.points}</td>
                    <td>${rewards.filter(r => r.memberId === member.id).map(r => r.title).join(', ') || 'لا يوجد'}</td>
                    <td><button class='btn btn-primary editMember' data-id='${member.id}'>تعديل</button></td>
                    <td><button class='btn btn-danger deleteMember' data-id='${member.id}'>حذف</button></td>
                `;
                membersTbody.appendChild(tr);
            });
            
            document.getElementById('totalMembers').textContent = members.length;
            document.getElementById('reportMembers').textContent = members.length;
        }
        
        // تعبئة قائمة الأسابيع
        function populateWeeks() {
            const weekSelect = document.getElementById('weekSelect');
            const deleteWeekSelect = document.getElementById('deleteWeekSelect');
            
            // مسح المحتوى الحالي
            weekSelect.innerHTML = '<option value="">-- اختر الأسبوع --</option>';
            deleteWeekSelect.innerHTML = '<option value="">-- اختر الأسبوع --</option>';
            
            // إضافة الأسابيع
            weeks.forEach(week => {
                // قائمة تسجيل الحضور
                const option = document.createElement('option');
                option.value = week.id;
                option.textContent = week.name;
                weekSelect.appendChild(option);
                
                // قائمة حذف الحضور
                const deleteOption = document.createElement('option');
                deleteOption.value = week.id;
                deleteOption.textContent = week.name;
                deleteWeekSelect.appendChild(deleteOption);
            });
            
            // تحديث جدول الأسابيع في لوحة التحكم
            const weeksTbody = document.querySelector('#weeksTable tbody');
            weeksTbody.innerHTML = '';
            
            weeks.forEach((week, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${week.name}</td>
                    <td>${week.from}</td>
                    <td>${week.to}</td>
                    <td><button class='btn btn-primary editWeek' data-id='${week.id}'>تعديل</button></td>
                    <td><button class='btn btn-danger deleteWeek' data-id='${week.id}'>حذف</button></td>
                `;
                weeksTbody.appendChild(tr);
            });
            
            document.getElementById('reportWeeks').textContent = weeks.length;
        }
        
        // تعبئة جدول الحضور
        function populateAttendanceTable() {
            const tbody = document.getElementById('attendanceTableBody');
            tbody.innerHTML = '';
            
            const selectedWeekId = document.getElementById('weekSelect').value;
            
            if (!selectedWeekId) {
                tbody.innerHTML = '<tr><td colspan="6">اختر أسبوعاً لعرض البيانات</td></tr>';
                return;
            }
            
            members.forEach((member, index) => {
                // التحقق من وجود سجل حضور لهذا العضو في هذا الأسبوع
                const attendanceRecord = attendanceRecords.find(ar => 
                    ar.memberId === member.id && ar.weekId == selectedWeekId
                );
                
                const isPresent = attendanceRecord ? true : false;
                
                const tr = document.createElement('tr');
                tr.dataset.member = member.id;
                tr.innerHTML = `
                    <td>${index + 1}</td>
                    <td><img src="${member.image}" class="member-img" alt="${member.name}"></td>
                    <td>${member.name}</td>
                    <td>${weeks.find(w => w.id == selectedWeekId)?.name || ''}</td>
                    <td class="attendance-value">${isPresent ? '1' : '0'}</td>
                    <td class="points">${member.points}</td>
                `;
                tbody.appendChild(tr);
            });
            
            populateAttendanceRecords();
        }
        
        // تعبئة سجلات الحضور
        function populateAttendanceRecords() {
            const tbody = document.querySelector('#attendanceRecordsBody');
            tbody.innerHTML = '';
            
            if (attendanceRecords.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5">لا توجد سجلات حضور</td></tr>';
                return;
            }
            
            attendanceRecords.forEach((record, index) => {
                const member = members.find(m => m.id === record.memberId);
                const week = weeks.find(w => w.id == record.weekId);
                
                if (member && week) {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${member.name}</td>
                        <td>${week.name}</td>
                        <td>${new Date(record.date).toLocaleString('ar-EG')}</td>
                        <td><button class='btn btn-danger deleteAttendance' data-id='${record.id}'>حذف</button></td>
                    `;
                    tbody.appendChild(tr);
                }
            });
        }
        
        // تحديث إحصائيات الحضور
        function updateAttendanceStats() {
            const selectedWeekId = document.getElementById('weekSelect').value;
            let count = 0;
            let totalPoints = 0;
            
            if (!selectedWeekId) {
                document.getElementById('attendanceCount').textContent = count;
                document.getElementById('totalPoints').textContent = totalPoints;
                return;
            }
            
            // حساب الحضور لهذا الأسبوع فقط
            const weekAttendance = attendanceRecords.filter(ar => ar.weekId == selectedWeekId);
            count = weekAttendance.length;
            
            // حساب النقاط الإجمالية
            totalPoints = members.reduce((sum, member) => sum + member.points, 0);
            
            document.getElementById('attendanceCount').textContent = count;
            document.getElementById('totalPoints').textContent = totalPoints;
            
            // تحديث التقارير
            document.getElementById('reportAttendance').textContent = attendanceRecords.length;
            document.getElementById('reportPoints').textContent = totalPoints;
            
            updateChart();
            updateTopMembers();
            updateMembersStats();
        }
        
        // تحديث قائمة الـ 10 الأوائل
        function updateTopMembers() {
            // حساب النقاط لكل عضو
            const memberPoints = members.map(member => {
                return { name: member.name, points: member.points, image: member.image };
            });
            
            // ترتيب تنازلي حسب النقاط
            memberPoints.sort((a, b) => b.points - a.points);
            
            // أخذ أول 10 فقط
            const top10 = memberPoints.slice(0, 10);
            
            // عرض النتائج
            const topMembersList = document.getElementById('topMembersList');
            topMembersList.innerHTML = '';
            
            if (top10.length === 0) {
                topMembersList.innerHTML = '<p>لا توجد بيانات حتى الآن</p>';
                return;
            }
            
            top10.forEach((member, index) => {
                const item = document.createElement('div');
                item.className = 'top-member-item';
                
                let medal = '';
                if (index === 0) medal = '<span class="medal medal-gold">🥇</span>';
                else if (index === 1) medal = '<span class="medal medal-silver">🥈</span>';
                else if (index === 2) medal = '<span class="medal medal-bronze">🥉</span>';
                
                item.innerHTML = `
                    <div style="display:flex;align-items:center;gap:10px;">
                        <img src="${member.image}" class="member-img" alt="${member.name}">
                        <div class="top-member-name">${medal} ${member.name}</div>
                    </div>
                    <div class="top-member-points">${member.points} نقطة</div>
                `;
                topMembersList.appendChild(item);
            });
        }
        
        // تحديث إحصائيات الأعضاء
        function updateMembersStats() {
            const container = document.getElementById('membersStatsContainer');
            container.innerHTML = '';
            
            members.forEach(member => {
                const statsDiv = document.createElement('div');
                statsDiv.className = 'member-stats';
                statsDiv.innerHTML = `
                    <img src="${member.image}" class="member-img" alt="${member.name}">
                    <div style="flex:1">
                        <h4>${member.name}</h4>
                        <div style="display:flex;gap:10px;margin-top:5px;">
                            <div class="member-stat-item">
                                <div class="member-stat-value">${member.points}</div>
                                <div class="member-stat-label">نقاط</div>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(statsDiv);
            });
        }
        
        // إعداد مستمعي الأحداث
        function setupEventListeners() {
            // تسجيل دخول الأدمن
            document.getElementById('adminLoginBtn').addEventListener('click', showAdminLogin);
            document.getElementById('cancelAdminLogin').addEventListener('click', hideAdminLogin);
            document.getElementById('confirmAdminLogin').addEventListener('click', confirmAdminLogin);
            
            // العودة إلى واجهة المستخدم
            document.getElementById('backToUserView').addEventListener('click', backToUserView);
            
            // إدارة الأعضاء
            document.getElementById('addMemberBtn').addEventListener('click', addMember);
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('editMember')) {
                    const id = parseInt(e.target.dataset.id);
                    editMember(id);
                }
                if (e.target.classList.contains('deleteMember')) {
                    const id = parseInt(e.target.dataset.id);
                    deleteMember(id);
                }
            });
            
            // إدارة الأسابيع
            document.getElementById('addWeekBtn').addEventListener('click', addWeek);
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('editWeek')) {
                    const id = parseInt(e.target.dataset.id);
                    editWeek(id);
                }
                if (e.target.classList.contains('deleteWeek')) {
                    const id = parseInt(e.target.dataset.id);
                    deleteWeek(id);
                }
            });
            
            // إدارة الحضور
            document.getElementById('markPresent').addEventListener('click', markAttendance);
            document.getElementById('deleteAttendanceBtn').addEventListener('click', deleteAllWeekAttendance);
            document.getElementById('addExtraPointsBtn').addEventListener('click', addExtraPoints);
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('deleteAttendance')) {
                    const id = parseInt(e.target.dataset.id);
                    deleteAttendanceRecord(id);
                }
            });
            
            // إدارة المناسبات
            document.getElementById('addEventBtn').addEventListener('click', addEvent);
            
            // إدارة المهمات
            document.getElementById('addTaskBtn').addEventListener('click', addTask);
            
            // التقارير
            document.getElementById('printReportBtn').addEventListener('click', printReport);
            document.getElementById('exportExcelBtn').addEventListener('click', exportToExcel);
            
            // تحديث البيانات عند تغيير الأسبوع
            document.getElementById('weekSelect').addEventListener('change', populateAttendanceTable);
        }
        
        // تسجيل دخول الأدمن
        function showAdminLogin() {
            document.getElementById('adminLoginModal').style.display = 'flex';
            document.getElementById('adminPassword').value = '';
            document.getElementById('adminPassword').classList.remove('login-failed');
        }
        
        function hideAdminLogin() {
            document.getElementById('adminLoginModal').style.display = 'none';
        }
        
        function confirmAdminLogin() {
            const pwd = document.getElementById('adminPassword').value;
            if (pwd === adminPass) {
                document.getElementById('adminLoginModal').style.display = 'none';
                document.getElementById('adminTabs').style.display = 'block';
                document.getElementById('userAttendance').style.display = 'none';
                document.getElementById('adminLoginBtn').style.display = 'none';
                showNotification('تم تسجيل دخول الأدمن بنجاح');
            } else {
                // تأثير اهتزاز عند إدخال كلمة سر خاطئة
                const passwordInput = document.getElementById('adminPassword');
                passwordInput.classList.add('login-failed');
                setTimeout(() => {
                    passwordInput.classList.remove('login-failed');
                }, 500);
                
                showNotification('كلمة السر خاطئة!', false);
            }
        }
        
        // العودة إلى واجهة المستخدم
        function backToUserView() {
            document.getElementById('adminTabs').style.display = 'none';
            document.getElementById('userAttendance').style.display = 'block';
            document.getElementById('adminLoginBtn').style.display = 'block';
        }
        
        // إضافة عضو جديد
        function addMember() {
            const name = document.getElementById('newMemberName').value;
            const emoji = document.getElementById('newMemberEmoji').value;
            const image = document.getElementById('newMemberImage').value;
            
            if (!name) {
                showNotification('يرجى إدخال اسم العضو', false);
                return;
            }
            
            const newMember = {
                id: members.length > 0 ? Math.max(...members.map(m => m.id)) + 1 : 1,
                name: `${emoji} ${name}`,
                image: image || `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=3498db&color=fff`,
                points: 0
            };
            
            members.push(newMember);
            showNotification('تم إضافة العضو بنجاح');
            
            // مسح الحقول
            document.getElementById('newMemberName').value = '';
            document.getElementById('newMemberImage').value = '';
            
            // تحديث البيانات
            populateData();
        }
        
        // تعديل عضو
        function editMember(id) {
            const member = members.find(m => m.id === id);
            if (!member) return;
            
            // استخراج الإيموجي والاسم
            const emoji = member.name.charAt(0);
            const currentName = member.name.substring(2);
            
            const newName = prompt('عدل اسم العضو:', currentName);
            const newImage = prompt('عدل رابط الصورة (اتركه فارغاً إذا لا تريد تغييره):', member.image);
            
            if (newName) {
                member.name = `${emoji} ${newName}`;
                if (newImage) member.image = newImage;
                showNotification('تم تعديل بيانات العضو');
                populateData();
            }
        }
        
        // حذف عضو
        function deleteMember(id) {
            if (confirm('هل تريد حذف العضو؟')) {
                members = members.filter(m => m.id !== id);
                showNotification('تم حذف العضو');
                populateData();
            }
        }
        
        // إضافة أسبوع جديد
        function addWeek() {
            const name = document.getElementById('newWeekName').value;
            const from = document.getElementById('newWeekStart').value;
            const to = document.getElementById('newWeekEnd').value;
            
            if (!name || !from || !to) {
                showNotification('يرجى ملء جميع الحقول', false);
                return;
            }
            
            const newWeek = {
                id: weeks.length > 0 ? Math.max(...weeks.map(w => w.id)) + 1 : 1,
                name: name,
                from: from,
                to: to
            };
            
            weeks.push(newWeek);
            showNotification('تم إضافة الأسبوع بنجاح');
            
            // مسح الحقول
            document.getElementById('newWeekName').value = '';
            document.getElementById('newWeekStart').value = '';
            document.getElementById('newWeekEnd').value = '';
            
            // تحديث البيانات
            populateData();
        }
        
        // تعديل أسبوع
        function editWeek(id) {
            const week = weeks.find(w => w.id === id);
            if (!week) return;
            
            const newName = prompt('عدل اسم الأسبوع:', week.name);
            const newFrom = prompt('عدل تاريخ البداية:', week.from);
            const newTo = prompt('عدل تاريخ النهاية:', week.to);
            
            if (newName && newFrom && newTo) {
                week.name = newName;
                week.from = newFrom;
                week.to = newTo;
                showNotification('تم تعديل بيانات الأسبوع');
                populateData();
            }
        }
        
        // حذف أسبوع
        function deleteWeek(id) {
            if (confirm('هل تريد حذف الأسبوع؟')) {
                weeks = weeks.filter(w => w.id !== id);
                showNotification('تم حذف الأسبوع');
                populateData();
            }
        }
        
        // تسجيل الحضور
        function markAttendance() {
            const memberId = parseInt(document.getElementById('selectMember').value);
            const weekId = parseInt(document.getElementById('weekSelect').value);
            
            if (!memberId || !weekId) {
                showNotification('يرجى اختيار العضو والأسبوع أولاً', false);
                return;
            }
            
            // التحقق من عدم تسجيل الحضور مسبقاً
            const existingRecord = attendanceRecords.find(ar => 
                ar.memberId === memberId && ar.weekId == weekId
            );
            
            if (existingRecord) {
                showNotification('لقد تم تسجيل حضور هذا العضو already في هذا الأسبوع', false);
                return;
            }
            
            // إضافة سجل جديد
            const newAttendance = {
                id: attendanceRecords.length > 0 ? Math.max(...attendanceRecords.map(ar => ar.id)) + 1 : 1,
                memberId: memberId,
                weekId: weekId,
                date: new Date().toISOString()
            };
            
            attendanceRecords.push(newAttendance);
            
            // زيادة نقاط العضو
            const member = members.find(m => m.id === memberId);
            if (member) {
                member.points += 1;
            }
            
            showNotification('تم تسجيل الحضور بنجاح!');
            
            // تحديث البيانات
            populateData();
        }
        
        // إضافة نقاط إضافية
        function addExtraPoints() {
            const memberId = parseInt(document.getElementById('extraPointMember').value);
            const points = parseInt(document.getElementById('extraPointsValue').value);
            const reason = document.getElementById('extraPointsReason').value;
            
            if (!memberId || !points || !reason) {
                showNotification('يرجى ملء جميع الحقول', false);
                return;
            }
            
            // زيادة نقاط العضو
            const member = members.find(m => m.id === memberId);
            if (member) {
                member.points += points;
                
                // حفظ النقاط الإضافية
                const newExtraPoints = {
                    id: extraPoints.length > 0 ? Math.max(...extraPoints.map(ep => ep.id)) + 1 : 1,
                    memberId: memberId,
                    points: points,
                    reason: reason,
                    date: new Date().toISOString()
                };
                
                extraPoints.push(newExtraPoints);
                
                showNotification(`تم إضافة ${points} نقطة إلى ${member.name} بسبب: ${reason}`);
                
                // مسح الحقول
                document.getElementById('extraPointsValue').value = '1';
                document.getElementById('extraPointsReason').value = '';
                
                // تحديث البيانات
                populateData();
            }
        }
        
        // حذف تسجيل حضور
        function deleteAttendanceRecord(id) {
            if (confirm('هل تريد حذف تسجيل الحضور هذا؟')) {
                const record = attendanceRecords.find(ar => ar.id === id);
                if (record) {
                    // خصم النقاط من العضو
                    const member = members.find(m => m.id === record.memberId);
                    if (member) {
                        member.points = Math.max(0, member.points - 1);
                    }
                }
                
                attendanceRecords = attendanceRecords.filter(ar => ar.id !== id);
                showNotification('تم حذف تسجيل الحضور');
                
                // تحديث البيانات
                populateData();
            }
        }
        
        // حذف كل الحضور لأسبوع محدد
        function deleteAllWeekAttendance() {
            const weekId = parseInt(document.getElementById('deleteWeekSelect').value);
            
            if (!weekId) {
                showNotification('يرجى اختيار أسبوع أولاً', false);
                return;
            }
            
            if (confirm(`هل تريد حذف كل تسجيلات الحضور للأسبوع المحدد؟ هذا الإجراء لا يمكن التراجع عنه!`)) {
                // خصم النقاط من الأعضاء
                const weekRecords = attendanceRecords.filter(ar => ar.weekId == weekId);
                weekRecords.forEach(record => {
                    const member = members.find(m => m.id === record.memberId);
                    if (member) {
                        member.points = Math.max(0, member.points - 1);
                    }
                });
                
                attendanceRecords = attendanceRecords.filter(ar => ar.weekId != weekId);
                showNotification('تم حذف جميع تسجيلات الحضور لهذا الأسبوع');
                
                // تحديث البيانات
                populateData();
            }
        }
        
        // إضافة مناسبة
        function addEvent() {
            const name = document.getElementById('newEventName').value;
            const date = document.getElementById('newEventDate').value;
            const description = document.getElementById('newEventDescription').value;
            
            if (!name || !date || !description) {
                showNotification('يرجى ملء جميع الحقول', false);
                return;
            }
            
            const newEvent = {
                id: events.length > 0 ? Math.max(...events.map(e => e.id)) + 1 : 1,
                name: name,
                date: date,
                description: description
            };
            
            events.push(newEvent);
            showNotification('تم إضافة المناسبة بنجاح');
            
            // مسح الحقول
            document.getElementById('newEventName').value = '';
            document.getElementById('newEventDate').value = '';
            document.getElementById('newEventDescription').value = '';
            
            // تحديث جدول المناسبات
            const eventsTbody = document.querySelector('#eventsTable tbody');
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${events.length}</td>
                <td>${newEvent.name}</td>
                <td>${newEvent.date}</td>
                <td>${newEvent.description}</td>
                <td><button class='btn btn-primary editEvent'>تعديل</button></td>
                <td><button class='btn btn-danger deleteEvent'>حذف</button></td>
            `;
            eventsTbody.appendChild(tr);
        }
        
        // إضافة مهمة
        function addTask() {
            const name = document.getElementById('newTaskName').value;
            const assigneeId = parseInt(document.getElementById('newTaskAssignee').value);
            const deadline = document.getElementById('newTaskDeadline').value;
            
            if (!name || !assigneeId || !deadline) {
                showNotification('يرجى ملء جميع الحقول', false);
                return;
            }
            
            const assignee = members.find(m => m.id === assigneeId);
            if (!assignee) {
                showNotification('العضو المحدد غير موجود', false);
                return;
            }
            
            const newTask = {
                id: tasks.length > 0 ? Math.max(...tasks.map(t => t.id)) + 1 : 1,
                name: name,
                assigneeId: assigneeId,
                assigneeName: assignee.name,
                deadline: deadline,
                status: 'قيد التنفيذ'
            };
            
            tasks.push(newTask);
            showNotification('تم إضافة المهمة بنجاح');
            
            // مسح الحقول
            document.getElementById('newTaskName').value = '';
            document.getElementById('newTaskAssignee').value = '';
            document.getElementById('newTaskDeadline').value = '';
            
            // تحديث جدول المهمات
            const tasksTbody = document.querySelector('#tasksTable tbody');
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${tasks.length}</td>
                <td>${newTask.name}</td>
                <td>${newTask.assigneeName}</td>
                <td>${newTask.deadline}</td>
                <td><span class="badge btn-warning">${newTask.status}</span></td>
                <td><button class='btn btn-primary editTask'>تعديل</button></td>
                <td><button class='btn btn-danger deleteTask'>حذف</button></td>
            `;
            tasksTbody.appendChild(tr);
        }
        
        // طباعة التقرير
        function printReport() {
            window.print();
        }
        
        // تصدير لإكسل
        function exportToExcel() {
            // تحضير البيانات
            const data = [];
            
            // عناوين الأعمدة
            data.push(['الاسم', 'النقاط', 'المكافآت']);
            
            // بيانات الأعضاء
            members.forEach(member => {
                const rewardsText = rewards.filter(r => r.memberId === member.id)
                    .map(r => r.title).join(', ') || 'لا يوجد';
                
                data.push([member.name, member.points, rewardsText]);
            });
            
            // إنشاء workbook
            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'تقرير الحضور');
            
            // التحميل
            XLSX.writeFile(wb, 'تقرير_الحضور.xlsx');
        }
        
        // عرض الإشعارات
        function showNotification(message, isSuccess = true) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.background = isSuccess ? '#2ecc71' : '#e74c3c';
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // رسم بياني
        const ctx = document.getElementById('attendanceChart').getContext('2d');
        let chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: [],
                datasets: [{
                    label: 'الحضور',
                    data: [],
                    backgroundColor: ['#3498db','#2ecc71','#f39c12']
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
        
        function updateChart() {
            const selectedWeekId = document.getElementById('weekSelect').value;
            
            if (!selectedWeekId) {
                chart.data.labels = [];
                chart.data.datasets[0].data = [];
                chart.update();
                return;
            }
            
            const data = members.map(member => {
                const record = attendanceRecords.find(ar => 
                    ar.memberId === member.id && ar.weekId == selectedWeekId
                );
                return record ? 1 : 0;
            });
            
            chart.data.labels = members.map(m => m.name);
            chart.data.datasets[0].data = data;
            chart.update();
        }
        
        // بدء التطبيق عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
