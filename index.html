<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± - Ù…Ù„Ø§ÙŠÙƒØ©</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <!-- Ù…ÙƒØªØ¨Ø© QR -->
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

  <style>
    body { font-family: Arial, sans-serif; direction: rtl; text-align: center; }
    .member { border: 1px solid #ccc; padding: 10px; margin: 10px; border-radius: 10px; }
    .qrcode { margin-top: 10px; }
    button { padding: 5px 10px; margin-top: 5px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>ðŸ“‹ Ù†Ø¸Ø§Ù… Ø­Ø¶ÙˆØ± Ù…Ù„Ø§ÙŠÙƒØ©</h1>
  <div id="members"></div>

  <div id="qrcode-popup" style="display:none;">
    <h3>Ø§Ù…Ø³Ø­ Ø§Ù„ÙƒÙˆØ¯ Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
    <div id="qrcode"></div>
  </div>

  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "angels-attendance.firebaseapp.com",
      databaseURL: "https://angels-attendance-default-rtdb.firebaseio.com",
      projectId: "angels-attendance",
      storageBucket: "angels-attendance.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ù…Ù† Firebase
    function loadMembers() {
      db.ref("members").once("value", (snapshot) => {
        let container = document.getElementById("members");
        container.innerHTML = "";
        snapshot.forEach((child) => {
          let memberId = child.key;
          let member = child.val();

          let div = document.createElement("div");
          div.className = "member";
          div.innerHTML = `
            <h3>${member.name}</h3>
            <button onclick="generateQR('${memberId}')">Ø¹Ø±Ø¶ QR</button>
            <div class="qrcode" id="qrcode-${memberId}"></div>
          `;
          container.appendChild(div);
        });
      });
    }

    // ØªÙˆÙ„ÙŠØ¯ QR Code Ù„Ù„Ø¹Ø¶Ùˆ
    function generateQR(memberId) {
      let div = document.getElementById("qrcode");
      document.getElementById("qrcode-popup").style.display = "block";
      div.innerHTML = "";
      new QRCode(div, {
        text: window.location.origin + window.location.pathname + "?checkin=" + memberId,
        width: 200,
        height: 200
      });
    }

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ù„Ùˆ ÙÙŠÙ‡ checkin Ø¨Ø§Ù„Ù„ÙŠÙ†Ùƒ
    function getQueryParam(param) {
      let urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }

    window.onload = function () {
      loadMembers();

      let memberId = getQueryParam("checkin");
      if (memberId) {
        let today = new Date().toISOString().split("T")[0];
        db.ref("attendance/" + today + "/" + memberId).set({
          status: "Ø­Ø§Ø¶Ø±",
          time: new Date().toLocaleTimeString()
        }).then(() => {
          alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± Ø§Ù„Ø¹Ø¶Ùˆ: " + memberId);
        });
      }
    }
  </script>
</body>
</html>
