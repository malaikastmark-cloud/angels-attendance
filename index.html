<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø­Ø¶ÙˆØ± Ø®Ø¯Ø§Ù… Ø§Ù„Ù…Ù„Ø§ÙŠÙƒØ© - Talanton</title>
    <link rel="icon" href="https://public-frontend-cos.metadl.com/mgx/img/favicon.png" type="image/png">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- QR Code Scanner -->
    <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
    <!-- EmailJS -->
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3.2.0/dist/email.min.js"></script>
    <!-- Firebase SDK v9 -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getDatabase, ref, set, get, push, remove, onValue } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js';
        import { getAnalytics } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBCQIqdCsxSvhfYOs00AetoVWpFhj4XNAQ",
            authDomain: "angels-attendance.firebaseapp.com",
            databaseURL: "https://angels-attendance-default-rtdb.firebaseio.com",
            projectId: "angels-attendance",
            storageBucket: "angels-attendance.appspot.com",
            messagingSenderId: "157249026489",
            appId: "1:157249026489:web:db2b420203bd81d9a19e68",
            measurementId: "G-2YDPSFPQYT"
        };
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        window.firebaseDb = database;
        window.firebaseRef = ref;
        window.firebaseSet = set;
        window.firebaseGet = get;
        window.firebasePush = push;
        window.firebaseRemove = remove;
        window.firebaseOnValue = onValue;
        window.firebaseAuth = auth;
        window.firebaseCreateUser = createUserWithEmailAndPassword;
        window.firebaseSignIn = signInWithEmailAndPassword;
        window.firebaseSignOut = signOut;
    </script>
    <style>
        body {
            background: #f7fafc;
            color: #22223b;
            font-family: 'Cairo', Arial, sans-serif;
            margin: 0;
            padding: 0;
            direction: rtl;
        }
        header {
            background: #22223b;
            color: #fff;
            padding: 1rem;
        }
        h1, h2, h3 {
            margin: 0.5rem 0;
        }
        .stat-card {
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 8px #e9ecef;
            padding: 1rem 2rem;
            min-width: 180px;
            text-align: center;
        }
        .stat-label {
            font-size: 1rem;
            color: #575757;
        }
        .stat-number {
            font-size: 1.5rem;
            color: #446;
            font-weight: bold;
        }
        .btn {
            padding: 0.6rem 1.5rem;
            margin: 0.2rem;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            background: #4e54c8;
            color: #fff;
            transition: background 0.2s;
        }
        .btn:hover {
            background: #373a7a;
        }
        .btn-danger {
            background: #c8464e;
        }
        .btn-danger:hover {
            background: #7a2d34;
        }
        .btn-primary {
            background: #4e54c8;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 99;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background: rgba(34,34,59,0.2);
        }
        .modal-content {
            background: #fff;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            position: relative;
        }
        .close {
            color: #c8464e;
            float: left;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            margin-right: 0.5rem;
        }
        .tab-btn {
            padding: 0.5rem 1rem;
            background: #eee;
            border: none;
            margin: 0.2rem;
            border-radius: 5px 5px 0 0;
            cursor: pointer;
            font-weight: bold;
        }
        .tab-btn.active {
            background: #4e54c8;
            color: #fff;
        }
        .tab-content {
            display: none;
            padding: 1rem 0;
        }
        .tab-content.active {
            display: block;
        }
        input, select {
            width: 100%;
            padding: 0.5rem;
            margin: 0.4rem 0 1rem 0;
            border-radius: 5px;
            border: 1px solid #ddd;
            box-sizing: border-box;
            font-size: 1rem;
        }
        #mainContent section {
            margin: 2rem 0;
        }
    </style>
</head>
<body data-theme="light" data-language="ar">
<header>
    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem;">
        <h1 style="margin: 0;">Ù†Ø¸Ø§Ù… Ø­Ø¶ÙˆØ± Ø®Ø¯Ø§Ù… Ø§Ù„Ù…Ù„Ø§ÙŠÙƒØ© - Talanton</h1>
        <div>
            <button id="themeIcon" onclick="toggleTheme()" title="ØªØºÙŠÙŠØ± Ø§Ù„ÙˆØ¶Ø¹">ğŸŒ™</button>
            <button id="languageText" onclick="toggleLanguage()" title="ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©">English</button>
            <button onclick="showNotifications()" title="Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª">ğŸ””</button>
            <button onclick="showAdminLogin()" title="Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù†">ğŸ›¡ï¸</button>
        </div>
    </div>
</header>

<main id="mainContent">
    <section>
        <div style="display: flex; flex-wrap: wrap; gap: 1rem;">
            <div class="stat-card">
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</div>
                <div id="totalMembers" class="stat-number">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…</div>
                <div id="presentToday" class="stat-number">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù†Ù‚Ø§Ø· Talanton</div>
                <div id="totalTalanton" class="stat-number">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</div>
                <div id="weeklyAttendance" class="stat-number">0%</div>
            </div>
        </div>
    </section>

    <section>
        <h2>Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ø®Ø¯Ù…Ø©</h2>
        <input id="memberSearch" type="text" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¹Ø¶Ùˆ..." style="width: 100%; max-width: 400px; margin: 1rem 0;">
        <div id="membersList" style="display: flex; flex-wrap: wrap; gap: 1rem;"></div>
        <button class="btn btn-primary" onclick="showAddMemberModal()">Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ Ø¬Ø¯ÙŠØ¯</button>
    </section>

    <section>
        <h2>Ø£ÙØ¶Ù„ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</h2>
        <div id="topMembersList" style="display: flex; flex-wrap: wrap; gap: 1rem;"></div>
    </section>

    <section>
        <h2>Ø§Ù„Ù…ØªØ¬Ø±</h2>
        <button class="btn btn-primary" onclick="showTalantonStore()">ÙØªØ­ Ø§Ù„Ù…ØªØ¬Ø±</button>
        <div id="storeItems"></div>
    </section>

    <section>
        <h2>Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©/Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</h2>
        <div id="tasksList"></div>
        <button class="btn btn-primary" onclick="showAvailableTasks()">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ØªØ§Ø­Ø©</button>
    </section>
</main>

<!-- Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù† -->
<div id="adminPanel" style="display: none;">
    <div style="margin-bottom: 1rem;">
        <button class="tab-btn active" onclick="showTab('members', this)">Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</button>
        <button class="tab-btn" onclick="showTab('talanton', this)">Ø§Ù„Ù†Ù‚Ø§Ø·</button>
        <button class="tab-btn" onclick="showTab('store', this)">Ø§Ù„Ù…ØªØ¬Ø±</button>
        <button class="tab-btn" onclick="showTab('events', this)">Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª</button>
        <button class="tab-btn" onclick="showTab('weeks', this)">Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹</button>
        <button class="tab-btn" onclick="showTab('birthdays', this)">Ø£Ø¹ÙŠØ§Ø¯ Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</button>
        <button class="tab-btn" onclick="showTab('security', this)">Ø§Ù„Ø£Ù…Ø§Ù†</button>
        <button class="tab-btn" onclick="showTab('tasks', this)">Ø§Ù„Ù…Ù‡Ø§Ù…</button>
        <button class="tab-btn" onclick="showTab('reports', this)">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
        <button class="btn btn-danger" onclick="logoutAdmin()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø§Ù„Ø£Ø¯Ù…Ù†</button>
    </div>
    <div id="membersTab" class="tab-content active">
        <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</h3>
        <div id="membersTable"></div>
    </div>
    <div id="talantonTab" class="tab-content">
        <h3>Ø¥Ø¯Ø§Ø±Ø© Ù†Ù‚Ø§Ø· Talanton</h3>
        <button class="btn btn-primary" onclick="showTalantonModal()">Ø¥Ø¶Ø§ÙØ© / Ø®ØµÙ… Ù†Ù‚Ø§Ø·</button>
        <div id="talantonHistory"></div>
    </div>
    <div id="storeTab" class="tab-content">
        <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ¬Ø±</h3>
        <button class="btn btn-primary" onclick="showAddProductModal()">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</button>
        <div id="storeProducts"></div>
    </div>
    <div id="eventsTab" class="tab-content">
        <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª</h3>
        <button class="btn btn-primary" onclick="showAddEventModal()">Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø§Ø³Ø¨Ø©</button>
        <div id="eventsList"></div>
    </div>
    <div id="weeksTab" class="tab-content">
        <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹</h3>
        <button class="btn btn-primary" onclick="showAddWeekModal()">Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ø¨ÙˆØ¹</button>
        <div id="weeksList"></div>
    </div>
    <div id="birthdaysTab" class="tab-content">
        <h3>Ø£Ø¹ÙŠØ§Ø¯ Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</h3>
        <button class="btn btn-primary" onclick="showAddBirthdayModal()">Ø¥Ø¶Ø§ÙØ© Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯</button>
        <div id="birthdaysList"></div>
    </div>
    <div id="securityTab" class="tab-content">
        <div id="securityLogs"></div>
    </div>
    <div id="tasksTab" class="tab-content">
        <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù…</h3>
        <button class="btn btn-primary" onclick="showAddTaskModal()">Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©</button>
        <div id="adminTasksList"></div>
    </div>
    <div id="reportsTab" class="tab-content">
        <h3>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h3>
        <div style="display: flex; flex-wrap: wrap; gap: 2rem;">
            <canvas id="attendanceChart" width="400" height="250"></canvas>
            <canvas id="talantonChart" width="400" height="250"></canvas>
            <canvas id="topMembersChart" width="400" height="250"></canvas>
        </div>
        <button class="btn btn-primary" onclick="generateMonthlyReport()">Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø´Ù‡Ø±ÙŠ</button>
        <button class="btn btn-primary" onclick="generateMemberReport()">ØªÙ‚Ø±ÙŠØ± Ø¹Ø¶Ùˆ Ø­Ø§Ù„ÙŠ</button>
        <button class="btn btn-primary" onclick="exportChart('attendanceChart')">ØªØµØ¯ÙŠØ± Ù…Ø®Ø·Ø· Ø§Ù„Ø­Ø¶ÙˆØ±</button>
        <button class="btn btn-primary" onclick="exportChart('talantonChart')">ØªØµØ¯ÙŠØ± Ù…Ø®Ø·Ø· Ø§Ù„Ù†Ù‚Ø§Ø·</button>
        <button class="btn btn-primary" onclick="exportChart('topMembersChart')">ØªØµØ¯ÙŠØ± Ù…Ø®Ø·Ø· Ø£ÙØ¶Ù„ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</button>
    </div>
</div>
<!-- Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ Ø¬Ø¯ÙŠØ¯ -->
<div id="addMemberModal" class="modal" style="display:none;">
    <div class="modal-content">
        <span class="close" onclick="closeModal('addMemberModal')">&times;</span>
        <h2>Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ Ø¬Ø¯ÙŠØ¯</h2>
        <form onsubmit="addMember(event)">
            <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ø¶Ùˆ</label>
            <input type="text" id="memberName" required>
            <label>Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¶Ùˆ</label>
            <input type="text" id="memberNumber" required>
            <label>Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <input type="email" id="memberEmail">
            <button type="submit" class="btn btn-primary">Ø¥Ø¶Ø§ÙØ©</button>
        </form>
    </div>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø¶Ùˆ -->
<div id="editMemberModal" class="modal" style="display:none;">
    <div class="modal-content">
        <span class="close" onclick="closeModal('editMemberModal')">&times;</span>
        <h2>ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø¶Ùˆ</h2>
        <form onsubmit="updateMember(event)">
            <input type="hidden" id="editMemberId">
            <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ø¶Ùˆ</label>
            <input type="text" id="editMemberName" required>
            <label>Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¶Ùˆ</label>
            <input type="text" id="editMemberNumber" required>
            <label>Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
            <input type="email" id="editMemberEmail">
            <button type="submit" class="btn btn-primary">ØªØ­Ø¯ÙŠØ«</button>
        </form>
    </div>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…ØªØ¬Ø± -->
<div id="addProductModal" class="modal" style="display:none;">
    <div class="modal-content">
        <span class="close" onclick="closeModal('addProductModal')">&times;</span>
        <h2>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h2>
        <form onsubmit="addProduct(event)">
            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
            <input type="text" id="productName" required>
            <label>Ø³Ø¹Ø± Talanton</label>
            <input type="number" id="productPrice" min="1" required>
            <button type="submit" class="btn btn-primary">Ø¥Ø¶Ø§ÙØ©</button>
        </form>
    </div>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†ØªØ¬ -->
<div id="editProductModal" class="modal" style="display:none;">
    <div class="modal-content">
        <span class="close" onclick="closeModal('editProductModal')">&times;</span>
        <h2>ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬</h2>
        <form onsubmit="updateProduct(event)">
            <input type="hidden" id="editProductId">
            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
            <input type="text" id="editProductName" required>
            <label>Ø³Ø¹Ø± Talanton</label>
            <input type="number" id="editProductPrice" min="1" required>
            <button type="submit" class="btn btn-primary">ØªØ­Ø¯ÙŠØ«</button>
        </form>
    </div>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø§Ø³Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø© -->
<div id="addEventModal" class="modal" style="display:none;">
    <div class="modal-content">
        <span class="close" onclick="closeModal('addEventModal')">&times;</span>
        <h2>Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø§Ø³Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
        <form onsubmit="addEvent(event)">
            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©</label>
            <input type="text" id="eventName" required>
            <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©</label>
            <input type="date" id="eventDate" required>
            <label>Ø§Ù„ÙˆØµÙ</label>
            <input type="text" id="eventDescription">
            <label>Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©</label>
            <input type="number" id="eventReward" min="0" value="0">
            <button type="submit" class="btn btn-primary">Ø¥Ø¶Ø§ÙØ©</button>
        </form>
    </div>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ø¨ÙˆØ¹ Ø¬Ø¯ÙŠØ¯ -->
<div id="addWeekModal" class="modal" style="display:none;">
    <div class="modal-content">
        <span class="close" onclick="closeModal('addWeekModal')">&times;</span>
        <h2>Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ø¨ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</h2>
        <form onsubmit="addWeek(event)">
            <label>Ø§Ø³Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</label>
            <input type="text" id="weekName" required>
            <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</label>
            <input type="date" id="weekStartDate" required>
            <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</label>
            <input type="date" id="weekEndDate" required>
            <label>Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©</label>
            <input type="number" id="weekReward" min="0" value="50">
            <button type="submit" class="btn btn-primary">Ø¥Ø¶Ø§ÙØ©</button>
        </form>
    </div>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¶Ø§ÙØ© Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯ -->
<div id="addBirthdayModal" class="modal" style="display:none;">
    <div class="modal-content">
        <span class="close" onclick="closeModal('addBirthdayModal')">&times;</span>
        <h2>Ø¥Ø¶Ø§ÙØ© Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯</h2>
        <form onsubmit="addBirthday(); return false;">
            <label>Ø§Ø®ØªØ± Ø§Ù„Ø¹Ø¶Ùˆ</label>
            <select id="birthdayMember"></select>
            <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label>
            <input type="date" id="birthdayDate" required>
            <button type="submit" class="btn btn-primary">Ø¥Ø¶Ø§ÙØ©</button>
        </form>
    </div>
</div>
<script>
// Ù…Ø«Ø§Ù„ Ù„Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ø£ÙƒÙ…Ù„ Ø¨Ù‚ÙŠØ© Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙƒÙ…Ø§ ÙÙŠ Ù…Ø´Ø±ÙˆØ¹Ùƒ)
let members = [];
let products = [];
let events = [];
let weeks = [];
let birthdays = [];
let notifications = [];
let tasks = [];

// Ù…Ø«Ø§Ù„ Ù„Ø¯ÙˆØ§Ù„ Ø¹Ø±Ø¶/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„Ø§Øª
function showModal(id) {
    document.getElementById(id).style.display = 'block';
}
function closeModal(id) {
    document.getElementById(id).style.display = 'none';
}

// ØªØµØ­ÙŠØ­ showTab Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ (tabName, el)
function showTab(tabName, el) {
    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    document.getElementById(tabName + 'Tab').classList.add('active');
    if (el) el.classList.add('active');
    if (tabName === 'reports') loadCharts();
}

// Ù…Ø«Ø§Ù„ Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„Ø§Øª
function showAddMemberModal() { showModal('addMemberModal'); }
function showAddProductModal() { showModal('addProductModal'); }
function showAddEventModal() { showModal('addEventModal'); }
function showAddWeekModal() { showModal('addWeekModal'); }
function showAddBirthdayModal() { showModal('addBirthdayModal'); }

// Ù…Ø«Ø§Ù„ Ø¹Ù„Ù‰ Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ (Ø¹Ø¯Ù‘Ù„ Ø­Ø³Ø¨ Ù†Ù…ÙˆØ°Ø¬ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ)
function addMember(e) {
    e.preventDefault();
    let name = document.getElementById('memberName').value;
    let number = document.getElementById('memberNumber').value;
    let email = document.getElementById('memberEmail').value;
    let id = Date.now().toString();
    members.push({ id, name, number, email });
    closeModal('addMemberModal');
    renderMembers();
    // Ø£Ø¶Ù Ù‡Ù†Ø§ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firebase Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª
}

// Ù…Ø«Ø§Ù„ Ø¹Ù„Ù‰ Ø¯Ø§Ù„Ø© ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø¶Ùˆ
function updateMember(e) {
    e.preventDefault();
    let id = document.getElementById('editMemberId').value;
    let name = document.getElementById('editMemberName').value;
    let number = document.getElementById('editMemberNumber').value;
    let email = document.getElementById('editMemberEmail').value;
    let member = members.find(m => m.id === id);
    if (member) {
        member.name = name;
        member.number = number;
        member.email = email;
        closeModal('editMemberModal');
        renderMembers();
        // Ø£Ø¶Ù Ù‡Ù†Ø§ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firebase Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª
    }
}

// Ù…Ø«Ø§Ù„ Ù„Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
function renderMembers() {
    let membersDiv = document.getElementById('membersList');
    if (!membersDiv) return;
    membersDiv.innerHTML = members.map(m => `
        <div class="stat-card" style="min-width:170px">
            <div>${m.name}</div>
            <div style="font-size:0.9rem;color:#888">${m.number}</div>
            <button class="btn btn-primary" onclick="editMember('${m.id}')">ØªØ¹Ø¯ÙŠÙ„</button>
        </div>
    `).join('');
}

// Ø¯Ø§Ù„Ø© Ù„ÙØªØ­ Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø¶Ùˆ
function editMember(id) {
    let member = members.find(m => m.id === id);
    if (member) {
        document.getElementById('editMemberId').value = member.id;
        document.getElementById('editMemberName').value = member.name;
        document.getElementById('editMemberNumber').value = member.number;
        document.getElementById('editMemberEmail').value = member.email;
        showModal('editMemberModal');
    }
}

// Ù…Ø«Ø§Ù„ Ø¹Ù„Ù‰ ØªÙ‡ÙŠØ¦Ø© EmailJS Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù†
function safeInitEmailJS() {
    const userId = localStorage.getItem('emailUserId');
    if (userId && userId !== "YOUR_USER_ID") {
        emailjs.init(userId);
    }
}
safeInitEmailJS();

// Ù…Ø«Ø§Ù„ Ù„Ø­Ù…Ø§ÙŠØ© Ø­Ø°Ù Ù…Ù†ØªØ¬
function deleteProduct(productId) {
    if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ')) {
        const product = products.find(p => p.id === productId);
        products = products.filter(p => p.id !== productId);
        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ ÙÙŠØ±Ø¨ÙŠØ² Ø¥Ø°Ø§ Ù„Ø²Ù…
        // loadStoreProducts();
        // showMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
        // if (product) addNotification('Ø­Ø°Ù Ù…Ù†ØªØ¬', `ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ ${product.name} Ù…Ù† Ø§Ù„Ù…ØªØ¬Ø±`);
    }
}

// Ù…Ø«Ø§Ù„ ØªØµØ¯ÙŠØ± CSV
function exportToCSV(data, fileName) {
    if (data.length === 0) {
        alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±');
        return;
    }
    const headers = Object.keys(data[0]).join(',');
    const rows = data.map(obj => Object.values(obj).map(v =>
        `"${String(v).replace(/"/g, '""').replace(/\n/g, ' ')}"`
    ).join(','));
    const csvContent = [headers, ...rows].join('\n');
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `${fileName}-${new Date().toISOString().split('T')[0]}.csv`;
    link.click();
    // showMessage('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
}

// Ù…Ø«Ø§Ù„ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù„ØºØ©
function loadLanguage() {
    // Ø£Ø¶Ù Ù‡Ù†Ø§ ÙƒÙˆØ¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„ØºØ© Ù…Ù† localStorage Ø£Ùˆ ØºÙŠØ±Ù‡
}
function applyTranslations() {
    // Ø£Ø¶Ù Ù‡Ù†Ø§ ÙƒÙˆØ¯ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©
}

// ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
    loadLanguage();
    applyTranslations();
    renderMembers(); // Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØµÙØ­Ø©
    // Ø£Ø¶Ù Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø­Ø³Ø¨ Ø­Ø§Ø¬ØªÙƒ
});
</script>
</body>
</html>
